{"version":3,"sources":["ZegoExpressMiniProgram.js"],"names":[],"mappings":";;;;;;;AAAA;AACA","file":"index.js","sourcesContent":["\n!function(e,t){if(\"object\"==typeof exports&&\"object\"==typeof module)module.exports=t();else if(\"function\"==typeof define&&define.amd)define([],t);else{var r=t();for(var s in r)(\"object\"==typeof exports?exports:e)[s]=r[s]}}(\"undefined\"!=typeof self?self:this,(function(){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)r.d(s,o,function(t){return e[t]}.bind(null,o));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=7)}([function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.LinkedList=t.ListNode=t.E_CLIENT_TYPE=t.ENUM_SOURCE_TYPE=t.ENUM_DISPATCH_TYPE=t.ENUM_BROADCASTER_STATUS=t.ENUM_PLAY_SOURCE_TYPE=t.ENUM_PUBLISH_STATE_NEGO=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.QUALITYLEVEL=t.MIXSTREAM_ERROR_CODE=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.TRY_LOGIN_INTERVAL=t.MAX_TRY_LOGIN_COUNT=t.ENUM_PLAY_STATE_UPDATE=t.ENUM_PUBLISH_STATE_UPDATE=t.ENUM_RUN_STATE=t.ENUM_STREAM_UPDATE_TYPE=t.ENUM_STREAM_SUB_CMD=t.ENUM_PUBLISH_STREAM_STATE=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_PLAY_STATE_NEGO=t.ENUM_PLAY_STATE=t.ENUM_PUBLISH_STATE=t.ENUM_RETRY_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.sdkErrorList=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.PROTO_VERSION=\"1.7.2\",t.ROOMVERSION=\"V1\",function(e){e[e.debug=0]=\"debug\",e[e.info=1]=\"info\",e[e.warn=2]=\"warn\",e[e.error=3]=\"error\",e[e.report=99]=\"report\",e[e.disable=100]=\"disable\"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]=\"disable\",e[e.websocket=1]=\"websocket\",e[e.https=2]=\"https\"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.sdkErrorList={CLIENT:\"Client.\",SERVER:\"Server.\",SUCCESS:{code:\"Success\",msg:\"success.\"},PARAM:{code:\"Error.Param\",msg:\"input error.\"},HEARTBEAT_TIMEOUT:{code:\"Error.Timeout\",msg:\"heartbeat timeout.\"},LOGIN_TIMEOUT:{code:\"Error.Timeout\",msg:\"login timeout.\"},SEND_MSG_TIMEOUT:{code:\"Error.Timeout\",msg:\"send customsg timeout.\"},RESET_QUEUE:{code:\"Error.Timeout\",msg:\"msg waiting ack is clear when reset.\"},LOGIN_DISCONNECT:{code:\"Error.Network\",msg:\"network is broken and login fail.\"},KICK_OUT:{code:\"Error.Kickout\",msg:\"kickout reason=\"},UNKNOWN:{code:\"Error.Unknown\",msg:\"unknown error.\"},FREQ_LIMITED:{code:\"Error.requencyLimited\",msg:\"Frequency Limited.\"}},t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},function(e){e[e.disconnected=0]=\"disconnected\",e[e.connecting=1]=\"connecting\",e[e.connected=2]=\"connected\"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_MIX_TASK_ID_LENGTH=256,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5},t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_UPDATE_TYPE={added:1,deleted:0},function(e){e[e.logout=0]=\"logout\",e[e.trylogin=1]=\"trylogin\",e[e.login=2]=\"login\"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2},t.MAX_TRY_LOGIN_COUNT=5,t.TRY_LOGIN_INTERVAL=[2e3,4e3,6e3,8e3,1e4],t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.SERVER_ERROR_CODE=1e4,t.MIXSTREAM_ERROR_CODE=1e4,function(e){e[e.low=1]=\"low\",e[e.stantard=2]=\"stantard\",e[e.hight=3]=\"hight\",e[e.custome=4]=\"custome\"}(t.QUALITYLEVEL||(t.QUALITYLEVEL={})),t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},t.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5},function(e){e[e.cdn=0]=\"cdn\",e[e.ultra=1]=\"ultra\"}(t.ENUM_PLAY_SOURCE_TYPE||(t.ENUM_PLAY_SOURCE_TYPE={})),function(e){e[e.stop=0]=\"stop\",e[e.start=1]=\"start\"}(t.ENUM_BROADCASTER_STATUS||(t.ENUM_BROADCASTER_STATUS={})),function(e){e[e.cdn=0]=\"cdn\",e[e.ultra=1]=\"ultra\",e[e.customUrl=2]=\"customUrl\"}(t.ENUM_DISPATCH_TYPE||(t.ENUM_DISPATCH_TYPE={})),function(e){e[e.CDN=0]=\"CDN\",e[e.BGP=1]=\"BGP\"}(t.ENUM_SOURCE_TYPE||(t.ENUM_SOURCE_TYPE={})),function(e){e[e.ClientType_None=0]=\"ClientType_None\",e[e.ClientType_H5=1]=\"ClientType_H5\",e[e.ClientType_SmallPragram=2]=\"ClientType_SmallPragram\",e[e.ClientType_Webrtc=3]=\"ClientType_Webrtc\"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}));var s=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._id=null,this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,\"id\",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"data\",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=s;var o=function(){function e(){this.start=new s,this.end=new s,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new s(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw\"Index out of bounds.\";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,s=null;t.hasNext()&&!r;)e(t=t.next)&&(s=t,r=!0);return s},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this._numNodes>0?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=o},function(e,t,r){var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(o,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function n(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,n)}l((s=s.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,s,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:n(0),throw:n(1),return:n(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function n(i){return function(n){return function(i){if(r)throw new TypeError(\"Generator is already executing.\");for(;a;)try{if(r=1,s&&(o=2&i[0]?s.return:i[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,i[1])).done)return o;switch(s=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,s=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],s=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,n])}}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.ClientUtil=void 0;var i=r(0),a=r(5),n=r(3),l=function(){function e(){}return e.checkConfigParam=function(e,t,r){return e&&\"number\"==typeof e&&this.checkInteger(e)?!(!t||\"string\"!=typeof t&&!Array.isArray(t)||\"\"==t)||(r.error(\"ccp.0 server must be string or string array and not empty\"),!1):(r.error(\"ccp.0 appid must be positive integer number and not empty\"),!1)},e.checkStreamID=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith(\"rtmp://\")||e.startsWith(\"https://\")&&e.endsWith(\".flv\")||e.startsWith(\"https://\")&&e.endsWith(\".m3u8\"))},e.registerCallback=function(e,t,r){var s,o;t.success&&(s=t.success,r[e+\"SuccessCallback\"]=s),t.error&&(o=t.error,r[e+\"ErrorCallback\"]=o)},e.actionErrorCallback=function(e,t){return t[e+\"ErrorCallback\"]},e.actionSuccessCallback=function(e,t){return t[e+\"SuccessCallback\"]},e.logReportCallback=function(t,r,s,o){e.registerCallback(t,{success:function(t,o){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];e.dataReportEvent(r,s,t,o,i)}},o)},e.proxyRes=function(t,r,s,o){return{interResolve:function(e){t.uploadReport(r),s(e)},interReject:function(s,i){var a;if(void 0===i&&(i=\"\"),s.code<2e9&&s.code>1e9)a=e.decodeServerError(s.code,s.msg);else{var l=n.codeErrMap[s.code];a=n.errorList[l]}a&&t.addMsgInfo(r,{error:a.code,message:a.message+i}),t.uploadReport(r),o(s)}}},e.getServerError=function(e){var t={1:\"parse json error.\",1001:\"login is processing.\",1002:\"liveroom request error.\",1003:\"zpush connect fail.\",1004:\"zpush handshake fail.\",1005:\"zpush login fail.\",1006:\"user login state is wrong.\",1007:\"got no zpush addr\",1008:\"token error\",1009:\"dispatch error\",1010:\"token expired\",1011:\"token format error\",1012:\"subcmd error\",1101:\"zego auth error\",2001:\"invalid channel\",2002:\"biz channel error\",1e9:\"liveroom cmd error, result=\"};if(0===e)return a.commonErrorList.SUCCESS;var r=a.liveRoomErrorList.SERVER;return r.code=e,r.msg=e>1e9?t[1e9]+e:t[e]?t[e]:\"unknown error code:\"+e,r},e.unregisterCallback=function(e,t){delete t[e+\"SuccessCallback\"],delete t[e+\"ErrorCallback\"]},e.decodeServerError=function(e,t){var r={code:-1,message:\"server error\"};return r.code=e>1e9?e-1e9+52e6:e+2002e6,t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:\"ROOM_MAX_USER_COUNT\",1012:\"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM\",2002:\"ROOM_ERROR_AUTHENTICATION_FAILED\",2003:\"ROOM_ERROR_LOGIN_TIMEOUT\"}[e-1e9]||\"\":{1:\"PARSE_JSON_ERROR\",1001:\"LOGIN_PROCESSING\",1002:\"LIVEROMM_REQUEST_ERROR\",1003:\"ZPUSH_REQUEST_FAIL\",1004:\"ZPUSH_REQUEST_FAIL\",1005:\"ZPUSH_REQUEST_FAIL\",1006:\"LOGIN_STATE_WRONG\",1007:\"ZPUSH_REQUEST_FAIL\",1008:\"TOKEN_ERROR\",1009:\"DIAPATCH_ERROR\",1010:\"TOKEN_EXPIRED\",1011:\"TOKEN_ERROR\",1012:\"SUBCMD_ERROR\",1101:\"ZEGO_AUTH_ERROR\",2001:\"BIZ_CHANNEL_ERROR\",2002:\"BIZ_CHANNEL_ERROR\"}[e]||\"ROOM_INNER_ERROR\"},e.mixServerError=function(e){var t={82000001:\"kMixStreamFailError\",82000002:\"kMixStreamInputError\",82000003:\"kMixStreamAuthError\",82000150:\"kMixStreamNotExistError\",82000151:\"kMixStreamStartMixError\",82000152:\"kMixStreamStopMixError\",82000155:\"kMixStreamInputFormatError\",82000156:\"kMixStreamOutputFormatError\",82000157:\"kMixStreamNotOpenError\",82000158:\"kMixStreamInputExceedError\",82000159:\"kMixStreamDispatchError\",82000160:\"kMixStreamStopMixOwnerError\",82000170:\"kMixStreamWaterMarkParamError\",82000171:\"kMixStreamWaterMarkImageError\",82000190:\"kMixStreamQpsOverloadError\"},r={1:\"MIXER_START_REQUEST_ERROR\",3:\"MIXER_AUTHENTICATION_FAILED\",150:\"MIXER_INPUT_STREAM_NOT_EXISTS\",151:\"MIXER_START_REQUEST_ERROR\",152:\"MIXER_STOP_REQUEST_ERROR\",153:\"MIXER_INPUT_PARAMETERS_ERROR\",154:\"MIXER_EXCEED_MAX_OUTPUT_COUNT\",155:\"MIXER_INPUT_PARAMETERS_ERROR\",156:\"MIXER_VIDEO_CONFIG_INVALID\",157:\"MIXER_NO_SERVICES\",158:\"MIXER_EXCEED_MAX_INPUT_COUNT\",159:\"MIXER_START_REQUEST_ERROR\",160:\"MIXER_NOT_OWNER_STOPMIXER\",170:\"MIXER_WATERMARK_PARAMETERS_ERROR\",171:\"MIXER_WATERMARK_NULL\",190:\"MIXER_START_REQUEST_ERROR\"},s=[];if(e>1e9){var o=e-1e9+82e6;s[0]=t[o]?t[o]:\"\",s[1]=r[e-1e9]?r[e-1e9]:\"\"}return s},e.getKickoutError=function(e){var t={};switch(e){case 1:t.code=63000001,t.message=\"zpush multiple login kickout\",t.name=\"MULTIPLE_LOGIN_KICKOUT\";break;case 2:t.code=63000002,t.message=\"zpush manual kickout\",t.name=\"MANUAL_KICKOUT\";break;case 3:t.code=63000003,t.message=\"zpush room session error\"}return t},e.dataReportEvent=function(e,t,r,s,o){switch(r){case\"eventStart\":e.eventStart(t,s);break;case\"eventEndWithMsgInfo\":e.eventEndWithMsgInfo(t,s,o[0]);break;case\"addEventMsg\":e.addEventMsg(t,s,o[0],o[1]);break;case\"addEvent\":e.addEvent(t,s);break;case\"eventEnd\":e.eventEnd(t,s);break;case\"addMsgInfo\":e.addMsgInfo(t,o[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeStreamList=function(e,t,r,s,o){e.debug(\"msl.0 call\");var i,a=[],n=[],l=[];s||(s=[]);for(var d=0;d<s.length;d++)if(s[d].anchor_id_name!=t){i=!1;for(var u=0;u<r.length;u++)if(s[d].stream_id===r[u].stream_id){s[d].extra_info!==r[u].extra_info&&l.push(s[d]),i=!0;break}i||a.push(s[d])}else e.debug(\"msl.0 have self stream added\");for(var h=0;h<r.length;h++){i=!1;for(var g=0;g<s.length;g++)if(r[h].stream_id===s[g].stream_id){i=!0;break}i||n.push(r[h])}r.splice(0);for(d=0;d<s.length;d++)r.push(s[d]);o(a,n,l),e.debug(\"msl.0 call success\")},e.mergeUserList=function(e,t,r,s){e.debug(\"msl.0 call\");var o,i=[],a=[];r||(r=[]);for(var n=0;n<r.length;n++){o=!1;for(var l=0;l<t.length;l++)if(r[n].userID===t[l].userID){o=!0;break}o||i.push(r[n])}for(var d=0;d<t.length;d++){o=!1;for(var u=0;u<r.length;u++)if(t[d].userID===r[u].userID){o=!0;break}o||a.push(t[d])}t.splice(0);for(n=0;n<r.length;n++)t.push(t[n]);s(i,a),e.debug(\"msl.0 call success\")},e.checkCustomCommandParam=function(e){return!0},e.checkInteger=function(e,t){return 0==t?\"number\"==typeof e&&e%1==0&&e>=0:\"number\"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,\"number\"==typeof e&&e%1==0&&e>=t&&e<=r},e.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+\"\",10)},e.uuid=function(e,t){var r,s=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\".split(\"\"),o=[];if(t=t||s.length,e)for(r=0;r<e;r++)o[r]=s[0|Math.random()*t];else{var i=void 0;for(o[8]=o[13]=o[18]=o[23]=\"-\",o[14]=\"4\",r=0;r<36;r++)o[r]||(i=0|16*Math.random(),o[r]=s[19==r?3&i|8:i])}return o.join(\"\")},e.supportDetection=function(e,t){return s(this,void 0,void 0,(function(){var r,s,i,a,n,l;return o(this,(function(o){switch(o.label){case 0:return r={webRTC:!1,customCapture:!1,camera:!1,microphone:!1,videoCodec:{H264:!1,H265:!1,VP8:!1,VP9:!1},screenSharing:e,errInfo:{}},((s=document.createElement(\"video\")).captureStream||s.mozCaptureStream)&&(r.customCapture=!0),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?\"https:\"===window.location.protocol||\"file:\"===window.location.protocol||-1!=window.location.hostname.indexOf(\"127.0.0.1\")||-1!=window.location.hostname.indexOf(\"localhost\")?[3,1]:(r.camera=!1,console.error(\"webrtc requires https or localhost\"),[3,7]):[3,7];case 1:return o.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({video:!0})];case 2:return(i=o.sent())&&(r.camera=!0)&&i.getTracks().forEach((function(e){return e.stop()})),[3,4];case 3:return a=o.sent(),r.errInfo.camera={name:a.name,message:a.message},console.error(\"camera devices detect error: \",a.name,a.message),[3,4];case 4:return o.trys.push([4,6,,7]),[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 5:return(n=o.sent())&&(r.microphone=!0)&&n.getTracks().forEach((function(e){return e.stop()})),[3,7];case 6:return l=o.sent(),r.errInfo.microphone={name:l.name,message:l.message},console.error(\"microphone devices detect error: \",l.name,l.message),[3,7];case 7:return this.supportVideoCodeType((function(e,s){r.videoCodec.H264=e.H264,r.videoCodec.H265=e.H265,r.videoCodec.VP8=e.VP8,r.videoCodec.VP9=e.VP9,r.webRTC=e.webRTC,s&&(r.errInfo.webRTC={name:s.name,message:s.message},console.error(\"videoCodec detect error: \"+s)),t&&t(r)})),[2]}}))}))},e.getNetQuality=function(e,t){return e&&e<600?t>.4?2:t>.3?4:5:e<900?t>.4?2:t>.2?3:4:t>.2?2:3},e.getDevices=function(e,t){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){for(var r=[],s=[],o=[],i=0;i<t.length;i++){var a=t[i];\"audioinput\"===a.kind&&r.push({deviceName:a.label,deviceID:a.deviceId}),\"audiooutput\"===a.kind&&s.push({deviceName:a.label,deviceID:a.deviceId}),\"videoinput\"===a.kind&&o.push({deviceName:a.label,deviceID:a.deviceId})}e&&e({microphones:r,speakers:s,cameras:o})})).catch((function(e){console.error(\"enumerate devices wrong \"+e),t&&t(a.commonErrorList.ENUMERATE_DEVICES_FAIL)})):t&&t(a.publishErrorList.BROWSER_NOT_SUPPORT)},e.compareVersion=function(e,t){e=e.split(\".\"),t=t.split(\".\");for(var r=Math.max(e.length,t.length);e.length<r;)e.push(\"0\");for(;t.length<r;)t.push(\"0\");for(var s=0;s<r;s++){var o=parseInt(e[s]),i=parseInt(t[s]);if(o>i)return 1;if(o<i)return-1}return 0},e.isSupportLive=function(e,t){var r=\"当前微信版本过低，无法使用相关组件\",s=\"需要摄像头和录音功能的授权\",o=wx.getSystemInfoSync().SDKVersion,i={code:-1,msg:\"\"};this.compareVersion(o,\"1.7.0\")<0&&(i={code:10001,msg:r},e&&e(i)),wx.getSetting({success:function(t){var r=t.authSetting;r[\"scope.camera\"]&&r[\"scope.record\"]||(i={code:10002,msg:s}),e&&e(i)},fail:function(e){console.error(\"get setting error\",e),t&&t(e)}})},e.supportVideoCodeType=function(e){var t={webRTC:!1,H264:!1,VP8:!1,VP9:!1,H265:!1};try{(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){if(t.webRTC=!0,r&&r.sdp){var s=r.sdp.split(\"\\r\\n\");t.H264=s.some((function(e){return e.startsWith(\"a=rtpmap:\")&&e.indexOf(\"H264/\")>-1})),t.VP8=s.some((function(e){return e.startsWith(\"a=rtpmap:\")&&e.indexOf(\"VP8/\")>-1})),t.VP9=s.some((function(e){return e.startsWith(\"a=rtpmap:\")&&e.indexOf(\"VP9/\")>-1})),t.H265=s.some((function(e){return e.startsWith(\"a=rtpmap:\")&&e.indexOf(\"H264/\")>-1})),e&&e(t)}}))}catch(r){e&&e(t,r)}},e.inlineWorker=function(e){if(Worker&&e){var t=e.toString().trim().match(/^function\\s*\\w*\\s*\\([\\w\\s,]*\\)\\s*{([\\w\\W]*?)}$/)[1],r=URL.createObjectURL(new window.Blob([t],{type:\"text/javascript\"}));return new Worker(r)}return null},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf(\"MSIE\"),r=-1!=e.indexOf(\"Firefox\"),s=null!=window.opr,o=e.indexOf(\"Chrome\")&&window.chrome,i=-1!=e.indexOf(\"Safari\")&&-1!=e.indexOf(\"Version\");return t?\"IE\":r?\"Firefox\":s?\"Opera\":o?\"Chrome\":i?\"Safari\":\"Unkown\"},e.isTestEnv=function(e){return-1!=e.indexOf(\"wss://wssliveroom-test.zego.im/ws\")||-1!=e.indexOf(\"wss://test2-wsliveroom-api.zego.im/ws\")||-1!=e.indexOf(\"wss://wsliveroom-test.zegocloud.com/ws\")||-1!=e.indexOf(\"wss://wsliveroom-test.zego.im/ws\")||-1!=e.indexOf(\"wss://webliveroom-test.zego.im/ws\")||-1!=e.indexOf(\"wss://webliveroom-test-bak.zego.im/ws\")||-1!=e.indexOf(\"wss://webliveroom-hk-test.zegocloud.com/ws\")||-1!=e.indexOf(\"wss://webliveroom-hk-test-bak.zegocloud.com/ws\")},e.setDebug=function(t,r){\"string\"==typeof t&&t.indexOf(\"wss\")>-1?r.debug=e.isTestEnv(t):Array.isArray(t)&&t.length>0&&t.every((function(e){return\"string\"==typeof e&&e.indexOf(\"wss\")>-1}))?r.debug=this.isTestEnv(t[0])||this.isTestEnv(t[1]):console.error(\"server wrong\"),r.testEnvironment=r.debug},e.getPublisherStateType=function(e){return 0==e||1==e?0==e?\"PUBLISHING\":\"NO_PUBLISH\":\"PUBLISH_REQUESTING\"},e.getPlayerStateType=function(e){return 0==e||1==e?0==e?\"PLAYING\":\"NO_PLAY\":\"PLAY_REQUESTING\"},e.getSteamUpdateType=function(e){return 0==e?\"DELETE\":\"ADD\"},e.getLogLevel=function(e){return i.LOG_LEVEL[e]},e}();t.ClientUtil=l},function(e,t,r){var s;Object.defineProperty(t,\"__esModule\",{value:!0}),t.getReportSeq=t.getSeq=t.REPORT_ACTION=t.ENUM_RETRY_STATE=t.ENUM_PLAY_STATE_UPDATE=t.ENUM_PUBLISH_STATE_UPDATE=void 0,t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.REPORT_ACTION={eventStart:\"eventStart\",eventEndWithMsgInfo:\"eventEndWithMsgInfo\",addEventMsg:\"addEventMsg\",addEvent:\"addEvent\",eventEnd:\"eventEnd\",addMsgInfo:\"addMsgInfo\"},t.getSeq=(s=1,function(){return s++}),t.getReportSeq=function(){var e=1;return function(){return e++}}()},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.codeErrMap=t.errorList=t.eventList=void 0,t.eventList={kZegoTaskInitSetting:\"/sdk/init\",kZegoTaskLoginRoom:\"/sdk/login\",kZegoTaskLogoutRoom:\"/sdk/logout\",kZegoTaskReLoginRoom:\"/sdk/relogin\",kZegoTaskSdkDisconnect:\"/sdk/disconnect\",kZegoTaskKickout:\"/sdk/kickout\",kZegoTaskSessionClose:\"/sdk/session_close\",kZegoTaskLiveRoomhHB:\"/liveroom/hb\",kZegoTaskLiveSendRoomBigIM:\"/liveroom/send_big_room_message\",kZegoTaskLiveGetRoomBigIM:\"/liveroom/get_big_room_message\",kZegoTaskLiveRoomGetUserUpdateInfo:\"/liveroom/get_user_update_info\",kZegoTaskLiveRoomGetRoomMessage:\"/liveroom/get_room_message\",kZegoTaskLiveRoomSendRoomMessage:\"/liveroom/send_room_message\",kZegoTaskLiveRoomSendCustomCommand:\"/liveroom/send_custom_command\",kZegoTaskLiveRoomGetCustomCommand:\"/liveroom/get_custom_command\",kZegoTaskLiveRoomSendStreamExtraInfo:\"/liveroom/send_stream_extra_info\",kZegoTaskLiveRoomGetStreamExtraInfo:\"/liveroom/get_stream_extra_info\",kZegoTaskLiveRoomGetStreamUpdateInfo:\"/liveroom/get_stream_update_info\",kZegoTaskPublishStart:\"/sdk/start_publish\",kZegoTaskRePublish:\"/sdk/republish\",kZegoTaskPublishStop:\"/sdk/stop_publish\",kZegoTaskPlayStart:\"/sdk/start_play\",kZegoTaskRePlay:\"/sdk/replay\",kZegoTaskPlayStop:\"/sdk/stop_play\",kZegoTaskMixStart:\"/mix/start_mix\",kZegoTaskMixStop:\"/mix/stop_mix\",kZegoTaskMixConfig:\"/mix/config_mix\",kZegoTaskEnumDevices:\"/sdk/enum_devices\",kZegoTaskSetDebug:\"/sdk/set_debug\",kZegoTaskSetLog:\"/sdk/set_log_config\",kZegoTaskUseVideoDevice:\"/sdk/use_video_device\",kZegoTaskUseAudioDevice:\"/sdk/use_audio_device\",kZegoTaskCheckSystemRequirements:\"/sdk/check_system\",kZegoTaskMutePublishVideo:\"/sdk/mute_publish_video\",kZegoTaskMutePublishAudio:\"/sdk/mute_publish_audio\",kZegoTaskRemoteCameraUpdate:\"/sdk/remote_camera_update\",kZegoTaskRemoteMicUpdate:\"/sdk/remote_mic_update\",kZegoTaskGetSoundLevel:\"/sdk/get_sound_level\",kZegoTaskStopSoundLevel:\"/sdk/stop_sound_level\",kZegoTaskAddPublishCdnUrl:\"/sdk/add_publish_cdn_url\",kZegoTaskRemovePublishCdnUrl:\"/sdk/remove_publish_cdn_url\",kZegoTaskClearPublishCdnUrl:\"/sdk/clear_publish_cdn_url\",kZegoTaskCreateStream:\"/sdk/create_stream\",kZegoTaskDestroyStream:\"/sdk/destroy_stream\",kZegoTaskScreenSharingEnded:\"/sdk/screen_share_end\",kZegoTaskVideoDeviceChanged:\"/sdk/video_device_state_changed\",kZegoTaskAudioDeviceChanged:\"/sdk/audio_device_state_changed\",kZegoTaskDeviceError:\"/sdk/device_error\",kZegoEventPublishStat:\"/sdk/publish_stat_report\",kZegoEventPlayStat:\"/sdk/play_stat_report\",kZegoSetPublishConstraints:\"/sdk/set_publish_stream_constraints\"},t.errorList={kOK:0,kEnd:1,kNoneAppIdError:10000101,kNotLoginError:{code:10000105,message:\"sdk error, not login room\"},kPublishBadNameError:10000106,kInvalidParamError:{code:10001001,message:\"sdk error, invalid param.\"},kInvalidChannelError:10001002,kNullPointerError:10001003,kInvalidUserIDError:10001004,kInvalidRoomIDError:10001005,kNoFreeChannelError:10001101,kFormatUrlError:10001102,kInvalidExtraUrlError:10001103,kNoPushIpError:10001104,kUnmatchStreamIDError:10002001,kUnmatchSeqError:{code:10002002,message:\"sdk error, unmatch seq\"},kNoneSeqError:10002003,kUnmatchStateError:10002004,kRedirectError:10003001,kOutOfMemeryError:10004001,kStartThreadError:10004002,kStartRequestError:10005001,kStartUpdateStreamInfoError:10006001,kNoMultiRoomLoginRole:10007001,kMultiRoomIDMappingOther:10007002,kNetWorkProbeNoUrl:10007003,kNetWorkProbeStopPublish:10007004,kNetWorkProbeStopPlay:10007005,kFetalError1:10007101,kFetalError2:10007102,kFetalError3:10007103,kFetalError4:10007104,kFetalError5:10007105,kFetalError6:10007106,kFetalError7:10007107,kSDKNoMoudleFunction:10008001,kDeviceError:10009001,kNetworkNotConnectError:11000101,kNetworkDnsResolveError:11000404,kEngineCreateError:12101001,kEngineStatusError:12101002,kEngineStartError:12101003,kDeniedMaxRetryError:12101004,kDeniedDisableSwitchLineError:12101005,kEngineNoPlayDataError:12102001,kEngineNoPublishDataError:12102002,kEngineUnknownError:122e5,kEngineConnectServerError:12200001,kEngineRtmpHandshakeError:12200002,kEngineRtmpAppConnectError:12200003,kEngineRtmpCreateStreamError:12200004,kEngineRtmpPublishBadNameError:12200005,kEngineServerDisconnectError:12200006,kEngineRtpConnectServerError:12200100,kEngineRtpHelloTimeoutError:12200101,kEngineRtpCreateSessionTimeoutError:12200102,kEngineRtpCreateSessionFailError:12200103,kEngineRtpPlayOrPublishTimeoutError:12200104,kEngineRtpPlayOrPublishDeniedError:12200105,kEngineRtpTimeoutError:12200106,kEngineRtpDecryptError:12200107,kEngineRtpDecryptNotSupport:12200108,kEngineRtpSockError:12200109,kEngineHttpFlvProtocolError:12200200,kEngineHttpFlvHttpCodeError:12200201,kEngineHttpFlvParseFlvError:12200202,kEngineHttpFlvServerDisconnectError:12200203,kEngineHttpFlvRedirectError:12200204,kPlayStreamNotExistError:12301004,kMediaServerForbidError:12301011,kMediaServerPublishBadNameError:12301012,kMediaServerStopPublishError:12301014,kConfigDecryptError:20000001,kConfigOfflineError:20000002,kConfigDomainError:20000003,kConfigMediaNetworkNoneError:20000004,kConfigMediaNetworkNoUrlError:20000005,kConfigServerCouldntConnectError:21200007,kConfigServerTimeoutError:21200028,kConfigServerSslCaCertError:21200060,kDispatchServerInvalidError:30000001,kDispatchNoIpError:30000404,kDispatchServerCouldntConnectError:31200007,kDispatchServerTimeoutError:31200028,kDispatchServerSslCaCertError:31200060,kDispatchNotChangedError:32000001,kDispatchEmptyPublishIpsError:32001002,kDispatchEmptyPlayIpsError:32001003,kDispatchStreamNotExistError:32001004,kDispatchAgentTimeoutError:35500001,kDispatchAgentDroppedError:35500002,kLogicServerNoUrlError:40000404,kLogicServerNoIpError:40000405,kLogicServerNoStreamInfoError:40000406,kLogicServerFetalError1:40700001,kLogicServerCouldntConnectError:41200007,kLogicServerTimeoutError:41200028,kLogicServerSslCaCertError:41200060,kLoginAgentTimeoutError:45500001,kLoginAgentDroppedError:45500002,kLiveRoomRequestParamError:50001001,kLiveRoomHBTimeoutError:{code:50001002,message:\"liveroom error, hb timeout\"},kLiveRoomNoPushServerAddrError:50001003,kLiveRoomNoPushCryptoKeyError:50001004,kLiveRoomNoPushTokenError:50001005,kLiveRoomAutoRetryMaxTimeOut:50001006,kLiveRoomRetryRightNow:50001009,kLiveRoomWaitNetOKWillRetry:50001010,kLiveRoomLogoutWhenLogining:50001011,kLiveRoomLogoutUserCancel:50001012,kLiveRoomHBErrorNoResp:50001050,kLiveRoomHBErrorByHttpTiemout:50001051,kLiveRoomReliableMessageParseBufError:50001200,kLiveRoomReliableMessageTransChannelError:50001201,kLiveRoomReliableUserMessageBufEmpty:50001202,kLiveRoomReliableUserMessageParseBufError:50001203,kLiveRoomGetUserListParseBufError:50001204,kLiveRoomHttpNullPtrError:50001205,kLiveRoomMultiZPushSessionIDNotMatchError:50005021,kLiveRoomMultiLimitRoomCountError:50005022,kLiveRoomCouldntConnectError:51200007,kLiveRoomTimeoutError:51200028,kLiveRoomSslCaCertError:51200060,kLiveRoomInvalidRspError:51400003,kLiveRoomInputParamsError:52000002,kLiveRoomRoomAuthError:52000101,kLiveRoomRoomNotExistError:52000104,kLiveRoomUserNotExistError:52000105,kLiveRoomSetStreamInfoError:52000123,kLiveRoomStreamInfoNotExist:52000138,kLiveRoomSessionError:52000141,kLiveRoomQpsLimitError:52000201,kLiveRoomLuaSessionError:52001001,kLiveRoomAddUserError:52001002,kLiveRoomDelUserError:52001003,kLiveRoomAddTransError:52001009,kLiveRoomMaxUserCountError:52001105,kLiveRoomPublishBadNameError:52001012,kLiveRoomRequiredReloginError:52002001,kLiveRoomThirdTokenAuthError:52002002,kLiveRoomNetBrokenTimeoutError:52002003,kLiveRoomAgentTimeoutError:55500001,kLiveRoomAgentDroppedError:55500002,kRoomConnectError:60001001,kRoomDoHandShakeReqError:60001002,kRoomDoLoginReqError:60001003,kRoomTimeoutError:60001004,kRoomHbTimeoutError:60001005,kRoomStartConnectError:60001006,kRoomReconnectFailError:60001008,kRoomLoginZPushNoCryptoKey:60001009,kRoomLoginCheckMD5Fail:60001010,kRoomRetryIPOver:60001011,kRoomRetryActiveIPError:60001012,kRoomSendLoginNoZPushRsp:60001013,kRoomDoSendLoginMultiRoomReqError:60001014,kRoomZPushTcpClosed:60001015,kRoomConnectErrorQuic:60001016,kRoomInvalidSocketError:60002001,kRoomInvalidRspError:60003001,kRoomDecodeSignError:62001001,kRoomDecodeLoginError:62001002,kRoomReplayAttacksError:62002001,kRoomThirdTokenAuthError:62002002,kRoomLoginCreateUserError:62010001,kRoomLoginSameCreateUserError:62010002,kRoomStatusTimeoutError:62010005,kRoomStatusRspError:62010006,kRoomDispatchTokenBuildError:62030011,kRoomDispatchTokenDecodeError:62030012,kRoomDispatchTokenInvalidError:62030013,kRoomDispatchTokenExpiredError:62030014,kRoomMultipleLoginKickoutError:{code:63000001,message:\"zpush multiple login kickout\"},kRoomManualKickoutError:{code:63000002,message:\"zpush manual kickout\"},kRoomSessionErrorKickoutError:{code:63000003,message:\"zpush room session error\"},kRoomDispatchError:64000001,kRoomDispatchResultNotMatch:64000002,kRoomNoDispatchToken:64000003,kRoomSdkZpushError:65000001,kMixStreamNoneMixConfigError:80000001,kMixStreamCouldntConnectError:81200007,kMixStreamTimeoutError:81200028,kMixStreamSslCaCertError:81200060,kMixStreamFailError:{code:82000001,message:\"failure\"},kMixStreamInputError:{code:82000002,message:\"input params error\"},kMixStreamAuthError:{code:82000003,message:\"Auth Failure\"},kMixStreamNotExistError:{code:82000150,message:\"mix stream not exist\"},kMixStreamStartMixError:{code:82000151,message:\"mix stream fail\"},kMixStreamStopMixError:{code:82000152,message:\"unmix stream fail\"},kMixStreamInputFormatError:{code:82000155,message:\"mix stream input format error\"},kMixStreamOutputFormatError:{code:82000156,message:\"mix stream output format error\"},kMixStreamNotOpenError:{code:82000157,message:\"mix not open\"},kMixStreamInputExceedError:{code:82000158,message:\"mix stream input exceed\"},kMixStreamDispatchError:{code:82000159,message:\"mix_dispatch fail\"},kMixStreamStopMixOwnerError:{code:82000160,message:\"unmix owner fail\"},kMixStreamWaterMarkParamError:{code:82000170,message:\"water mark params error\"},kMixStreamWaterMarkImageError:{code:82000171,message:\"water mark image empty\"},kMixStreamQpsOverloadError:{code:82000190,message:\"mix_start qps overload\"},kMixStreamAgentTimeoutError:85500001,kMixStreamAgentDroppedError:85500002,kInitSdkError:{code:2001100001,message:\"login but init sdk wrong\"},kScreenSharingFail:{code:2001100002,message:\"screen share fail\"},kEnumerateDevicesFail:{code:2001100003,message:\"enumerate devices fail\"},kMixVideocError:{code:2001100004,message:\"mix video code type wrong\"},kWxGetSettingFail:{code:2001100005,message:\"wx getsetting fail\"},kDevicesDetectError:{code:2001100006,message:\"devices detect error\"},kVideoCodecDetectError:{code:2001100007,message:\"videoCodec detect error\"},kMixStopFail:{code:2001100008,message:\"stop mix stream fail\"},kLoginTimeoutError:{code:2001110001,message:\"login timeout\"},kSendMsgTimeout:{code:2001110002,message:\"send customsg timeout.\"},kLiveRoomDisconnect:{code:2001110003,message:\"network is broken and login fail.\"},kMsgFrequencyLimited:{code:2001110004,message:\"send msg freq error\"},kLiveRoomNotLoginError:{code:2001110005,message:\"liveroom not login\"},kLiveRoomMessageParseError:{code:2001110006,message:\"message parse error\"},kLiveRoomMessageNoneError:{code:2001110007,message:\"message none error\"},kBrowserNotSupport:{code:2001120001,message:\"browser do not support\"},kHttpsRequired:{code:2001120002,message:\"https or localhost required\"},kDispatchError:{code:2001120003,message:\"dispatch request error\"},kDispatchTimeout:{code:2001120004,message:\"dispatch request timeout\"},kTokenError:{code:2001120005,message:\"login token error\"},kSendSessionTimeout:{code:2001120006,message:\"send session request timeout\"},kCreateSessionError:{code:2001120007,message:\"create session error\"},kCreateOfferError:{code:2001120008,message:\"create offer error\"},kSetLocalDescError:{code:2001120009,message:\"setLocalDescription error\"},kSendMediaDescTimeout:{code:2001120010,message:\"send mediaDesc timeout\"},kServerMediaDescTimeout:{code:2001120011,message:\"waiting server mediaDesc timeout\"},kServerMediaDescError:{code:2001120012,message:\"server mediaDesc type error\"},kSetRemoteDescError:{code:2001120013,message:\"other side offer error\"},kSendCandidateTimeout:{code:2001120014,message:\"sendIceCandidate error\"},kServerCandidateTimeout:{code:2001120015,message:\"waiting candidate timeout\"},kServerCandidateError:{code:2001120016,message:\"recv candidate error\"},kSessionClosed:{code:2001120017,message:\"server session closed\"},kMediaConnectionFailed:{code:2001120018,message:\"Iice Connection state failed\"},kMediaConnectionClosed:{code:2001120019,message:\"ice connection state closed\"},kWebsocketError:{code:2001120020,message:\"network error\"},kConstraintError:{code:2001120021,message:\"constraint error\"},kMediaConnectionDisconnected:{code:2001120022,message:\"ice connection state disconnected\"},kServerNegoTimeout:{code:2001120023,message:\"negotiation timeout\"},kLocalStreamError:{code:2001120024,message:\"local stream error\"},kPublishConstraintsNotSupport:{code:2001120025,message:\"publish constraints is not supported\"},kGetSoundLevelError:{code:2001120026,message:\"get sound level error\"},kPublishStreamNotFound:{code:2001120027,message:\"publish stream not found\"},kPublisherRepeatError:{code:2001120028,message:\"publisher already exist, publish repeat\"},kPlayerRepeatError:{code:2001120029,message:\"player already exist, play repeat\"},kStopWhenPublishing:{code:2001120030,message:\"stop publish when publishing error\"},kStopWhenPlaying:{code:2001120031,message:\"stop play when playing error\"},kPublishRetryFail:{code:2001120032,message:\"publish retry fail\"},kPlayRetryFail:{code:2001120033,message:\"play retry fail\"},kUrlsNone:{code:2001120034,message:\"url none\"},kIsPublishing:{code:2001120035,message:\"stream is publishing\"},kIsPlaying:{code:2001120035,message:\"stream is pulling\"},kDecodeAudioDataFail:{code:2001120036,message:\"decode audio fail\"},kNoPreviewBeforePublish:{code:2001120037,message:\"stream is not created by zego\"},kDeviceChangeError:{code:2001130038,message:\"publish error by device change\"},kNoVideo:{code:2001130039,message:\"video is false\"},kNoAudio:{code:2001130040,message:\"audio is false\"},kTrackNotFound:{code:2001130041,message:\"track not found\"}},t.codeErrMap={1101e3:\"kInitSdkError\",1100001:\"kInvalidParamError\",1103001:\"kInvalidParamError\",1104001:\"kInvalidParamError\",1000014:\"kInvalidParamError\",1000015:\"kInvalidParamError\",1000016:\"kInvalidParamError\",1101001:\"kInvalidParamError\",1002005:\"kInvalidParamError\",1002006:\"kInvalidParamError\",1002007:\"kInvalidParamError\",1002008:\"kInvalidParamError\",1002009:\"kInvalidParamError\",1002010:\"kInvalidParamError\",1002011:\"kInvalidParamError\",1002012:\"kInvalidParamError\",1002013:\"kInvalidParamError\",1103010:\"kScreenSharingFail\",1103011:\"kEnumerateDevicesFail\",1103029:\"kConstraintError\",1103040:\"kPublishStreamNotFound\",1103041:\"kDeviceChangeError\",1103044:\"kNoPreviewBeforePublish\",1103045:\"kNoVideo\",1103046:\"kNoAudio\",1103047:\"kTrackNotFound\",1000002:\"kNotLoginError\",1005001:\"kInvalidParamError\",1005002:\"kInvalidParamError\",1005003:\"kInvalidParamError\",1005005:\"kInvalidParamError\",1005006:\"kInvalidParamError\",1005020:\"kInvalidParamError\",1005021:\"kInvalidParamError\",1005067:\"kInvalidParamError\",1005011:\"kMixStopFail\",1005023:\"kMixVideocError\",1102001:\"kLiveRoomHBTimeoutError\",1002031:\"kLoginTimeoutError\",1002053:\"kLiveRoomDisconnect\",1109001:\"kMsgFrequencyLimited\",2002000001:\"kInvalidParamError\",2002000002:\"kBrowserNotSupport\",2002000003:\"kDispatchError\",2002000004:\"kDispatchTimeout\",2002000005:\"kTokenError\",2002000006:\"kSendSessionTimeout\",2002000007:\"kCreateSessionError\",2002000008:\"kCreateOfferError\",2002000009:\"kSetLocalDescError\",2002000010:\"kSendMediaDescTimeout\",2002000011:\"kServerMediaDescTimeout\",2002000012:\"kServerMediaDescError\",2002000013:\"kSetRemoteDescError\",2002000014:\"kSendCandidateTimeout\",2002000015:\"kServerCandidateTimeout\",2002000016:\"kServerCandidateError\",2002000017:\"kSessionClosed\",2002000018:\"kMediaConnectionFailed\",2002000019:\"kMediaConnectionClosed\",2002000020:\"kWebsocketError\",2002000021:\"kConstraintError\",2002000022:\"kMediaConnectionDisconnected\",2002000023:\"kServerNegoTimeout\",2003000003:\"kDispatchError\",2003000004:\"kDispatchTimeout\",2003000005:\"kTokenError\",2003000006:\"kSendSessionTimeout\",2003000007:\"kCreateSessionError\",2003000008:\"kCreateOfferError\",2003000009:\"kSetLocalDescError\",2003000010:\"kSendMediaDescTimeout\",2003000011:\"kServerMediaDescTimeout\",2003000012:\"kServerMediaDescError\",2003000013:\"kSetRemoteDescError\",2003000014:\"kSendCandidateTimeout\",2003000015:\"kServerCandidateTimeout\",2003000016:\"kServerCandidateError\",2003000017:\"kSessionClosed\",2003000018:\"kMediaConnectionFailed\",2003000019:\"kMediaConnectionClosed\",2003000020:\"kWebsocketError\",2003000021:\"kConstraintError\",2003000022:\"kMediaConnectionDisconnected\",2003000023:\"kServerNegoTimeout\"}},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.exterErrorCodeMap=t.errorCodeList=t.internalErrList=void 0,t.internalErrList={SEND_MSG_TIMEOUT:{code:\"Error.Timeout\",msg:\"send customsg timeout.\"}},t.errorCodeList={NOT_LOGIN:{code:1000002,msg:\"not login room\"},STREAMID_TOO_LONG:{code:1000014,msg:\"stream ID is too long\"},STREAM_ID_NULL:{code:1000015,msg:\"streamID is empty\"},STREAM_ID_INVALID_CHARACTER:{code:1000016,msg:\"stream ID contains illegal characters\"},INPUT_PARAM:{code:1100001,msg:\"input parm error.\"},TIMEOUT:{code:1100002,msg:\"network timeout.\"},INIT_SDK_WRONG:{code:1101e3,msg:\"init sdk wrong\"},USER_ID_NULL:{code:1002005,msg:\"user ID is empty\"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:\"user ID contains illegal characters\"},USER_ID_TOO_LONG:{code:1002007,msg:\"user ID is too long\"},USER_NAME_NULL:{code:1002008,msg:\"username is empty\"},USER_NAME_TOO_LONG:{code:1002010,msg:\"username is too long\"},ROOM_ID_NULL:{code:1002011,msg:\"room ID is empty\"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:\"room ID contains illegal characters\"},ROOM_ID_TOO_LONG:{code:1002013,msg:\"room ID is too long\"},LOGIN_TIMEOUT:{code:1002031,msg:\"login timeout\"},ROOM_MAX_USER_COUNT:{code:1002034,msg:\"users logging into the room exceeds the maximum number\"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:\"kickout may be the same user ID login other\"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:\"network is broken and login fail.\"},MANUAL_KICKOUT:{code:1002055,msg:\"server has sent a signal to kick out\"},ROOM_INNER_ERROR:{code:1002099,msg:\"room internal error\"},HEARTBEAT_TIMEOUT:{code:1102001,msg:\"heartbeat timeout.\"},PARSE_JSON_ERROR:{code:1102011,msg:\"parse json error.\"},LOGIN_PROCESSING:{code:1102012,msg:\"login is processing.\"},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:\"liveroom request error.\"},ZPUSH_REQUEST_FAIL:{code:1102014,msg:\"zpush request fail.\"},LOGIN_STATE_WRONG:{code:1102015,msg:\"user login state is wrong.\"},TOKEN_ERROR:{code:1102016,msg:\"token error\"},DIAPATCH_ERROR:{code:1102017,msg:\"dispatch error\"},TOKEN_EXPIRED:{code:1102018,msg:\"token expired\"},SUBCMD_ERROR:{code:1102019,msg:\"subcmd error.\"},ZEGO_AUTH_ERROR:{code:1102020,msg:\"zego auth error.\"},BIZ_CHANNEL_ERROR:{code:1102021,msg:\"biz channel error.\"},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,msg:\"extra info of publshing stream is null\"},PUBLISHER_EXTRA_INFO_TOO_LONG:{code:1003051,msg:\"stream extra info is too long\"},PUBLISHER_PARAM:{code:1103001,msg:\"input parm error\"},PUBLISHER_BROWSER_NOT_SUPPORT:{code:1103002,msg:\"browser do not support\"},PUBLISHER_DISPATCH_FAIL:{code:1103003,msg:\"dispatch request error\"},PUBLISHER_SCREEN_FAILED:{code:1103010,msg:\"screen fail\"},ENUMERATE_DEVICES_FAIL:{code:1103011,msg:\"enumerate devices fail\"},PUBLISHER_DISPATCH_REQUEST_FAIL:{code:1103020,msg:\"dispatch request fail\"},PUBLISHER_SESSION_REQUEST_FAIL:{code:1103021,msg:\"session request fail\"},PUBLISHER_CREATE_OFFER_ERROR:{code:1103022,msg:\"create offer error\"},PUBLISHER_SET_LOCAL_DESC_ERROR:{code:1103023,msg:\"setLocalDescription error\"},PUBLISHER_MEDIA_DESC_ERROR:{code:1103024,msg:\"mediaDesc error\"},PUBLISHER_SET_REMOTE_DESC_ERROR:{code:1103025,msg:\"other side offer error\"},PUBLISHER_CANDIDATE_ERROR:{code:1103026,msg:\"candidate error\"},PUBLISHER_SESSION_CLOSED:{code:1103027,msg:\"server session closed\"},PUBLISHER_MEDIA_CONNECTION_ERROR:{code:1103028,msg:\"ice connection error\"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,msg:\"constraint error\"},PUBLISHER_SERVER_NEGO_TIMEOUT:{code:1103030,msg:\"negotiation timeout\"},PUBLISH_NOT_PUBLISH:{code:1103040,msg:\"publisher not found\"},PUBLISH_DEVICE_OUT_ERR:{code:1103041,msg:\"device change \"},PUBLISH_SCREEN_CANCELED:{code:1103042,msg:\"screen canceled\"},PUBLISH_SCREEN_NOT_SUPPORT:{code:1103043,msg:\"screen not support\"},PUBLISH_NO_PREVIEW:{code:1103044,msg:\"stream is not from zego\"},VIDEO_DEVICE_FALSE:{code:1103045,msg:\"video is false\"},AUDIO_DEVICE_FALSE:{code:1103046,msg:\"audio is false\"},TRACK_NOT_FOUND:{code:1103047,msg:\"track is not found\"},DEVICE_NOT_FOUND:{code:1103048,msg:\"device is not found\"},PLAYER_PARAM:{code:1104001,msg:\"input parm error\"},PLAYER_DISPATCH_REQUEST_FAIL:{code:1104020,msg:\"dispatch request fail\"},PLAYER_SESSION_REQUEST_FAIL:{code:1104021,msg:\"session request fail\"},PLAYER_CREATE_OFFER_ERROR:{code:1104022,msg:\"create offer error\"},PLAYER_SET_LOCAL_DESC_ERROR:{code:1104023,msg:\"setLocalDescription error\"},PLAYER_MEDIA_DESC_ERROR:{code:1104024,msg:\"mediaDesc error\"},PLAYER_SET_REMOTE_DESC_ERROR:{code:1104025,msg:\"other side offer error\"},PLAYER_CANDIDATE_ERROR:{code:1104026,msg:\"candidate error\"},PLAYER_SESSION_CLOSED:{code:1104027,msg:\"server session closed\"},PLAYER_MEDIA_CONNECTION_ERROR:{code:1104028,msg:\"ice connection error\"},PLAYER_SERVER_NEGO_TIMEOUT:{code:1104030,msg:\"negotiation timeout\"},MIXER_NO_SERVICES:{code:1005e3,msg:\"no mix stream service\"},MIXER_TASK_ID_NULL:{code:1005001,msg:\"mixer task is null\"},MIXER_TASK_ID_TOO_LONG:{code:1005002,msg:\"task ID is too long\"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,msg:\"task ID contains illegal characters\"},MIXER_NO_OUTPUT_TARGET:{code:1005005,msg:\"task configuration does not specify output\"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,msg:\"stream output target is incorrect\"},MIXER_START_REQUEST_ERROR:{code:1005010,msg:\"start mixer task fail, possibly due to network reasons\"},MIXER_STOP_REQUEST_ERROR:{code:1005011,msg:\"stop mixer task fail, possibly due to network reasons\"},MIXER_NOT_OWNER_STOPMIXER:{code:1005012,msg:\" maxed task must be stopped by the start user of the task\"},MIXER_INPUTLIST_NULL:{code:1005020,msg:\"Mixed stream task input list is null\"},MIXER_OUTPUTLIST_NULL:{code:1005021,msg:\"Mixed stream task output list is null\"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,msg:\"invalid mixed stream task video configuration\"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,msg:\"more than the maximum number of input streams\"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,msg:\"Input stream does not exist\"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,msg:\"stream input parameters are wrong\"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,msg:\"more than the maximum number of output streams\"},MIXER_AUTHENTICATION_FAILED:{code:1005050,msg:\"mixed stream authentication failed\"},MIXER_WATERMARK_NULL:{code:1005061,mag:\"input watermark is null\"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,msg:\"input watermark parameter is wrong\"},MIXER_WATERMARK_URL_INVALID:{code:1005063,msg:\"illegal input watermark URL\"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,msg:\"illegal input background image URL\"},MIXER_INNER_ERROR:{code:1005099,msg:\"mixed stream internal error\"},DEVICE_ERROR_TYPE_UNPLUGGED:{code:1006006,msg:\"the device is unplugged\"},IM_CONTENT_NULL:{code:1009001,msg:\"message content is empty\"},IM_CONTENT_TOO_LONG:{code:1009002,msg:\"message content is too long\"},IM_SEND_FAILED:{code:1009010,msg:\"failed to send message\"},FREQ_LIMITED:{code:1109001,msg:\"frequency limited.\"}},t.exterErrorCodeMap={2002000001:\"PUBLISHER_PARAM\",2002000002:\"PUBLISHER_BROWSER_NOT_SUPPORT\",2002000003:\"PUBLISHER_DISPATCH_REQUEST_FAIL\",2002000004:\"PUBLISHER_DISPATCH_REQUEST_FAIL\",2002000005:\"TOKEN_ERROR\",2002000006:\"PUBLISHER_SESSION_REQUEST_FAIL\",2002000007:\"PUBLISHER_SESSION_REQUEST_FAIL\",2002000008:\"PUBLISHER_CREATE_OFFER_ERROR\",2002000009:\"PUBLISHER_SET_LOCAL_DESC_ERROR\",2002000010:\"PUBLISHER_MEDIA_DESC_ERROR\",2002000011:\"PUBLISHER_MEDIA_DESC_ERROR\",2002000012:\"PUBLISHER_SET_REMOTE_DESC_ERROR\",2002000013:\"PUBLISHER_SET_REMOTE_DESC_ERROR\",2002000014:\"PUBLISHER_CANDIDATE_ERROR\",2002000015:\"PUBLISHER_CANDIDATE_ERROR\",2002000016:\"PUBLISHER_CANDIDATE_ERROR\",2002000017:\"PUBLISHER_SESSION_CLOSED\",2002000018:\"PUBLISHER_MEDIA_CONNECTION_ERROR\",2002000019:\"PUBLISHER_MEDIA_CONNECTION_ERROR\",2002000020:\"PUBLISHER_MEDIA_CONNECTION_ERROR\",2002000022:\"PUBLISHER_MEDIA_CONNECTION_ERROR\",2002000021:\"PUBLISHER_CONSTRAINTS_ERROR\",2002000023:\"PUBLISHER_SERVER_NEGO_TIMEOUT\",2003000001:\"PLAYER_PARAM\",2003000003:\"PLAYER_DISPATCH_REQUEST_FAIL\",2003000004:\"PLAYER_DISPATCH_REQUEST_FAIL\",2003000005:\"TOKEN_ERROR\",2003000006:\"PLAYER_SESSION_REQUEST_FAIL\",2003000007:\"PLAYER_SESSION_REQUEST_FAIL\",2003000009:\"PLAYER_MEDIA_DESC_ERROR\",2003000010:\"PLAYER_SET_REMOTE_DESC_ERROR\",2003000008:\"PLAYER_CREATE_OFFER_ERROR\",2003000011:\"PLAYER_CREATE_OFFER_ERROR\",2003000012:\"PLAYER_SET_LOCAL_DESC_ERROR\",2003000014:\"PLAYER_CANDIDATE_ERROR\",2003000015:\"PLAYER_CANDIDATE_ERROR\",2003000016:\"PLAYER_CANDIDATE_ERROR\",2003000017:\"PLAYER_CANDIDATE_ERROR\",2003000020:\"PLAYER_SESSION_CLOSED\",2003000018:\"PLAYER_MEDIA_CONNECTION_ERROR\",2003000019:\"PLAYER_MEDIA_CONNECTION_ERROR\",2003000022:\"PLAYER_MEDIA_CONNECTION_ERROR\",2003000021:\"PLAYER_MEDIA_CONNECTION_ERROR\",2003000023:\"PLAYER_SERVER_NEGO_TIMEOUT\"}},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.playErrorList=t.publishErrorList=t.liveRoomErrorList=t.commonErrorList=void 0,t.commonErrorList={SUCCESS:{code:\"Success\",msg:\"success.\"},INIT:{code:2000000001,msg:\"init sdk wrong\"},PARAM:{code:2000000002,msg:\"input parm error.\"},DETECT_TIMEOUT:{code:2000000003,msg:\"detect time out\"},DETECT_FAIL:{code:2000000004,msg:\"detect fail\"},SCREEN:{code:2000000005,msg:\"screen sharing fail\"},DEVICE_NO_FOUND:{code:2000000006,msg:\"device no found\"},ENUMERATE_DEVICES_FAIL:{code:2000000007,msg:\"enumerate devices fail\"},NOT_LOGIN:{code:2000000008,msg:\"not login\"},STOP_MIX_FAIL:{code:2000000009,msg:\"stop mix stream fail\"},MIX_VIDEOC:{code:2000000010,msg:\"mix video code type wrong\"},MIX_OUTPUT:{code:2000000011,msg:\"mix output wrong\"}},t.liveRoomErrorList={SERVER:{code:0,msg:\"liverooom cmd error\"},HEARTBEAT_TIMEOUT:{code:2001000002,msg:\"heartbeat timeout.\"},LOGIN_TIMEOUT:{code:2001000003,msg:\"login timeout.\"},SEND_MSG_TIMEOUT:{code:2001000004,msg:\"send customsg timeout.\"},RESET_QUEUE:{code:2001000005,msg:\"msg waiting ack is clear when reset.\"},LOGIN_DISCONNECT:{code:2001000006,msg:\"network is broken and login fail.\"},UNKNOWN:{code:2001000007,msg:\"unknown error.\"},FREQ_LIMITED:{code:2001000008,msg:\"frequency limited.\"}},t.publishErrorList={PARAM:{code:2002000001,msg:\"input param error.\"},BROWSER_NOT_SUPPORT:{code:2002000002,msg:\"browser do not support\"},DISPATCH_ERROR:{code:2002000003,msg:\"dispatch request error\"},DISPATCH_TIMEOUT:{code:2002000004,msg:\"dispatch request timeout\"},TOKEN_ERROR:{code:2002000005,msg:\"login token error\"},SEND_SESSION_TIMEOUT:{code:2002000006,msg:\"send session request timeout\"},CREATE_SESSION_ERROR:{code:2002000007,msg:\"create session error\"},CREATE_OFFER_ERROR:{code:2002000008,msg:\"create offer error\"},SET_LOCAL_DESC_ERROR:{code:2002000009,msg:\"setLocalDescription error\"},SEND_MEDIA_DESC_TIMEOUT:{code:2002000010,msg:\"send mediaDesc timeout\"},SERVER_MEDIA_DESC_TIMEOUT:{code:2002000011,msg:\"waiting server mediaDesc timeout\"},SERVER_MEDIA_DESC_ERROR:{code:2002000012,msg:\"server mediaDesc type error\"},SET_REMOTE_DESC_ERROR:{code:2002000013,msg:\"other side offer error\"},SEND_CANDIDATE_TIMEOUT:{code:2002000014,msg:\"sendIceCandidate error\"},SERVER_CANDIDATE_TIMEOUT:{code:2002000015,msg:\"waiting candidate timeout\"},SERVER_CANDIDATE_ERROR:{code:2002000016,msg:\"recv candidate error\"},SESSION_CLOSED:{code:2002000017,msg:\"server session closed\"},MEDIA_CONNECTION_FAILED:{code:2002000018,msg:\"ice Connection state failed\"},MEDIA_CONNECTION_CLOSED:{code:2002000019,msg:\"ice connection state closed\"},WEBSOCKET_ERROR:{code:2002000020,msg:\"network error\"},CONSTRAINTS_ERROR:{code:2002000021,msg:\"constraint error\"},MEDIA_CONNECTION_DISCONNECTED:{code:2002000022,msg:\"ice connection state disconnected\"},SERVER_NEGO_TIMEOUT:{code:2002000023,msg:\"negotiation timeout\"}},t.playErrorList={PARAM:{code:2003000001,msg:\"input parm error.\"},REPEATED_PULL:{code:2003000002,msg:\"repeated pull same stream\"},DISPATCH_ERROR:{code:2003000003,msg:\"dispatch request error\"},DISPATCH_TIMEOUT:{code:2003000004,msg:\"dispatch request timeout\"},TOKEN_ERROR:{code:2003000005,msg:\"login token error\"},SEND_SESSION_TIMEOUT:{code:2003000006,msg:\"send session request timeout\"},CREATE_SESSION_ERROR:{code:2003000007,msg:\"create session error\"},CREATE_OFFER_ERROR:{code:2003000008,msg:\"create offer error\"},SERVER_MEDIA_DESC_TIMEOUT:{code:2003000009,msg:\"wating server mediaDesc timeout\"},SET_REMOTE_DESC_ERROR:{code:2003000010,msg:\"other side offer error\"},CREATE_ANSWER_ERROR:{code:2003000011,msg:\"create offer error\"},SET_LOCAL_DESC_ERROR:{code:2003000012,msg:\"setLocalDescription error\"},SEND_MEDIA_DESC_TIMEOUT:{code:2003000013,msg:\"send mediaDesc timeout\"},SEND_CANDIDATE_ERROR:{code:2003000014,msg:\"send candidate error\"},SEND_CANDIDATE_TIMEOUT:{code:2003000015,msg:\"send candidate timeout\"},SERVER_CANDIDATE_TIMEOUT:{code:2003000016,msg:\"waiting candidate timeout\"},SERVER_CANDIDATE_ERROR:{code:2003000017,msg:\"recv candidate error\"},MEDIA_CONNECTION_FAILED:{code:2003000018,msg:\"ice Connection state failed\"},MEDIA_CONNECTION_CLOSED:{code:2003000019,msg:\"ice connection state closed\"},SESSION_CLOSED:{code:2003000020,msg:\"server session closed\"},WEBSOCKET_ERROR:{code:2003000021,msg:\"network error\"},MEDIA_CONNECTION_DISCONNECTED:{code:2002000022,msg:\"ice connection state disconnected\"},SERVER_NEGO_TIMEOUT:{code:2002000023,msg:\"negotiation timeout\"}}},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoWebSocket=void 0;var s=function(){function e(e,t){this.url=e,this.protocol=t||null,this.readyState=3,this._websocket=wx.connectSocket({url:e}),this.init()}return e.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(t){e.readyState=e._websocket.readyState,\"function\"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose((function(t){e.readyState=e._websocket.readyState,\"function\"==typeof e.onclose&&e.onclose(t)})),e._websocket.onMessage((function(t){\"function\"==typeof e.onmessage&&e.onmessage(t)})))})),this._websocket.onError((function(t){e.readyState=e._websocket.readyState,\"function\"==typeof e.onerror&&e.onerror(t)})))},e.prototype.onopen=function(e){},e.prototype.onerror=function(e){},e.prototype.onclose=function(e){},e.prototype.onmessage=function(e){},e.prototype.send=function(e){this._websocket&&this._websocket.send({data:e})},e.prototype.close=function(){this._websocket&&this._websocket.close()},e}();t.ZegoWebSocket=s},function(e,t,r){var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoExpressEngine=void 0;var i=r(8),a=r(11),n=r(6),l=r(0),d=r(13),u=r(21),h=r(1),g=r(5),c=r(22),p=r(2),m=r(3),_=r(4),C=function(e){function t(t,r){var s=e.call(this)||this;s.preferPlaySourceType=l.ENUM_PLAY_SOURCE_TYPE.ultra,s.preferPublishSourceType=l.ENUM_DISPATCH_TYPE.ultra,s.currentPlaySourceType=l.ENUM_DISPATCH_TYPE.cdn,s.mixStreamList={},s.ultraPlaySourceType=\"rtmp_v2\",s.stateCenter=new u.StateCenter;var o=s.logger=new a.LoggerWechat(s.stateCenter);s.dataReport=new c.ZegoDataReport(s.logger),s.streamCenter=new i.ZegoStreamCenterWechat(s.logger,s.stateCenter,s.dataReport),s.stateCenter.logger=o;var n=p.getReportSeq();s.dataReport.newReport(n),s.stateCenter.clientType=\"xcx\",h.ClientUtil.setDebug(r,s.stateCenter),h.ClientUtil.checkConfigParam(t,r,s.logger)?(s.stateCenter.appid=t,\"string\"==typeof r?(s.stateCenter.server=r,s.stateCenter.serverBak=r):Array.isArray(r)&&r.length>0&&(s.stateCenter.server=r[0],s.stateCenter.serverBak=r[1]||r[0]),s.stateCenter.configOK=!0):(s.logger.error(\"zc.0 init sdk error\"),s.dataReport.addMsgInfo(n,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message})),s.init(),s.logger.setSessionInfo(s.stateCenter.appid,\"\",\"\",\"\",\"\",l.PROTO_VERSION);try{var d=wx.getSystemInfoSync(),g={brand:d.brand,model:d.model,system:d.system,platform:d.platform,version:d.version,SDKVersion:d.SDKVersion};s.dataReport.addMsgInfo(n,{system_info:g})}catch(e){s.logger.warn(\"zc.0 get system info error\")}return s.dataReport.uploadReport(n,m.eventList.kZegoTaskInitSetting),s}return o(t,e),t.prototype.getSocket=function(e){return new n.ZegoWebSocket(e)},t.prototype.on=function(e,t){return this.bindListener(e,t)},t.prototype.off=function(e,t){return this.deleteListener(e,t)},t.prototype.setPreferPlaySourceType=function(e){return this.logger.debug(\"zc.p.sppst.0 call\"),e!==l.ENUM_PLAY_SOURCE_TYPE.cdn&&e!==l.ENUM_PLAY_SOURCE_TYPE.ultra?(this.logger.error(\"zc.p.sppst.0 sourceType can be number 0 or 1, whick can be represented auto or ultra\"),!1):(this.preferPlaySourceType=e,this.logger.debug(\"zc.p.sppst.0 call success\"),!0)},t.prototype.setPreferPublishSourceType=function(e,t){return this.logger.debug(\"zc.p.sppst.1 call\"),e!==l.ENUM_DISPATCH_TYPE.cdn&&e!==l.ENUM_DISPATCH_TYPE.ultra&&e!==l.ENUM_DISPATCH_TYPE.customUrl?(this.logger.error(\"zc.p.sppst.1 sourceType only can be number 0 1 2\"),!1):e!==l.ENUM_DISPATCH_TYPE.customUrl||\"string\"==typeof t&&\"\"!=t?(this.preferPublishSourceType=e,this.customCdnUrl=t,this.logger.debug(\"zc.p.sppst.1 call success\"),!0):(this.logger.error(\"zc.p.sppst.1 customUrl must be string and not empty\"),!1)},t.prototype.startPlayingStream=function(e,t){var r=this;return new Promise((function(s,o){r.logger.info(\"zc.p.sps.0 call\");var i=p.getReportSeq();if(r.stateCenter.reportSeqList.startPlay[e]=i,r.dataReport.newReport(i,m.eventList.kZegoTaskPlayStart),void 0===e||\"\"===e)return r.logger.error(\"zc.p.sps.0 streamID required\"),r.dataReport.uploadReport(i,void 0,m.errorList.kInvalidParamError,\"stream id required\"),o(_.errorCodeList.STREAM_ID_NULL),!1;if(\"string\"!=typeof e)return r.logger.error(\"zc.p.sps.0 streamID must be string and not empty\"),r.dataReport.uploadReport(i,void 0,m.errorList.kInvalidParamError,\"stream id type error\"),delete r.stateCenter.reportSeqList.startPlay[e],o(m.errorList.kInvalidParamError),!1;if(e.length>l.MAX_STREAM_ID_LENGTH){var a=\"stream id length limit\";return r.logger.error(\"zc.sps.0 \"+a),r.dataReport.uploadReport(i,void 0,m.errorList.kInvalidParamError,a),delete r.stateCenter.reportSeqList.startPlay[e],o(_.errorCodeList.STREAMID_TOO_LONG),!1}if(!h.ClientUtil.checkIllegalCharacters(e)){a=\"stream ID contains illegal characters\";return r.logger.error(\"zc.sps.0 \"+a),r.dataReport.uploadReport(i,void 0,m.errorList.kInvalidParamError,a),delete r.stateCenter.reportSeqList.startPlay[e],o(_.errorCodeList.STREAM_ID_INVALID_CHARACTER),!1}return r.stateCenter.customPlayUrl&&0!=r.stateCenter.customPlayUrl.length?(console.error(\"stateCenter.customPlayUrl\"),r.streamCenter.updatePlayingState(e,t?t.streamParams:void 0,!0)?(r.streamCenter.playErrorCallBackList[e]=function(e,t){o({code:e,msg:t})},r.streamCenter.startPlayingStream(e,r.stateCenter.customPlayUrl,1)):(r.logger.error(\"zc.p.sps.0 cannot start play\"),o(m.errorList.kPlayerRepeatError),!1)):r.stateCenter.isLogin()?r.streamCenter.updatePlayingState(e,t?t.streamParams:void 0,!0)?(r.streamCenter.onPlayStateUpdate(l.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,msg:\"\"}),h.ClientUtil.logReportCallback(\"kZegoTaskPlayStart\"+e,r.dataReport,i,r.stateCenter.reportList),r.dataReport.addMsgInfo(i,{stream_id:e}),t&&t.streamParams&&r.dataReport.addMsgInfo(i,{params:t.streamParams}),!t||\"CDN\"!=t.sourceType&&\"BGP\"!=t.sourceType||(r.setPreferPlaySourceType(l.ENUM_SOURCE_TYPE[t.sourceType]),r.dataReport.addMsgInfo(i,{source_type:t.sourceType})),r.streamCenter.playSuccessCallBackList[e]=function(e,t){h.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+e,r.stateCenter.reportList)&&h.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+e,r.stateCenter.reportList)(p.REPORT_ACTION.eventEnd,\"get_play_url\"),s({streamID:e,url:t})},r.streamCenter.playErrorCallBackList[e]=function(t,s){h.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+e,r.stateCenter.reportList)&&h.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+e,r.stateCenter.reportList)(p.REPORT_ACTION.eventEnd,\"get_play_url\"),o({code:t,msg:s})},t&&t.isMix?(r.mixStreamList[e]={urltra_url_rtmp:null},void r.fetchPlayStreamUrl(e,\"rtmp_cdn\")):(h.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+e,r.stateCenter.reportList)&&h.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+e,r.stateCenter.reportList)(p.REPORT_ACTION.eventStart,\"get_play_url\"),void(r.preferPlaySourceType==l.ENUM_PLAY_SOURCE_TYPE.cdn?r.startPlayingStreamFromCDN(e):r.startPlayingStreamFromBGP(e)))):(r.logger.error(\"zc.p.sps.0 cannot start play\"),o(m.errorList.kPlayerRepeatError),!1):(r.logger.info(\"zc.p.sps.0 not login\"),r.dataReport.addMsgInfo(i,{error:m.errorList.kNotLoginError.code,message:m.errorList.kNotLoginError.message}),r.dataReport.uploadReport(i),void o(_.errorCodeList.NOT_LOGIN))}))},t.prototype.stopPlayingStream=function(e){this.logger.info(\"zc.p.sps.1.0 call\");var t=p.getReportSeq();if(this.dataReport.newReport(t,m.eventList.kZegoTaskPlayStop),this.dataReport.addMsgInfo(t,{stream_id:e}),\"string\"!=typeof e||\"\"==e)return this.logger.error(\"zc.p.sps.1.0 stream ID must be string and not empty\"),this.dataReport.addMsgInfo(t,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message}),void this.dataReport.uploadReport(t);var r=this.streamCenter.playerList[e];for(var s in r&&r.state!==l.ENUM_PLAY_STATE.stop&&this.streamCenter.onPlayStateUpdate(l.ENUM_PLAY_STATE_UPDATE.error,e,{code:0,msg:\"\"}),this.streamCenter.stopPlayingStream(e),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[s]===e){delete this.stateCenter.streamUrlMap[s];break}this.mixStreamList[e]&&delete this.mixStreamList[e],this.dataReport.uploadReport(t),this.logger.info(\"zc.p.sps.1.0 call success\")},t.prototype.startPublishingStream=function(e,t){var r=this;return new Promise((function(s,o){r.logger.info(\"zc.p.sps.1 call\");var i=p.getReportSeq();if(r.stateCenter.reportSeqList.startPublish[e]=i,r.dataReport.newReport(i,m.eventList.kZegoTaskPublishStart),void 0===e||\"\"===e)return r.logger.error(\"zc.p.sps.1 streamID no found\"),r.dataReport.addMsgInfo(i,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message}),r.dataReport.uploadReport(i),delete r.stateCenter.reportSeqList.startPublish[e],void o(_.errorCodeList.STREAM_ID_NULL);if(\"string\"!=typeof e)return r.logger.error(\"zc.p.sps.1 streamID mast be string and not empty\"),r.dataReport.addMsgInfo(i,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message}),r.dataReport.uploadReport(i),delete r.stateCenter.reportSeqList.startPublish[e],void o(_.errorCodeList.INPUT_PARAM);if(e.length>l.MAX_STREAM_ID_LENGTH){var a=\"stream id length limit\";return r.logger.error(\"zc.p.sps.1 \"+a),r.dataReport.uploadReport(i,void 0,m.errorList.kInvalidParamError,a),delete r.stateCenter.reportSeqList.startPublish[e],o(_.errorCodeList.STREAMID_TOO_LONG),!1}if(!h.ClientUtil.checkIllegalCharacters(e)){a=\"stream ID contains illegal characters\";return r.logger.error(\"zc.p.sps.1 \"+a),r.dataReport.uploadReport(i,void 0,m.errorList.kInvalidParamError,a),delete r.stateCenter.reportSeqList.startPublish[e],o(_.errorCodeList.STREAM_ID_INVALID_CHARACTER),!1}return r.stateCenter.customUrl&&0!=r.stateCenter.customUrl.length?(r.stateCenter.publishStreamList[e]={state:l.ENUM_PUBLISH_STREAM_STATE.waiting_url,extra_info:t&&t.extraInfo?t.extraInfo:null},r.streamCenter.updatePublishingState(e,t&&t.streamParams?t.streamParams:void 0,!0)?(r.streamCenter.onPublisherStreamUrlUpdate=function(e,t){s({streamID:e,url:t})},r.streamCenter.startPublishingStream(e,r.stateCenter.customUrl,1)):(r.logger.error(\"zc.p.sps.1 cannot start publish\"),o(m.errorList.kPublisherRepeatError),!1)):r.stateCenter.isLogin()?r.streamCenter.updatePublishingState(e,t&&t.streamParams?t.streamParams:void 0,!0)?(h.ClientUtil.logReportCallback(\"kZegoTaskPublishStart\"+e,r.dataReport,i,r.stateCenter.reportList),r.streamHandler.onPublishStateUpdate(l.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,msg:\"\"}),r.dataReport.addMsgInfo(i,{stream_id:e}),t&&(t.streamParams&&r.dataReport.addMsgInfo(i,{params:t.streamParams}),t.extraInfo&&r.dataReport.addMsgInfo(i,{extra_info:t.extraInfo})),!t||\"CDN\"!=t.sourceType&&\"BGP\"!=t.sourceType||(r.setPreferPublishSourceType(l.ENUM_SOURCE_TYPE[t.sourceType]),r.dataReport.addMsgInfo(i,{source_type:t.sourceType})),r.stateCenter.publishStreamList[e]={state:l.ENUM_PUBLISH_STREAM_STATE.waiting_url,extra_info:t&&t.extraInfo?t.extraInfo:null},r.logger.info(\"zc.p.sps.1 fetch stream url\"),h.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+e,r.stateCenter.reportList)&&h.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+e,r.stateCenter.reportList)(p.REPORT_ACTION.eventStart,\"get_publish_url\"),r.streamCenter.onPublisherStreamUrlUpdate=function(e,t){h.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+e,r.stateCenter.reportList)&&h.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+e,r.stateCenter.reportList)(p.REPORT_ACTION.eventEnd,\"get_publish_url\"),s({streamID:e,url:t})},r.streamCenter.onPublisherStreamUrlFail=function(t,s){h.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+e,r.stateCenter.reportList)&&h.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+e,r.stateCenter.reportList)(p.REPORT_ACTION.eventEnd,\"get_publish_url\"),o({code:t,msg:s})},void r.fetchPublishStreamUrl(e)):(r.logger.error(\"zc.p.sps.1 cannot start publish\"),o(m.errorList.kPublisherRepeatError),!1):(r.logger.error(\"zc.p.sps.1 not login\"),r.dataReport.addMsgInfo(i,{error:m.errorList.kNotLoginError.code,message:m.errorList.kNotLoginError.message}),r.dataReport.uploadReport(i),void o(_.errorCodeList.NOT_LOGIN))}))},t.prototype.getNextUrl=function(e){if(\"string\"==typeof e&&\"\"!=e)return this.streamCenter.getNextUrl(e);this.logger.error(\"zc.p.gnu stream ID must be string and not empty\")},t.prototype.setCustomSignalUrl=function(e,t){if(void 0===t&&(t=!0),this.logger.debug(\"zc.p.scs.0 call: \"+e),!e||0==e.length)return this.logger.error(\"zc.p.scs.0 param error\"),!1;var r=!0;e.forEach((function(e){return 0!=e.indexOf(\"rtmp://\")&&(r=!1)})),r?t?this.stateCenter.customUrl=e:this.stateCenter.customPlayUrl=e:this.logger.error(\"zc.p.scs.0 url is not correct\")},t.prototype.stopPublishingStream=function(e){this.logger.info(\"zc.p.sps.1.1 call\");var t=p.getReportSeq();if(this.dataReport.newReport(t,m.eventList.kZegoTaskPublishStop),this.dataReport.addMsgInfo(t,{stream_id:e}),\"string\"!=typeof e||\"\"==e)return this.logger.error(\"zc.p.sps.1.1 stream ID must be string and not empty\"),this.dataReport.addMsgInfo(t,{error:m.errorList.kInvalidParamError.code,message:m.errorList.kInvalidParamError.message}),void this.dataReport.uploadReport(t);this.streamCenter.stopPublishingStream(e);var r=this.streamCenter.playerList[e];r&&r.state!==l.ENUM_PLAY_STATE.stop&&this.streamHandler.onPublishStateUpdate(l.ENUM_PUBLISH_STATE_UPDATE.error,e,{code:0,msg:\"\"}),this.stateCenter.publishStreamList[e]&&(this.stateCenter.publishStreamList[e].state>=l.ENUM_PUBLISH_STREAM_STATE.update_info&&this.updateStreamInfo(e,l.ENUM_STREAM_SUB_CMD.liveEnd),delete this.stateCenter.publishStreamList[e]),this.stateCenter.streamUrlMap[e]&&delete this.stateCenter.streamUrlMap[e],this.dataReport.uploadReport(t),this.logger.debug(\"zc.p.sps.1.1 call success\")},t.prototype.updatePlayerState=function(e,t){this.logger.debug(\"zc.p.upe.0 call\"),this.streamCenter.updatePlayerState(e,t)},t.prototype.updatePlayerNetStatus=function(e,t){this.logger.debug(\"zc.p.upns.0 call\"),this.streamCenter.updatePlayerNetStatus(e,t)},t.prototype.startPlayingStreamFromCDN=function(e){this.logger.debug(\"zc.p.spsfc.0 call\");for(var t=null,r=0;r<this.stateCenter.streamList.length;r++)if(this.stateCenter.streamList[r].stream_id===e){t=this.stateCenter.streamList[r].urls_rtmp||[];break}return!t||t.length<=0?(this.logger.error(\"zc.p.spsfc.0 cannot find stream url,Please check if CDN is configured \"),this.streamCenter.onPlayStateUpdate(l.ENUM_PLAY_STATE_UPDATE.error,e,{code:m.errorList.kUrlsNone.code,msg:m.errorList.kUrlsNone.message}),this.streamCenter.playErrorCallBackList[e]({code:m.errorList.kUrlsNone.code,msg:m.errorList.kUrlsNone.message}),!1):(this.currentPlaySourceType=l.ENUM_DISPATCH_TYPE.cdn,this.logger.debug(\"zc.p.spsfc.0 play stream\"),this.doPlayStream(e,t,this.currentPlaySourceType))},t.prototype.startPlayingStreamFromBGP=function(e){return this.currentPlaySourceType=l.ENUM_DISPATCH_TYPE.ultra,this.logger.info(\"zc.p.sps.0 fetch stream url\"),this.fetchPlayStreamUrl(e,this.ultraPlaySourceType),!0},t.prototype.fetchPublishStreamUrl=function(e){var t=this;if(this.logger.debug(\"fpsu.0 call\"),this.stateCenter.isLogin()){this.logger.info(\"fpsu.0 send fetch publish request\");var r=\"\";this.preferPublishSourceType==l.ENUM_DISPATCH_TYPE.cdn?r=\"cdn\":this.preferPublishSourceType==l.ENUM_DISPATCH_TYPE.ultra&&(r=\"bgp\");var s={stream_id:e,url_type:this.ultraPlaySourceType,publish_type:r,header_kvs:[{key:\"grpc-metadata-push\",value:this.customCdnUrl||\"\"}]};this.socketCenter.registerRouter(\"stream_publish\",(function(e){t.handleFetchStreamPublishUrlRsp(e)}));var o=this.socketCenter.sendMessage(\"stream_publish\",s);-1==o?(this.streamHandler.onPublishStateUpdate(l.ENUM_PUBLISH_STATE_UPDATE.error,e,g.liveRoomErrorList.SERVER),this.streamCenter.stopPublishingStream(e)):this.stateCenter.streamUrlMap[o]=e,this.logger.debug(\"fpsu.0 call success\")}else this.logger.error(\"fpsu.0 state error\")},t.prototype.fetchPlayStreamUrl=function(e,t){var r=this;if(this.logger.debug(\"fsu.0 call\"),this.stateCenter.isLogin()){this.logger.info(\"fsu.0 send fetch request\");var s={stream_ids:[e],url_type:t};this.socketCenter.registerRouter(\"stream_url\",(function(e){r.handleFetchStreamUrlRsp(e)}));var o=this.socketCenter.sendMessage(\"stream_url\",s,void 0,(function(e,t){r.stateCenter.streamUrlMap[t]?r.streamCenter.onPlayStateUpdate(l.ENUM_PLAY_STATE_UPDATE.error,r.stateCenter.streamUrlMap[t],e):r.logger.info(\"fsu.0 already stop play\")}));-1==o?(this.logger.error(\"fsu.0 \"+g.liveRoomErrorList.SERVER.msg),this.streamCenter.onPlayStateUpdate(l.ENUM_PLAY_STATE_UPDATE.error,e,g.liveRoomErrorList.SERVER)):this.stateCenter.streamUrlMap[o]=e,this.streamCenter.playerList[e]&&(this.streamCenter.playerList[e].seq=o),this.logger.debug(\"fsu.0 call success\")}else this.logger.info(\"fsu.0 state error\")},t.prototype.updateStreamInfo=function(e,t,r,s){var o=this;this.logger.debug(\"usi.0 call\");var i=\"\";null!=r&&\"string\"==typeof r&&(i=r);var a={stream_id:e,extra_info:i},n={sub_cmd:t,stream_msg:JSON.stringify(a)};this.socketCenter.registerRouter(\"stream\",(function(e){o.handleStreamUpdateRsp(e)})),this.socketCenter.sendMessage(\"stream\",n,void 0,s),this.logger.debug(\"usi.0 call success cmd \"+t)},t.prototype.handleStreamUpdateRsp=function(e){if(this.stateCenter.isLogin())if(0==e.body.err_code){this.logger.debug(\"hsur.0 stream seq \"+this.stateCenter.streamSeq+\" server seq \"+e.body.stream_seq),this.stateCenter.streamSeq=e.body.stream_seq;for(var t=0;t<e.body.stream_info.length;t++){var r=e.body.stream_info[t].stream_id;if(!this.stateCenter.publishStreamList[r])return void this.logger.info(\"hsur.0 stream is not exist\");this.stateCenter.publishStreamList[r].state==l.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.stateCenter.publishStreamList[r].state=l.ENUM_PUBLISH_STREAM_STATE.publishing,this.streamHandler.onPublishStateUpdate(l.ENUM_PUBLISH_STATE_UPDATE.start,r,{code:0,msg:\"\"}))}}else this.logger.info(\"hsur.0 stream update error \"+e.body.err_code);else this.logger.info(\"hsur.0 not login\")},t.prototype.doPlayStream=function(e,t,r){return this.logger.debug(\"zc.p.dps.0 call\"),!t||t.length<=0?(this.streamCenter.onPlayStateUpdate(l.ENUM_PLAY_STATE_UPDATE.error,e,{code:m.errorList.kUrlsNone.code,msg:m.errorList.kUrlsNone.message}),!1):(this.streamCenter.startPlayingStream(e,t,r),!0)},t.prototype.handleFetchStreamPublishUrlRsp=function(e){this.logger.debug(\"hfspur.0 call\");var t=this.stateCenter.streamUrlMap[e.header.seq];if(t&&delete this.stateCenter.streamUrlMap[e.header.seq],0!==e.body.err_code)return this.logger.info(\"hfspur.0 server error=\",e.body.err_code),void(this.stateCenter.publishStreamList[t]&&(this.logger.error(\"hfspur.0 liveRoom cmd error\"),this.streamHandler.onPublishStateUpdate(l.ENUM_PUBLISH_STATE_UPDATE.error,t,{code:e.body.err_code+l.SERVER_ERROR_CODE,msg:\"\"}),this.streamCenter.stopPublishingStream(t)));if(e.body.stream_url_info){var r=e.body.stream_url_info.stream_id,s=e.body.stream_url_info.urls_ws;if(!this.stateCenter.publishStreamList[r])return void this.logger.error(\"hfspur.0 cannot find stream\");this.stateCenter.publishStreamList[r].url_rtmp=s,this.stateCenter.publishStreamList[r].state=l.ENUM_PUBLISH_STREAM_STATE.tryPublish,this.doPublishStream(r,s)}},t.prototype.handleFetchStreamUrlRsp=function(e){this.logger.debug(\"hfsur.0 call\");var t=this.stateCenter.streamUrlMap[e.header.seq];if(t&&delete this.stateCenter.streamUrlMap[e.header.seq],0!==e.body.err_code)return this.logger.debug(\"hfsur.0 server error=\",e.body.err_code),this.logger.error(\"hfsur.0 server error=  liveroom cmd error\"),void this.streamCenter.onPlayStateUpdate(l.ENUM_PLAY_STATE_UPDATE.error,t,{code:e.body.err_code+l.SERVER_ERROR_CODE,msg:\"\"});if(e.body.stream_url_infos&&e.body.stream_url_infos.length>0){for(var r=e.body.stream_url_infos[0].stream_id,s=e.body.stream_url_infos[0].urls_ws,o=this.currentPlaySourceType,i=!1,a=0;a<this.stateCenter.streamList.length;a++)if(this.stateCenter.streamList[a].stream_id==r){this.stateCenter.streamList[a].urltra_url_rtmp=s,i=!0;break}if(!i&&this.mixStreamList[r]&&(this.mixStreamList[r].urltra_url_rtmp=s,o=l.ENUM_DISPATCH_TYPE.cdn,i=!0),i||(this.logger.info(\"hfsur.0 cannot find streaminfo in existing stream list\"),this.stateCenter.streamList.push({stream_id:r,urltra_url_rtmp:s})),e.header.seq!==this.streamCenter.playerList[r].seq)return void this.logger.info(\"cb.cm.hfwur seq is not match, ignore \"+r);this.doPlayStream(r,s,o)}this.logger.debug(\"hfsur.0 call success\")},t.prototype.doPublishStream=function(e,t){return this.logger.debug(\"zc.p.dps.1 call\"),!t||t.length<=0?(this.streamHandler.onPublishStateUpdate(l.ENUM_PUBLISH_STATE_UPDATE.error,e,{code:m.errorList.kUrlsNone.code,msg:m.errorList.kUrlsNone.message}),!1):(this.logger.info(\"zc.p.dps.1 streamID: \"+e+\"streamUrl: \"+t),this.streamCenter.startPublishingStream(e,t,this.preferPublishSourceType),this.logger.debug(\"zc.p.dps.1 call success\"),!0)},t.prototype.setCDNInfo=function(e,t){},t.prototype.loginBodyData=function(){return{id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:this.stateCenter.token,version:l.PROTO_VERSION,room_name:this.stateCenter.roomid,user_state_flag:this.stateCenter.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:l.E_CLIENT_TYPE.ClientType_SmallPragram,third_token:this.stateCenter.third_token,user_count_limit:this.stateCenter.maxMemberCount,relate_service:this.stateCenter.relateService.join()||\"\"}},t.prototype.WebrtcOnPublishStateUpdateHandle=function(e,t,r){},t.prototype.checkSystemRequirements=function(){var e=this;return new Promise((function(t,r){var s=p.getReportSeq();e.dataReport.newReport(s,m.eventList.kZegoTaskCheckSystemRequirements);h.ClientUtil.isSupportLive((function(r){e.dataReport.addMsgInfo(s,{check_system:r}),e.dataReport.uploadReport(s),t(r)}),(function(t){e.dataReport.addMsgInfo(s,{error:m.errorList.kWxGetSettingFail.code,message:m.errorList.kWxGetSettingFail.message}),e.dataReport.uploadReport(s),r(t)}))}))},t}(d.BaseCenter);t.ZegoExpressEngine=C},function(e,t,r){var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoStreamCenterWechat=void 0;var i=r(9),a=r(10),n=r(1),l=r(2),d=r(3),u=0,h=1,g=2,c=0,p=1,m=function(e){function t(t,r,s){var o=e.call(this,t,r)||this;return o.playerList={},o.playerCount=0,o.playingList=[],o.publishingList=[],o.eventSeq=0,o.streamEventMap={},o.streamReportMap={},o.playerWaitingList=[],o.playerStatistics={},o.logger=t,o.dataReport=s,o.stateCenter=r,o}return o(t,e),t.prototype.updatePlayingState=function(e,t,r){if(null==e)return!1;if(r){var s=this.playerList[e],o=this.stateCenter.reportSeqList.startPlay[e];if(this.dataReport.eventStart(o,\"updatePlayingState\"),s)return this.logger.error(\"zsc.ups.0 player already exist\"),this.dataReport.eventEndWithMsgInfo(o,\"updatePlayingState\",{message:\"player already exist\"}),this.dataReport.uploadReport(o,void 0),delete this.stateCenter.reportSeqList.startPlay[e],!1;this.playerList[e]=new a.ZegoPlayWechat(this.logger,e,this,this.dataReport,this.stateCenter)}return this.updateStreamState(e,r,t,this.playingList),r?(this.streamEventMap[e]=this.stateCenter.reportSeqList.startPlay[e],this.eventSeq+=1,this.streamReportMap[e]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,\"GotPlayInfo\")):this.reportPlayEvent(e),!0},t.prototype.updatePublishingState=function(e,t,r){if(void 0===t&&(t=\"\"),void 0===r&&(r=!1),null==e)return!1;if(r){var s=this.playerList[e],o=this.stateCenter.reportSeqList.startPublish[e];if(this.dataReport.eventStart(o,\"updatePublishingState\"),s)return this.logger.error(\"zsc.ups.1 player already exist\"),this.dataReport.eventEndWithMsgInfo(o,\"updatePublishingState\",{message:\"player already exist\"}),this.dataReport.uploadReport(o,void 0),delete this.stateCenter.reportSeqList.startPublish[e],!1;this.playerList[e]=new a.ZegoPlayWechat(this.logger,e,this,this.dataReport,this.stateCenter)}return this.updateStreamState(e,r,t,this.publishingList),r?(this.streamEventMap[e]=this.stateCenter.reportSeqList.startPublish[e],this.eventSeq+=1,this.streamReportMap[e]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,\"GotPublishInfo\")):this.reportPublishEvent(e),!0},t.prototype.updateStreamState=function(e,t,r,s){if(e)if(r&&\"string\"==typeof r||(r=\"\"),1==t)s.push({streamID:e,params:r});else for(var o=0;o<s.length;o++)if(s[o].streamID==e){s.splice(o--,1);break}},t.prototype.isPlaying=function(){return 0!=this.playingList.length},t.prototype.isPublishing=function(){return 0!=this.publishingList.length},t.prototype.startPlayingStream=function(e,t,r){if(this.logger.debug(\"zpc.sps.0 call\"),this.streamEventMap[e]){var s=\"\";0==r?s=\"cdn\":1==r&&(s=\"ultra_src\"),n.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+e,this.stateCenter.reportList)&&(n.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+e,this.stateCenter.reportList)(l.REPORT_ACTION.addEventMsg,\"get_play_url\",\"type\",s),n.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+e,this.stateCenter.reportList)(l.REPORT_ACTION.addEventMsg,\"get_play_url\",\"urls\",t))}var o=this.streamReportMap[e];return o&&this.dataReport.eventEndWithMsg(o,\"GotPlayInfo\",{type:0==r?\"cdn\":\"ultra_src\",urls:t}),this.startPlayer(e,t,r,c)},t.prototype.startPlayer=function(e,t,r,s){var o=this.playerList[e];if(!o)return this.logger.error(\"zsc.sp.0 player don't exist\"),!1;var i=[];s==c?i=this.playingList:s==p&&(i=this.publishingList);for(var a=!1,n=\"\",l=0;l<i.length;l++)if(i[l].streamID==e){a=!0,n=i[l].params;break}if(!a)return this.logger.warn(\"zpc.sp.0 should not start\"),!1;if(o.urls=t,o.params=n,o.reconnectLimit=this.getReconnectLimit(r),o.dispatchType=r,o.playerType=s,o.playerSeq=this.streamEventMap[e],o.playerReportSeq=this.streamReportMap[e],!o)return this.logger.info(\"zpc.sp.0 new player failed\"),!1;++this.playerCount;var d=o.tryStartPlayer(0);return this.logger.debug(\"zpc.sp.0 call result:\",d),d},t.prototype.getNextUrl=function(e){var t=this;this.logger.info(\"zpc.gnu call\",e);var r,s=this.playerList[e];if(!s)return this.logger.error(\"zpc.gnu player don't exist\"),\"\";this.publishingList.find((function(t){return t.streamID===e}))?(r=!0,this.onPublishStateUpdate(l.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,msg:\"\"})):(r=!1,this.onPlayStateUpdate(g,e,{code:0,msg:\"\"}));var o=s.getPlayerUrl();if(r){if(!this.stateCenter.reportSeqList.startPublish[e]){var i=l.getReportSeq();this.stateCenter.reportSeqList.startPublish[e]=i,this.dataReport.newReport(i,d.eventList.kZegoTaskRePublish),s.pushBegin=!1,n.ClientUtil.registerCallback(\"kZegoTaskPublishStart\"+e,{success:function(e,r){for(var s=[],o=2;o<arguments.length;o++)s[o-2]=arguments[o];n.ClientUtil.dataReportEvent(t.dataReport,i,e,r,s)}},this.stateCenter.reportList)}}else if(!this.stateCenter.reportSeqList.startPlay[e]){var a=l.getReportSeq();this.stateCenter.reportSeqList.startPlay[e]=a,this.dataReport.newReport(a,d.eventList.kZegoTaskRePlay),s.playBegin=!1,n.ClientUtil.registerCallback(\"kZegoTaskPlayStart\"+e,{success:function(e,r){for(var s=[],o=2;o<arguments.length;o++)s[o-2]=arguments[o];n.ClientUtil.dataReportEvent(t.dataReport,a,e,r,s)}},this.stateCenter.reportList)}return o},t.prototype.stopPlayingStream=function(e){this.logger.debug(\"zpc.sps.1.0 call\"),null!=e&&(this.stopPlayer(e),this.updatePlayingState(e))},t.prototype.stopPlayer=function(e){var t=this.playerList[e];t&&(t.stopPlayer(),delete this.playerList[e],--this.playerCount),this.logger.debug(\"zpc.sp.1.0 call success\")},t.prototype.startPublishingStream=function(e,t,r){if(this.logger.debug(\"zpc.sps.1 call\"),this.streamEventMap[e]){var s=\"\";0==r?s=\"cdn\":1==r&&(s=\"ultra_src\"),n.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+e,this.stateCenter.reportList)&&(n.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+e,this.stateCenter.reportList)(l.REPORT_ACTION.addEventMsg,\"get_publish_url\",\"type\",s),n.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+e,this.stateCenter.reportList)(l.REPORT_ACTION.addEventMsg,\"get_publish_url\",\"urls\",t))}var o=this.streamReportMap[e];return o&&this.dataReport.eventEndWithMsg(o,\"GotPublishInfo\",{type:0==r?\"cdn\":\"ultra_src\",urls:t}),this.startPlayer(e,t,r,p)},t.prototype.stopPublishingStream=function(e){this.logger.debug(\"zpc.sps.1.1 call\"),null!=e&&(this.stopPlayer(e),this.updatePublishingState(e,\"\",!1))},t.prototype.updatePlayerState=function(e,t){var r=this.playerList[e];r?r.updateEvent(t):this.logger.error(\"zpc.upe.1.0 no player \"+e),this.logger.debug(\"zpc.upe.1.0 updatePlayerEvent success\")},t.prototype.updatePlayerNetStatus=function(e,t){var r=this.playerList[e];r?r.updatePlayerNetStatus(t):this.logger.error(\"zpc.upns.1.0 no player \"+e),this.logger.debug(\"zpc.upns.1.0 updatePlayerNetStatus success\")},t.prototype.reset=function(){this.logger.debug(\"zpc.r.0 call\");for(var e=0;e<this.playingList.length;e++)this.stopPlayingStream(this.playingList[e].streamID);for(var t=0;t<this.publishingList.length;t++)this.stopPublishingStream(this.publishingList[t].streamID);this.playerCount=0,this.playerList={},this.playerWaitingList=[],this.playerStatistics={},this.streamEventMap={},this.streamReportMap={},this.logger.debug(\"zpc.r.0 call success\")},t.prototype.reportPublishEvent=function(e,t){if(this.streamReportMap[e]){var r=this.streamReportMap[e];this.dataReport.addMsgExt(r,{stream:e,error:t}),this.dataReport.addMsgInfo(r,{itemtype:\"WXPublishStream\"}),this.dataReport.uploadReport(r,\"WXPublishStream\"),delete this.streamReportMap[e]}},t.prototype.reportPlayEvent=function(e,t){if(this.streamReportMap[e]){var r=this.streamReportMap[e];this.dataReport.addMsgExt(r,{stream:e,error:t}),this.dataReport.addMsgInfo(r,{itemtype:\"WXPlayStream\"}),this.dataReport.uploadReport(r,\"WXPlayStream\"),delete this.streamReportMap[e]}},t.prototype.onPlayStateUpdate=function(e,t,r){},t.prototype.onPlayQualityUpdate=function(e,t){},t.prototype.onPublishStateUpdate=function(e,t,r){},t.prototype.onPublishQualityUpdate=function(e,t){},t.prototype.onPublisherStreamUrlUpdate=function(e,t){},t.prototype.onPublisherStreamUrlFail=function(e,t){},t.prototype.onPlayerStreamUrlUpdate=function(e,t){},t.prototype.getReconnectLimit=function(e){return 1},t.prototype.onPlayerStart=function(e,t){this.logger.debug(\"ops.0 call\"),t==c?this.onPlayStateUpdate(u,e,{code:0,msg:\"\"}):t==p&&this.onPublishStateUpdate(u,e,0)},t.prototype.onPlayerStop=function(e,t,r){this.logger.debug(\"ops.1 call\"),t==c?(this.reportPlayEvent(e,r),this.logger.warn(\"ops.1 play error\"),this.onPlayStateUpdate(h,e,r)):t==p&&(this.reportPublishEvent(e,r),this.logger.warn(\"ops.1 publish error\"),this.onPublishStateUpdate(h,e,r))},t.prototype.onPlayerRetry=function(e,t){this.logger.debug(\"opr.0 call\"),t==c?this.onPlayStateUpdate(g,e,{code:0,msg:\"\"}):t==p&&this.onPublishStateUpdate(g,e,0)},t.prototype.onPlayerQuality=function(e,t,r){var s={video:{videoBitrate:t.videoBitrate,videoFPS:t.videoFPS,videoWidth:t.videoWidth,videoHeight:t.videoHeight},audio:{audioBitrate:t.audioBitrate}};r==c?this.onPlayQualityUpdate(e,s):r==p&&this.onPublishQualityUpdate(e,s)},t.prototype.onSoundLevelUpdate=function(e){},t.prototype.onStreamUrlUpdate=function(e,t,r){this.logger.debug(\"opuu.0 call\"),0==r?this.playSuccessCallBackList[e](e,t):this.onPublisherStreamUrlUpdate(e,t)},t.prototype.getTotalStreamId=function(e){return e},t.prototype.getRealStreamId=function(e){return e},t}(i.ZegoStreamCenter);t.ZegoStreamCenterWechat=m},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoStreamCenter=void 0;var s=function(){function e(e,t){this.playerList={},this.publisherList={},this.playSuccessCallBackList={},this.playErrorCallBackList={}}return e.prototype.onRemoteCameraStatusUpdate=function(e,t){},e.prototype.onRemoteMicStatusUpdate=function(e,t){},e.prototype.setSessionInfo=function(e,t,r,s){},e}();t.ZegoStreamCenter=s},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoPlayWechat=void 0;var s=r(1),o=r(3),i=r(0),a=r(2),n=0,l=2,d=function(){function e(e,t,r,s,o){this.urls=[],this.tryUrls=[],this.playUrlIndex=0,this.playUrlTryCount=0,this.currentUrl=null,this.retryIndex=0,this.reconnectCount=0,this.state=l,this.reconnectLimit=0,this.sourceType=0,this.playerType=0,this.playerSeq=0,this.playerReportSeq=0,this.publishQualitySeq=0,this.publishQualityCount=0,this.publishQulaityMaxCount=30,this.playQualitySeq=0,this.playQualityCount=0,this.playQulaityMaxCount=30,this.everSuccess=!1,this.pushBegin=!1,this.playBegin=!1,this.playerLogUploadTime=(new Date).getTime(),this.seq=-1,this.streamId=t,this.logger=e,this.streamCenter=r,this.dataReport=s,this.stateCenter=o}return e.prototype.resetPlayer=function(){this.state=l},e.prototype.newPlayer=function(){this.resetPlayer();var e=this.getCurrentPlayerUrl(),t=e;0!=this.params.length&&(t=e+\"?\"+this.params);var r=(new Date).getTime();return t=t.indexOf(\"?\")>-1?t+\"&zgseq=\"+r+\"&zgdid=\"+this.stateCenter.sessionid:t+\"?zgseq=\"+r+\"&zgdid=\"+this.stateCenter.sessionid,e!==this.currentUrl?(this.currentUrl=e,this.streamCenter.onStreamUrlUpdate(this.streamId,t,this.playerType)):this.streamCenter.onPlayerRetry(this.streamId,this.playerType),0==this.everSuccess?0==this.playerType?(this.dataReport.eventStart(this.playerReportSeq,\"PlayBegin\"),this.dataReport.addEventInfo(this.playerReportSeq,\"PlayBegin\",\"url\",t),this.tryUrls.push(t)):(this.dataReport.eventStart(this.playerReportSeq,\"PublishBegin\"),this.dataReport.addEventInfo(this.playerReportSeq,\"PublishBegin\",\"url\",t),this.tryUrls.push(t)):0==this.playerType?this.dataReport.addEventInfo(this.playerSeq,\"PlayRetry\",\"url\",t):this.dataReport.addEventInfo(this.playerSeq,\"PublishRetry\",\"url\",t),this.state=n,!0},e.prototype.stopPlayer=function(){0==this.playerType?this.dataReport.eventEndWithMsg(this.playerReportSeq,\"PlayStat\",{quality:this.playerInfo}):(this.dataReport.addEventInfo(this.playerReportSeq,\"PublishStat\",\"quality\",this.playerInfo),this.dataReport.eventEndWithMsg(this.playerReportSeq,\"PublishStat\",{quality:this.playerInfo}))},e.prototype.tryStartPlayer=function(e){for(;this.playUrlTryCount<this.urls.length;)if(++this.reconnectCount>this.reconnectLimit)this.playUrlTryCount++,this.playUrlIndex=(this.playUrlIndex+1)%this.urls.length,this.reconnectCount=0;else if(this.logger.info(\"zp.tsp.0 index: \"+this.playUrlIndex+\", url: \"+this.getCurrentPlayerUrl()),this.newPlayer())break;if(this.playUrlTryCount>=this.urls.length){this.logger.info(\"zp.tsp.0 stream: \"+this.streamId),this.resetPlayer();var t=\"\";0==this.playerType?t=\"PlayEnd\":1==this.playerType&&(t=\"PublishEnd\",this.reportQualityStatics());var r={error:e,reason:\"no url to retry\"};this.dataReport.addEvent(this.playerSeq,t,r),this.streamCenter.onPlayerStop(this.streamId,this.playerType,e)}},e.prototype.getPlayerUrl=function(){var e=this.urls[++this.retryIndex%this.urls.length],t=e;0!=this.params.length&&(t=e+\"?\"+this.params);var r=(new Date).getTime();return t=t.indexOf(\"?\")>-1?t+\"&zgseq=\"+r+\"&zgdid=\"+this.stateCenter.sessionid:t+\"?zgseq=\"+r+\"&zgdid=\"+this.stateCenter.sessionid,this.tryUrls.push(t),t},e.prototype.shouldRetryPlay=function(e){var t=e.detail.code;return 3001==t||3002==t||3003==t||3005==t},e.prototype.isPlayFailed=function(e){var t=e.detail.code;return-2301==t||2101==t||2102==t},e.prototype.shouldRetryPublish=function(e){var t=e.detail.code;return 3001==t||3002==t||3003==t||3004==t||3005==t},e.prototype.isPublishFailed=function(e){var t=e.detail.code;return-1301==t||-1302==t||-1303==t||-1304==t||-1305==t||-1306==t||-1307==t||-1308==t||-1309==t||-1310==t||-1311==t},e.prototype.updateEvent=function(e){if(0==this.playerType){if(this.playBegin||(this.playBegin=!0,s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventStart,\"play_begin\")),2004==e.detail.code)this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,\"PlayRetry\"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,\"PlayStat\"),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"play_begin\",\"try_urls\",this.tryUrls),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventEnd,\"play_begin\"),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventStart,\"play_state\"))),this.streamCenter.onPlayerStart(this.streamId,this.playerType);else if(2009==e.detail.code);else if(this.shouldRetryPlay(e));else if(this.isPlayFailed(e)){this.logger.info(\"zp.ue.0 play error: \"+this.streamId),this.resetPlayer();e.detail.code;s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"play_begin\",\"error_code\",e.detail.code),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"play_begin\",\"try_urls\",this.tryUrls),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventEnd,\"play_begin\"),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addMsgInfo,void 0,{error:o.errorList.kPlayRetryFail.code,message:o.errorList.kPlayRetryFail.message})),this.playBegin=!1,this.streamCenter.onPlayerStop(this.streamId,this.playerType,{code:e.detail.code,msg:\"play fail\"})}this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,\"PlayBegin\")}else 1==this.playerType&&(this.pushBegin||(this.pushBegin=!0,s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventStart,\"push_begin\")),1002==e.detail.code?(this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,\"PublishRetry\"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,\"PublishStat\"),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"push_begin\",\"try_urls\",this.tryUrls),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventEnd,\"push_begin\"),this.stateCenter.publishStreamList[this.streamId]&&this.stateCenter.publishStreamList[this.streamId].state==i.ENUM_PUBLISH_STREAM_STATE.tryPublish&&s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventStart,\"publish_state\"))),this.streamCenter.onPlayerStart(this.streamId,this.playerType)):this.shouldRetryPublish(e)||this.isPublishFailed(e)&&(this.logger.info(\"zp.ue.0 publish error: \"+this.streamId),this.resetPlayer(),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"push_begin\",\"error_code\",e.detail.code),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"push_begin\",\"try_urls\",this.tryUrls),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventEnd,\"push_begin\"),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addMsgInfo,void 0,{error:o.errorList.kPublishRetryFail.code,message:o.errorList.kPublishRetryFail.message})),this.pushBegin=!1,this.streamCenter.onPlayerStop(this.streamId,this.playerType,{code:e.detail.code,msg:\"publish fail\"})),this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,\"PublishBegin\"))},e.prototype.updatePlayerNetStatus=function(e){var t={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoHeight:e.detail.info.videoHeight,videoWidth:e.detail.info.videoWidth};if(this.playerInfo=t,1==this.playerType){var r={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoGOP:e.detail.info.videoGOP,netSpeed:e.detail.info.netSpeed,netJitter:e.detail.info.netJitter,videoWidth:e.detail.info.videoWidth,videoHeight:e.detail.info.videoHeight};if(0==this.publishQualitySeq&&(this.publishQualitySeq=a.getReportSeq(),this.dataReport.newReport(this.publishQualitySeq),this.dataReport.addMsgInfo(this.publishQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.publishQualitySeq,\"PublishQuality\",r),this.publishQualityCount+=1,this.publishQualityCount>=this.publishQulaityMaxCount)(new Date).getTime()-this.playerLogUploadTime>45e3&&(this.reportQualityStatics(),this.playerLogUploadTime=(new Date).getTime())}else if(0==this.playerType){r={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoGOP:e.detail.info.videoGOP,netSpeed:e.detail.info.netSpeed,netJitter:e.detail.info.netJitter,videoWidth:e.detail.info.videoWidth,videoHeight:e.detail.info.videoHeight};if(0==this.playQualitySeq&&(this.playQualitySeq=a.getReportSeq(),this.dataReport.newReport(this.playQualitySeq),this.dataReport.addMsgInfo(this.playQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.playQualitySeq,\"PlayQuality\",r),this.playQualityCount+=1,this.playQualityCount>=this.playQulaityMaxCount)(new Date).getTime()-this.playerLogUploadTime>45e3&&(this.reportPlayQualityStatics(),this.playerLogUploadTime=(new Date).getTime())}this.streamCenter.onPlayerQuality(this.streamId,t,this.playerType)},e.prototype.getCurrentPlayerUrl=function(){return this.urls[this.playUrlIndex%this.urls.length]},e.prototype.reportQualityStatics=function(){this.dataReport.addMsgInfo(this.publishQualitySeq,{itemtype:\"WXPublishStateUpdate\"}),this.dataReport.uploadReport(this.publishQualitySeq,o.eventList.kZegoEventPublishStat),this.publishQualityCount=0,this.publishQualitySeq=0},e.prototype.reportPlayQualityStatics=function(){this.dataReport.addMsgInfo(this.playQualitySeq,{itemtype:\"WXPlayStateUpdate\"}),this.dataReport.uploadReport(this.playQualitySeq,o.eventList.kZegoEventPlayStat),this.playQualityCount=0,this.playQualitySeq=0},e}();t.ZegoPlayWechat=d},function(e,t,r){var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,\"__esModule\",{value:!0}),t.LoggerWechat=void 0;var i=r(12),a=r(6),n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.openWebSocketLogServer=function(e){if(this.url!=e){if(this.url=e,this.stopWebSocketServer(),!e)return;this.websocket=new a.ZegoWebSocket(e),this.websocket.onopen=function(e){},this.websocket.onclose=function(e){},this.websocket.onmessage=function(e){},this.websocket.onerror=function(e){console.error(\"open log websocket error:\"+e)}}},t.prototype.SendHttpsLog=function(){var e=this;if(0!=this.logCacheSend.length){!this.existUserID&&this.stateCenter.idName&&this.logCacheSend.forEach((function(t){Array.isArray(t)&&t.forEach((function(r,s){var o=JSON.parse(r);o&&\"\"==JSON.parse(r).userid?(o.userid=e.stateCenter.idName,o.id_name=e.stateCenter.idName,t[s]=JSON.stringify(o)):e.existUserID=!0}))}));var t=this.logCacheSend.join(\"\\n\");wx.request({url:this.url,data:t,method:\"POST\",success:function(t){if(0!=t.data.length){var r=t&&t.data&&t.data.interval;\"number\"==typeof r&&e.logUploadInterval!==r&&(e.timeInterval=r,e.openHttpsLogServer(e.url))}},fail:function(e){console.log(\"send failed \"+e.statusCode)}}),this.logCacheSend=[]}},t.prototype.logReportParamList=function(e,t){var r=new Date,s=r.getFullYear()+\"/\";return s+=(i.D[r.getMonth()+1]||r.getMonth()+1)+\"/\",s+=(i.D[r.getDate()]||r.getDate())+\" \",s+=(i.D[r.getHours()]||r.getHours())+\":\",s+=(i.D[r.getMinutes()]||r.getMinutes())+\":\",s+=i.D[r.getSeconds()]||r.getSeconds(),s+=\".\"+r.getTime()%1e3,t.time=s,t.level=e,t.console=\"xcx\",t.appid=this.appid,t.room_id=this.roomid,t.roomid=this.roomid,t.userid=this.userid,t.id_name=this.userid,t.userName=this.userName,t.sessionid=this.sessionid,t.sdk_version=this.version,t.test_environment=this.stateCenter.testEnvironment,t.version=this.version,this.appid&&this.userid&&(t.event_id=this.appid+\"_\"+this.userid+\"_\"+t.event_time+\"_\"+t.seq),[JSON.stringify(t)]},t}(i.Logger);t.LoggerWechat=n},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.Logger=t.D=void 0;var s=r(0);t.D=[\"00\",\"01\",\"02\",\"03\",\"04\",\"05\",\"06\",\"07\",\"08\",\"09\"];var o=function(){function e(e){this.logLevel=s.ENUM_LOG_LEVEL.info,this.logRemoteLevel=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.existUserID=!1,this.stateCenter=e}return e.prototype.setLogLevel=function(e){this.logLevel<s.ENUM_LOG_LEVEL.debug||this.logLevel>s.ENUM_LOG_LEVEL.report?this.logLevel=s.ENUM_LOG_LEVEL.disable:this.logLevel=e},e.prototype.setRemoteLogLevel=function(e){this.logRemoteLevel<s.ENUM_LOG_LEVEL.debug||this.logRemoteLevel>s.ENUM_LOG_LEVEL.report?this.logRemoteLevel=s.ENUM_LOG_LEVEL.disable:this.logRemoteLevel=e},e.prototype.setSessionInfo=function(e,t,r,s,o,i){this.appid=e,this.roomid=t,this.sessionid=r,this.userid=s,this.userName=o,this.version=i},e.prototype.openLogServer=function(e){try{e.startsWith(\"wss:\")?(this.logType=s.ENUM_REMOTE_TYPE.websocket,this.openWebSocketLogServer(e)):e.startsWith(\"https:\")?(this.logType=s.ENUM_REMOTE_TYPE.https,this.openHttpsLogServer(e)):this.logType=s.ENUM_REMOTE_TYPE.disable}catch(e){this.error(JSON.stringify(e))}},e.prototype.stopLogServer=function(){this.logType==s.ENUM_REMOTE_TYPE.websocket?this.stopWebSocketServer():this.logType==s.ENUM_REMOTE_TYPE.https&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=s.ENUM_REMOTE_TYPE.disable},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.openHttpsLogServer=function(e){var t=this;this.url=e,e&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){t.SendHttpsLog()}),this.logUploadInterval)))},e.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},e.prototype.report=function(e){var t=this.logReportParamList(s.ENUM_LOG_LEVEL.report,e);this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=s.ENUM_LOG_LEVEL.report&&console.debug(t),this.RemoteLog(s.ENUM_LOG_LEVEL.report,t,!0)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.debug,e.join(\"\"));this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=s.ENUM_LOG_LEVEL.debug&&console.debug(r),this.log(s.ENUM_LOG_LEVEL.debug,r)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.info,e.join(\"\"));this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=s.ENUM_LOG_LEVEL.info&&console.info(r),this.log(s.ENUM_LOG_LEVEL.info,r)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.warn,e.join(\"\"));this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=s.ENUM_LOG_LEVEL.warn&&console.warn(r),this.log(s.ENUM_LOG_LEVEL.warn,r)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.error,e.join(\"\"));this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=s.ENUM_LOG_LEVEL.error&&(console.error(r),window?this.stateCenter.debug&&window.alert(e.join(\"\").substr(e.join(\"\").indexOf(\" \")+1,4500)):wx&&this.stateCenter.debug&&wx.showModal({title:\"\",content:e.join(\"\").substr(e.join(\"\").indexOf(\" \")+1,4500)})),this.log(s.ENUM_LOG_LEVEL.error,r)},e.prototype.log=function(e,t){this.logRemoteLevel!==s.ENUM_LOG_LEVEL.disable&&this.logRemoteLevel<=e&&this.RemoteLog(e,t)},e.prototype.RemoteLog=function(e,t,r){if(void 0===r&&(r=!1),\"\"!=this.url)if(this.logType==s.ENUM_REMOTE_TYPE.websocket)this.RemoteWebSocketLog(e,t);else if(this.logType==s.ENUM_REMOTE_TYPE.https)this.RemoteHttpsLog(e,t,r);else if(this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=e)for(this.logCacheSend.push(t);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()},e.prototype.RemoteWebSocketLog=function(e,t){if(\"string\"==typeof t&&t.length>4e3)console.info(\"log over maximum, ignore\");else if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState){var r=this.url;this.url=\"\",this.openLogServer(r),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)}else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var s=\"\",o=0;o<this.logCacheSend.length;o++)(s+this.logCacheSend[o]).length>4e3&&(this.websocket.send(s),s=\"\"),s=s+this.logCacheSend[o]+\"\\n\";t=s+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else console.warn(\"wrong socket state:\"+this.websocket.readyState),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.RemoteHttpsLog=function(e,t,r){this.logCacheSend.push(t),(this.logCacheSend.length>=this.logCacheMax||!0===r)&&this.SendHttpsLog()},e.prototype.logParamList=function(e,r){var s=new Date,o=s.getFullYear()+\"/\";o+=(t.D[s.getMonth()+1]||s.getMonth()+1)+\"/\",o+=(t.D[s.getDate()]||s.getDate())+\" \",o+=(t.D[s.getHours()]||s.getHours())+\":\",o+=(t.D[s.getMinutes()]||s.getMinutes())+\":\",o+=t.D[s.getSeconds()]||s.getSeconds(),o+=\".\"+s.getTime()%1e3;var i=r.substr(0,r.indexOf(\" \"));0==i.length&&(i=r);var a=r.substr(r.indexOf(\" \")+1,4500);0==a.length&&(a=\"\");var n={time:o,level:e,action:i,content:a,appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(n)},e}();t.Logger=o},function(e,t,r){var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,\"__esModule\",{value:!0}),t.BaseCenter=void 0;var i=r(14),a=r(0),n=r(15),l=r(16),d=r(17),u=r(18),h=r(19),g=r(20),c=r(4),p=r(1),m=r(2),_=r(3),C=function(e){function t(){return e.call(this)||this}return o(t,e),t.prototype.init=function(){this.bindSocketHandler(),this.bindStreamHandler(),this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler(),this.bindStreamCenterHandler()},t.prototype.bindSocketHandler=function(){var e=this;this.socketCenter=new n.SocketCenter(this.logger,this.stateCenter),this.socketCenter.registerRouter(\"push_signal\",(function(t){e.liveHandler.handlePushSignalMsg(t)})),this.socketCenter.getSocket=function(t){return e.getSocket(t)},this.socketCenter.handlePushKickout=function(t){e.logger.info(\"zb.cm.bsh.0  call hpk\");var r=m.getReportSeq();e.dataReport.newReport(r,_.eventList.kZegoTaskKickout),e.roomHandler.setRunState(a.ENUM_RUN_STATE.logout),e.roomHandler.resetRoom(),e.dataReport.addMsgInfo(r,{user_id:e.stateCenter.idName}),e.logger.error(\"zb.cm.bsh.0 kick out reason \"+t.body.reason);var s=p.ClientUtil.getKickoutError(t.body.reason);e.dataReport.addMsgInfo(r,{error:s.code,message:s.message}),e.dataReport.uploadReport(r),e.stateCenter.actionListener(\"roomStateUpdate\",e.stateCenter.roomid,\"DISCONNECTED\",c.errorCodeList[s.name].code,c.errorCodeList[s.name].msg),e.logger.debug(\"zb.cm.bsh.0  call hpk success\")},this.socketCenter.handlePushCustomMsg=function(t){e.messageHandler.handlePushCustomMsg(t)},this.socketCenter.handlePushUserStateUpdateMsg=function(t){e.roomHandler.handlePushUserStateUpdateMsg(t)},this.socketCenter.handlePushRoomMsg=function(t){var r=m.getReportSeq();e.dataReport.newReport(r),e.dataReport.addMsgInfo(r,{room_sid:t.header.session_id});var s=[];t.body.chat_data.forEach((function(t){var o={fromUser:{userID:t.id_name,userName:t.nick_name},message:t.msg_content,sendTime:t.send_time,messageID:t.msg_id};s.push(o),e.dataReport.addMsgInfo(r,{from_msg_id:t.id_name})})),e.dataReport.uploadReport(r,_.eventList.kZegoTaskLiveRoomGetRoomMessage),e.stateCenter.actionListener(\"IMRecvBroadcastMessage\",e.stateCenter.roomid,s)},this.socketCenter.handlePushMergeMsg=function(t){e.messageHandler.handlePushMergeMsg(t)},this.socketCenter.handlePushTransMsg=function(t){e.messageHandler.handlePushTransMsg(t)},this.socketCenter.handleBigImMsgRsp=function(t){e.messageHandler.handleBigImMsgRsp(t)}},t.prototype.bindStreamHandler=function(){var e=this;this.streamHandler=new d.StreamHandler(this.logger,this.stateCenter,this.socketCenter,this.dataReport),this.streamHandler.onStreamUpdated=function(t,r,s){var o=s.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo,urlsFLV:e.urlFlv,urlsRTMP:e.urlRtmp,urlsHLS:e.urlHls,urlsHttpsFLV:e.urlHttpsFlv,urlsHttpsHLS:e.urlHttpsHls}})),i=m.getReportSeq();if(e.dataReport.newReport(i,_.eventList.kZegoTaskLiveRoomGetStreamUpdateInfo),e.dataReport.addMsgInfo(i,{stream_update_type:1===r?\"added\":\"deleted\",update_stream:o}),e.dataReport.uploadReport(i),e.stateCenter.actionListener(\"roomStreamUpdate\",t,p.ClientUtil.getSteamUpdateType(r),o),1===r){var a=[];o.forEach((function(e){e.extraInfo&&a.push({streamID:e.streamID,user:e.user,extraInfo:e.extraInfo})})),a.length>0&&e.stateCenter.actionListener(\"streamExtraInfoUpdate\",t,a)}},this.streamHandler.onPublishStateUpdate=function(t,r,s){if(e.logger.info(\"zb.opsu \",r),\"xcx\"==e.stateCenter.clientType)0==t?(p.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+r,e.stateCenter.reportList)&&p.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+r,e.stateCenter.reportList)(m.REPORT_ACTION.eventEnd,\"publish_state\"),e.dataReport.uploadReport(e.stateCenter.reportSeqList.startPublish[r]),delete e.stateCenter.reportSeqList.startPublish[r],p.ClientUtil.unregisterCallback(\"kZegoTaskPublishStart\"+r,e.stateCenter.reportList)):1==t&&(e.dataReport.addMsgInfo(e.stateCenter.reportSeqList.startPublish[r],{error:s.code,message:s.msg}),e.dataReport.uploadReport(e.stateCenter.reportSeqList.startPublish[r]),delete e.stateCenter.reportSeqList.startPublish[r],p.ClientUtil.unregisterCallback(\"kZegoTaskPublishStart\"+r,e.stateCenter.reportList));else{r=e.streamCenter.getRealStreamId(r);var o=e.streamCenter.getTotalStreamId(r),i=e.stateCenter.reportSeqList.startPublish[o],a=e.streamCenter.publisherList[o];if(a&&a.publisher&&(0==t||1==t)&&i)if(0!==a.publisher.retrySeq){var n=a.publisher.retrySeq;e.dataReport.eventEndWithMsgInfo(n,\"PublishState\",{type:t}),1==t&&e.dataReport.addMsgInfo(n,{error:s.code,message:s.msg}),e.dataReport.uploadReport(n),delete e.stateCenter.reportSeqList.rePublish[o]}else e.dataReport.eventEndWithMsgInfo(i,\"PublishState\",{type:t}),1==t&&e.dataReport.addMsgInfo(i,{error:s.code,message:s.msg}),e.dataReport.uploadReport(i),delete e.stateCenter.reportSeqList.startPublish[o]}s.code&&c.exterErrorCodeMap[s.code]&&(s.code=c.errorCodeList[c.exterErrorCodeMap[s.code]].code),e.stateCenter.actionListener(\"publisherStateUpdate\",{state:p.ClientUtil.getPublisherStateType(t),streamID:r,errorCode:s.code,extendedData:s.msg})},this.streamHandler.onStreamExtraInfoUpdated=function(t,r){var s=r.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})),o=m.getReportSeq();e.dataReport.newReport(o,_.eventList.kZegoTaskLiveRoomGetStreamExtraInfo),e.dataReport.addMsgInfo(o,{update_stream:s}),e.dataReport.uploadReport(o),e.stateCenter.actionListener(\"streamExtraInfoUpdate\",t,s)},this.streamHandler.setCDNInfo=function(t,r){e.setCDNInfo(t,r)}},t.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler=new u.HeartBeatHandler(this.logger,this.stateCenter,this.socketCenter,this.dataReport),this.heartBeatHandler.onRecvReliableMessage=function(t){var r=t.map((function(e){return{key:e.trans_type,value:e.trans_data,updateUser:{userID:e.trans_idname,userName:e.trans_nickname},updateTime:e.trans_send_time}}));e.stateCenter.actionListener(\"roomExtraInfoUpdate\",e.stateCenter.roomid,r),t.forEach((function(t){e.stateCenter.actionListener(\"recvReliableMessage\",t.trans_type,t.trans_seq,t.trans_data)}))},this.heartBeatHandler.handleFetchStreamListRsp=function(t){e.streamHandler.handleFetchStreamListRsp(t)},this.heartBeatHandler.fetchUserList=function(){e.roomHandler.fetchUserList()},this.heartBeatHandler.onUpdateOnlineCount=function(t,r){e.stateCenter.actionListener(\"roomOnlineUserCountUpdate\",t,r)},this.heartBeatHandler.updateStreamInfo=function(t,r,s,o){void 0===s&&(s=\"\"),e.streamHandler.updateStreamInfo(t,r,s,o)},this.heartBeatHandler.hbLogout=function(t){e.logger.error(\"hhbr.0 \"+t.msg),e.stateCenter.actionListener(\"roomStateUpdate\",e.stateCenter.roomid,\"DISCONNECTED\",t.code,\"\")},this.heartBeatHandler.fetchReliableMessage=function(t,r){e.messageHandler.fetchReliableMessage(t,r)},this.heartBeatHandler.relogin=function(){e.roomHandler.relogin()}},t.prototype.bindRoomHandler=function(){var e=this;this.roomHandler=new l.RoomHandler(this.logger,this.stateCenter,this.socketCenter),this.roomHandler.loginSuccessCallBack=function(t,r){var s=r.body.hearbeat_interval<a.MINIUM_HEARTBEAT_INTERVAL?a.MINIUM_HEARTBEAT_INTERVAL:r.body.hearbeat_interval;e.stateCenter.loginHeartbeatTimer=setTimeout((function(){e.stateCenter.tryHeartbeatCount=0,e.stateCenter.heartbeatTimer&&clearTimeout(e.stateCenter.heartbeatTimer),e.heartBeatHandler.start(s)}),s),e.heartBeatHandler.resetCheckMessage(),e.heartBeatHandler.startCheckMessageTimeout(),e.streamCenter.setSessionInfo(e.stateCenter.appid,e.stateCenter.idName,e.stateCenter.token,e.stateCenter.testEnvironment),r.body.anchor_info&&e.stateCenter.actionListener(\"getAnchorInfo\",r.body.anchor_info.anchor_id_name,r.body.anchor_info.anchor_nick_name),r.body.online_count&&e.stateCenter.actionListener(\"roomOnlineUserCountUpdate\",e.stateCenter.roomid,r.body.online_count),e.logger.info(\"zb.cm.brh hls userStateUpdate \"+e.stateCenter.userStateUpdate),e.stateCenter.userStateUpdate&&(e.logger.info(\"zb.cm.brh hls fetch all new userlist\"),e.roomHandler.fetchUserList(t)),e.streamHandler.handleStreamStart(t,r)},this.roomHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.heartBeatHandler.resetCheckMessage(),e.resetStreamCenter()},this.roomHandler.onUserStateUpdate=function(t,r,s){var o=m.getReportSeq();e.dataReport.newReport(o,_.eventList.kZegoTaskLiveRoomGetUserUpdateInfo);var i=s.filter((function(t){return t.userID!==e.stateCenter.idName}));0!==i.length&&e.stateCenter.actionListener(\"roomUserUpdate\",t,r,i),e.dataReport.addMsgInfo(o,{user_update_type:\"ADD\"==r?\"added\":\"deleted\"})},this.roomHandler.onDisconnect=function(t){if(e.logger.error(\"zc.od.0 \"+t.msg),\"string\"==typeof t.code&&\"Error.Network\"===t.code)e.dataReport.addMsgInfo(e.stateCenter.reportSeqList.relogin,{error:_.errorList.kLiveRoomDisconnect.code,message:_.errorList.kLiveRoomDisconnect.message});else if(\"number\"==typeof t.code){var r=void 0;(r=t.code<2e9&&t.code>1e9||t.code<1e6?p.ClientUtil.decodeServerError(t.code,t.msg):_.codeErrMap[t.code])&&e.dataReport.addMsgInfo(e.stateCenter.reportSeqList.relogin,{error:r.code,message:r.message})}e.dataReport.uploadReport(e.stateCenter.reportSeqList.relogin),e.stateCenter.reportSeqList.relogin=0,p.ClientUtil.unregisterCallback(\"kZegoTaskReLoginRoom\",e.stateCenter.reportList),e.stateCenter.actionListener(\"roomStateUpdate\",e.stateCenter.roomid,\"DISCONNECTED\",t.code,\"\")},this.roomHandler.onConnecting=function(t){if(0===e.stateCenter.reportSeqList.login){var r=m.getReportSeq();e.stateCenter.reportSeqList.relogin=r,e.dataReport.newReport(r,_.eventList.kZegoTaskReLoginRoom),p.ClientUtil.logReportCallback(\"kZegoTaskReLoginRoom\",e.dataReport,r,e.stateCenter.reportList)}e.stateCenter.actionListener(\"roomStateUpdate\",e.stateCenter.roomid,\"CONNECTING\",t.code,t.msg)},this.roomHandler.fetchReliableMessage=function(t,r){e.messageHandler.fetchReliableMessage(t,r)},this.roomHandler.loginBodyData=function(){return e.loginBodyData()}},t.prototype.bindMessageHandler=function(){var e=this;this.messageHandler=new h.MessageHandler(this.logger,this.stateCenter,this.socketCenter,this.dataReport),this.messageHandler.onRecvCustomCommand=function(t,r,s,o){var i=m.getReportSeq();e.dataReport.newReport(i),e.dataReport.uploadReport(i,_.eventList.kZegoTaskLiveRoomGetCustomCommand),e.stateCenter.actionListener(\"IMRecvCustomCommand\",s,{userID:t,userName:r},o)},this.messageHandler.onRecvBigRoomMessage=function(t,r){var s=m.getReportSeq();e.dataReport.newReport(s);var o=[];t.forEach((function(e){var t={fromUser:{userID:e.idName,userName:e.nickName},message:e.content,sendTime:e.time,messageID:e.messageId};o.push(t)})),e.dataReport.uploadReport(s,_.eventList.kZegoTaskLiveGetRoomBigIM),e.stateCenter.actionListener(\"IMRecvBarrageMessage\",r,o)},this.messageHandler.onRecvReliableMessage=function(t){var r=t.map((function(e){return{key:e.trans_type,value:e.trans_data,updateUser:{userID:e.trans_idname,userName:e.trans_nickname},updateTime:e.trans_send_time}}));e.stateCenter.actionListener(\"roomExtraInfoUpdate\",e.stateCenter.roomid,r),t.forEach((function(t){e.stateCenter.actionListener(\"recvReliableMessage\",t.trans_type,t.trans_seq,t.trans_data)}))},this.messageHandler.relogin=function(){e.roomHandler.relogin()}},t.prototype.bindLiveHandler=function(){var e=this;this.liveHandler=new g.LiveHandler(this.logger,this.stateCenter,this.socketCenter),this.liveHandler.onRecvEndJoinLiveCommand=function(t,r,s,o){e.stateCenter.actionListener(\"recvEndJoinLiveCommand\",t,r,s,o)},this.liveHandler.onRecvInviteJoinLiveRequest=function(t,r,s,o){e.stateCenter.actionListener(\"RecvInviteJoinLiveRequest\",t,r,s,o)},this.liveHandler.onRecvJoinLiveRequest=function(t,r,s,o){e.stateCenter.actionListener(\"recvJoinLiveRequest\",t,r,s,o)}},t.prototype.bindStreamCenterHandler=function(){var e=this;this.streamCenter.onPlayStateUpdate=function(t,r,s){if(\"xcx\"==e.stateCenter.clientType)0==t?(p.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+r,e.stateCenter.reportList)&&p.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+r,e.stateCenter.reportList)(\"eventEnd\",\"play_state\"),e.dataReport.uploadReport(e.stateCenter.reportSeqList.startPlay[r]),delete e.stateCenter.reportSeqList.startPlay[r],p.ClientUtil.unregisterCallback(\"kZegoTaskPlayStart\"+r,e.stateCenter.reportList)):1==t&&(e.dataReport.uploadReport(e.stateCenter.reportSeqList.startPlay[r]),delete e.stateCenter.reportSeqList.startPlay[r],p.ClientUtil.unregisterCallback(\"kZegoTaskPlayStart\"+r,e.stateCenter.reportList)),e.stateCenter.actionListener(\"playerStateUpdate\",{state:p.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:s&&s.code,extendedData:s&&s.msg});else{r=e.streamCenter.getRealStreamId(r);var o=e.streamCenter.getTotalStreamId(r),i=e.stateCenter.reportSeqList.startPlay[o],a=e.streamCenter.playerList[o];if(a&&a.player&&(0==t||1==t)&&i)if(0!==a.player.retrySeq){var n=a.player.retrySeq;e.dataReport.eventEndWithMsgInfo(n,\"PlayState\",{type:t}),1==t&&s&&e.dataReport.addMsgInfo(n,{error:s.code,message:s.msg}),e.dataReport.uploadReport(n),delete e.stateCenter.reportSeqList.rePlay[o]}else e.dataReport.eventEndWithMsgInfo(i,\"PlayState\",{type:t}),1==t&&s&&e.dataReport.addMsgInfo(i,{error:s.code,message:s.msg}),e.dataReport.uploadReport(i),delete e.stateCenter.reportSeqList.startPlay[o];s.code&&c.exterErrorCodeMap[s.code]&&(s.code=c.errorCodeList[c.exterErrorCodeMap[s.code]].code),e.stateCenter.actionListener(\"playerStateUpdate\",{state:p.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:s&&s.code,extendedData:s&&s.msg})}},this.streamCenter.onPublishStateUpdate=function(t,r,s){e.onPublishStateUpdateHandle(t,r,s)},this.streamCenter.onPublishQualityUpdate=function(t,r){e.stateCenter.actionListener(\"publishQualityUpdate\",t,r)},this.streamCenter.onPlayQualityUpdate=function(t,r){e.stateCenter.actionListener(\"playQualityUpdate\",t,r)},this.streamCenter.onRemoteCameraStatusUpdate=function(t,r){var s=m.getReportSeq();e.dataReport.newReport(s,_.eventList.kZegoTaskRemoteCameraUpdate),e.dataReport.addMsgInfo(s,{stream_id:t,status:r}),e.dataReport.uploadReport(s),e.stateCenter.actionListener(\"remoteCameraStatusUpdate\",t,r)},this.streamCenter.onRemoteMicStatusUpdate=function(t,r){var s=m.getReportSeq();e.dataReport.newReport(s,_.eventList.kZegoTaskRemoteMicUpdate),e.dataReport.addMsgInfo(s,{stream_id:t,status:r}),e.dataReport.uploadReport(s),e.stateCenter.actionListener(\"remoteMicStatusUpdate\",t,r)},this.streamCenter.onSoundLevelUpdate=function(t){e.stateCenter.actionListener(\"soundLevelUpdate\",t)}},t.prototype.setLogConfig=function(e){this.logger.info(\"zb.cm.clf call\");var t=m.getReportSeq();if(this.dataReport.newReport(t),e.logLevel){var r=p.ClientUtil.getLogLevel(e.logLevel);r&&this.logger.setLogLevel(r),this.dataReport.addMsgInfo(t,{log_level:e.logLevel})}if(e.remoteLogLevel&&[0,1,2,3,99,100].includes(p.ClientUtil.getLogLevel(e.remoteLogLevel))&&(this.logger.setRemoteLogLevel(p.ClientUtil.getLogLevel(e.remoteLogLevel)),this.dataReport.addMsgInfo(t,{remote_log_level:e.remoteLogLevel})),\"string\"==typeof e.logURL&&(e.logURL.startsWith(\"wss://\")||e.logURL.startsWith(\"https://\")))this.logger.openLogServer(e.logURL),this.dataReport.addMsgInfo(t,{log_url:e.logURL});else if(e.logURL)return this.logger.error(\"zb.cm.clf log url must be a wss or https url\"),!1;return this.dataReport.uploadReport(t,_.eventList.kZegoTaskSetLog),this.logger.info(\"zb.cm.clf call success\"),!0},t.prototype.setDebugVerbose=function(e){this.logger.info(\"zb.cm.sd call\");var t=m.getReportSeq();this.dataReport.newReport(t),\"boolean\"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0,this.dataReport.addMsgInfo(t,{debug:e?\"true\":\"false\"})),this.dataReport.uploadReport(t,_.eventList.kZegoTaskSetDebug),this.logger.info(\"zb.cm.sd call success\")},t.prototype.loginRoom=function(e,t,r,s){var o=this;return new Promise((function(i,n){var l=o.loginReport(i,n,t,s),d=l.interResolve,u=l.interReject;return void 0===e||\"\"==e?(o.logger.error(\"zb.rh.lg roomID is empty\"),void u(c.errorCodeList.ROOM_ID_NULL,\" roomID is empty.\")):\"string\"!=typeof e?(o.logger.error(\"zb.rh.lg roomid must be string\"),void u(c.errorCodeList.INPUT_PARAM,\" param roomID error.\")):(e.length>a.MAX_ROOM_ID_LENGTH&&(o.logger.error(\"zb.rh.lg room ID is too long\"),u(c.errorCodeList.ROOM_ID_TOO_LONG,\" room ID is too long\")),p.ClientUtil.checkIllegalCharacters(e)?\"string\"!=typeof t||\"\"==t?(o.logger.error(\"zb.rh.lg token must be string and not empty\"),void u(c.errorCodeList.INPUT_PARAM,\" param token error.\")):r&&\"object\"==typeof r?void 0===r.userID||\"\"==r.userID?(o.logger.error(\"zb.rh.lg userID is empty\"),void u(c.errorCodeList.USER_ID_NULL,\" userID is empty.\")):\"string\"!=typeof r.userID?(o.logger.error(\"zb.rh.lg userID must be string\"),void u(c.errorCodeList.INPUT_PARAM,\" param userID error.\")):r.userID.length>a.MAX_USER_ID_LENGTH?(o.logger.error(\"zb.rh.lg user ID is too long\"),void u(c.errorCodeList.USER_ID_TOO_LONG,\" user ID is too long.\")):p.ClientUtil.checkIllegalCharacters(r.userID)?void 0===r.userName||\"\"==r.userName?(o.logger.error(\"zb.rh.lg userName is empty\"),void u(c.errorCodeList.USER_NAME_NULL,\" userName is empty.\")):\"string\"!=typeof r.userName?(o.logger.error(\"zb.rh.lg userName must be string\"),void u(c.errorCodeList.INPUT_PARAM,\" userName must be string.\")):r.userName.length>a.MAX_USER_NAME_LENGTH?(o.logger.error(\"zb.rh.lg user name is too long\"),void u(c.errorCodeList.USER_NAME_TOO_LONG,\" user name is too long.\")):void 0===s||void 0===s.maxMemberCount||p.ClientUtil.checkInteger(s.maxMemberCount,!1)?void o.roomHandler.login(e,t,r,s,d,u):(o.logger.error(\"zb.rh.lg maxMemberCount must be integer number\"),void u(c.errorCodeList.INPUT_PARAM,\" maxMemberCount must be integer number.\")):(o.logger.error(\"zb.rh.lg user ID contains illegal characters\"),void u(c.errorCodeList.USER_ID_INVALID_CHARACTER,\" user ID contains illegal characters.\")):(o.logger.error(\"zb.rh.lg user must be exist and is an object\"),void u(c.errorCodeList.INPUT_PARAM,\" param user error.\")):(o.logger.error(\"zb.rh.lg roomID contains illegal characters\"),void u(c.errorCodeList.ROOM_ID_INVALID_CHARACTER,\" room ID contains illegal characters.\")))}))},t.prototype.loginReport=function(e,t,r,s){var o=this;0!==this.stateCenter.reportSeqList.login&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,p.ClientUtil.unregisterCallback(\"kZegoTaskLoginRoom\",this.stateCenter.reportList));var i=m.getReportSeq();this.stateCenter.reportSeqList.login=i,this.dataReport.newReport(i,_.eventList.kZegoTaskLoginRoom),\"string\"==typeof r&&this.dataReport.addMsgInfo(i,{token:r}),s&&(s.userUpdate&&\"boolean\"==typeof s.userUpdate&&this.dataReport.addMsgInfo(i,{user_update:s.userUpdate}),s.maxMemberCount&&\"number\"==typeof s.maxMemberCount&&this.dataReport.addMsgInfo(i,{max_member_count:s.maxMemberCount})),p.ClientUtil.logReportCallback(\"kZegoTaskLoginRoom\",this.dataReport,i,this.stateCenter.reportList);return{interResolve:function(t){o.dataReport.uploadReport(i),o.stateCenter.reportSeqList.login=0,p.ClientUtil.unregisterCallback(\"kZegoTaskLoginRoom\",o.stateCenter.reportList),e(t)},interReject:function(e,r){var s,a;if(void 0===r&&(r=\"\"),e.code<2e9&&e.code>1e9||e.code<1e6)s=p.ClientUtil.decodeServerError(e.code,e.msg),a=p.ClientUtil.getLiveRoomError(e.code);else{var n=_.codeErrMap[e.code];s=_.errorList[n]}s&&o.dataReport.addMsgInfo(i,{error:s.code,message:s.message+r}),o.dataReport.uploadReport(i),o.stateCenter.reportSeqList.login=0,p.ClientUtil.unregisterCallback(\"kZegoTaskLoginRoom\",o.stateCenter.reportList),a&&c.errorCodeList[a]&&(e.code=c.errorCodeList[a].code),e.code&&e.msg&&\"\"!==r?t({code:e.code,msg:e.msg+r}):t(e)}}},t.prototype.logoutRoom=function(e){var t=m.getReportSeq();if(this.dataReport.newReport(t),this.dataReport.addMsgInfo(t,{roomid:e}),void 0===e)e=this.stateCenter.roomid;else{if(\"string\"!=typeof e||\"\"==e)return this.logger.error(\"zb.rh.lg roomID must be string and not empty\"),this.dataReport.addMsgInfo(t,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" param roomID error\"}),void this.dataReport.uploadReport(t,_.eventList.kZegoTaskLogoutRoom);if(e!==this.stateCenter.roomid)return this.logger.error(\"zb.rh.lg roomID is error\"),this.dataReport.addMsgInfo(t,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" roomID is error\"}),void this.dataReport.uploadReport(t,_.eventList.kZegoTaskLogoutRoom)}this.roomHandler.logout(e),this.dataReport.uploadReport(t,_.eventList.kZegoTaskLogoutRoom)},t.prototype.sendCustomCommand=function(e,t,r){var s=this;return new Promise((function(o,i){var n=m.getReportSeq();s.dataReport.newReport(n,_.eventList.kZegoTaskLiveRoomSendCustomCommand),s.dataReport.addMsgInfo(n,{room_sid:s.stateCenter.sessionid});var l=p.ClientUtil.proxyRes(s.dataReport,n,o,i),d=l.interResolve,u=l.interReject;return\"string\"!=typeof e||\"\"==e?(s.logger.error(\"zb.scc roomid must be string and not empty\"),void u(c.errorCodeList.INPUT_PARAM,\" param roomID error\")):r instanceof Array&&!r.find((function(e){return\"string\"!=typeof e}))?\"string\"!=typeof t&&\"object\"!=typeof t?(s.logger.error(\"zb.scc custom content must be a non empty string or object\"),void u(c.errorCodeList.INPUT_PARAM,\" param command error\")):\"string\"==typeof t&&t.length>a.MAX_MESSAGE_LENGTH?(s.logger.error(\"zb.sbcm command too long\"),void u(c.errorCodeList.IM_CONTENT_TOO_LONG,\" command too long\")):void s.messageHandler.sendCustomCommand(r,t,d,u):(s.logger.error(\"zb.scc dstMembers must be string array\"),void u(c.errorCodeList.INPUT_PARAM,\" param toUserList error\"))}))},t.prototype.sendBroadcastMessage=function(e,t){var r=this;return new Promise((function(s,o){var i=m.getReportSeq();r.dataReport.newReport(i,_.eventList.kZegoTaskLiveRoomSendRoomMessage),r.dataReport.addMsgInfo(i,{room_sid:r.stateCenter.sessionid});var n=p.ClientUtil.proxyRes(r.dataReport,i,s,o),l=n.interResolve,d=n.interReject;return\"string\"!=typeof e||\"\"==e?(r.logger.error(\"zb.sbcm roomid must be string and not empty\"),void d(c.errorCodeList.INPUT_PARAM,\" param roomID error\")):void 0===t||\"\"==t?(r.logger.error(\"zb.sbcm message is empty\"),void d(c.errorCodeList.IM_CONTENT_NULL,\" message is empty.\")):\"string\"!=typeof t?(r.logger.error(\"zb.sbcm message must be string\"),void d(c.errorCodeList.INPUT_PARAM,\" param message error\")):t.length>a.MAX_MESSAGE_LENGTH?(r.logger.error(\"zb.sbcm message too long\"),void d(c.errorCodeList.IM_CONTENT_TOO_LONG,\" message too long\")):void r.messageHandler.sendRoomMsg(r.stateCenter.msgCategory,e,t,l,d)}))},t.prototype.sendReliableMessage=function(e,t,r,s){return e&&\"string\"==typeof e?e.length>a.MAX_TRANS_TYPE_LENGTH?(this.logger.error(\"zb.cm.srm type is too long\"),void s(c.errorCodeList.INPUT_PARAM,-1)):t&&\"string\"==typeof t?t.length>a.MAX_TRANS_DATA_LENGTH?(this.logger.error(\"zb.cm.srm type is too long\"),void s(c.errorCodeList.INPUT_PARAM,-1)):void this.messageHandler.sendReliableMessage(e,t,r,s):(this.logger.error(\"zb.cm.srm data must be string\"),void s(c.errorCodeList.INPUT_PARAM,-1)):(this.logger.error(\"zb.cm.srm type must be string\"),void s(c.errorCodeList.INPUT_PARAM,-1))},t.prototype.setRoomExtraInfo=function(e,t,r){var s=this;return new Promise((function(e,o){if(!t||\"string\"!=typeof t)return s.logger.error(\"zb.cm.srxi0.0 type must be string\"),void o({errorCode:c.errorCodeList.INPUT_PARAM.code});if(t.length>a.MAX_TRANS_TYPE_LENGTH)return s.logger.error(\"zb.cm.srxi0.0 type is too long\"),void o({errorCode:c.errorCodeList.INPUT_PARAM.code});if(!r||\"string\"!=typeof r)return s.logger.error(\"zb.cm.srxi0.0 data must be string\"),void o({errorCode:c.errorCodeList.INPUT_PARAM.code});if(r.length>a.MAX_TRANS_DATA_LENGTH)return s.logger.error(\"zb.cm.srxi0.0 type is too long\"),void o({errorCode:c.errorCodeList.INPUT_PARAM.code});s.messageHandler.sendReliableMessage(t,r,(function(t){e({errorCode:0})}),o)}))},t.prototype.sendBarrageMessage=function(e,t){var r=this;return new Promise((function(s,o){var i=m.getReportSeq();r.dataReport.newReport(i,_.eventList.kZegoTaskLiveSendRoomBigIM),r.dataReport.addMsgInfo(i,{room_sid:r.stateCenter.sessionid});var n=p.ClientUtil.proxyRes(r.dataReport,i,s,o),l=n.interResolve,d=n.interReject;return\"string\"!=typeof e||\"\"==e?(r.logger.error(\"zb.sbm roomid must be string and not empty\"),void d(c.errorCodeList.INPUT_PARAM,\" param roomID error\")):void 0===t||\"\"==t?(r.logger.error(\"zb.sbm message is empty\"),void d(c.errorCodeList.IM_CONTENT_NULL,\" message is empty.\")):\"string\"!=typeof t?(r.logger.error(\"zb.sbm message must be string\"),void d(c.errorCodeList.INPUT_PARAM,\" param message error\")):t.length>a.MAX_MESSAGE_LENGTH?(r.logger.error(\"zb.sbm message too long\"),void d(c.errorCodeList.IM_CONTENT_TOO_LONG,\" message too long\")):void r.messageHandler.sendBigRoomMessage(r.stateCenter.msgCategory,e,t,l,d)}))},t.prototype.sendRelayMessage=function(e,t,r,s){this.messageHandler.sendRelayMessage(e,t,r,s)},t.prototype.requestJoinLive=function(e,t,r,s){return this.liveHandler.requestJoinLive(e,t,r,s)},t.prototype.inviteJoinLive=function(e,t,r,s){return this.liveHandler.inviteJoinLive(e,t,r,s)},t.prototype.endJoinLive=function(e,t,r){return this.liveHandler.endJoinLive(e,t,r)},t.prototype.respondJoinLive=function(e,t,r,s){return this.liveHandler.respondJoinLive(e,t,r,s)},t.prototype.startMixerTask=function(e){var t=this;return new Promise((function(r,s){e.outputConfig&&e.outputConfig.outputFps&&(e.outputConfig.outputFPS=e.outputConfig.outputFps);var o=m.getReportSeq();t.dataReport.newReport(o,_.eventList.kZegoTaskMixStart),p.ClientUtil.logReportCallback(\"kZegoTaskMixStart\"+e.taskID,t.dataReport,o,t.stateCenter.reportList);t.streamHandler.updateMixStream(e,(function(s){t.dataReport.uploadReport(o),p.ClientUtil.unregisterCallback(\"kZegoTaskMixStart\"+e.taskID,t.stateCenter.reportList),r(s)}),(function(r){var i,a,n;r.errorCode<2e9&&r.errorCode>1e9?(i=p.ClientUtil.mixServerError(r.errorCode)[0],n=_.errorList[i],a=p.ClientUtil.mixServerError(r.errorCode)[1]):r.errorCode<1e6?(n=p.ClientUtil.decodeServerError(r.errorCode,r.extendedData),a=p.ClientUtil.getLiveRoomError(r.errorCode)):(i=_.codeErrMap[r.errorCode],n=_.errorList[i]),n?t.dataReport.addMsgInfo(o,{error:n.code,message:n.message}):t.dataReport.addMsgInfo(o,{error:r.errorCode,message:r.extendedData}),t.dataReport.uploadReport(o),p.ClientUtil.unregisterCallback(\"kZegoTaskMixStart\"+e.taskID,t.stateCenter.reportList),a&&(r.errorCode=c.errorCodeList[a].code),s(r)}))}))},t.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise((function(r,s){var o=m.getReportSeq();t.dataReport.newReport(o,_.eventList.kZegoTaskMixConfig),p.ClientUtil.logReportCallback(\"kZegoTaskMixConfig\",t.dataReport,o,t.stateCenter.reportList),t.streamHandler.setMixerTaskConfig(e).then((function(e){t.dataReport.uploadReport(o),p.ClientUtil.unregisterCallback(\"kZegoTaskMixConfig\",t.stateCenter.reportList),r(e)})).catch((function(e){var r=_.codeErrMap[e.errorCode];r&&t.dataReport.addMsgInfo(o,{error:_.errorList[r].code,message:_.errorList[r].message}),t.dataReport.uploadReport(o),p.ClientUtil.unregisterCallback(\"kZegoTaskMixConfig\",t.stateCenter.reportList),s(e)}))}))},t.prototype.stopMixerTask=function(e){var t=this;return new Promise((function(r,s){var o=m.getReportSeq();if(t.dataReport.newReport(o,_.eventList.kZegoTaskMixStop),!e)return t.logger.error(\"zb.sh.ums no taskID found\"),t.dataReport.addMsgInfo(o,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" param taskID error\"}),t.dataReport.uploadReport(o),void s({errorCode:c.errorCodeList.MIXER_TASK_ID_NULL.code,extendedData:\"\"});if(\"string\"!=typeof e)return t.logger.error(\"zb.rh.lg taskID must be string\"),t.dataReport.addMsgInfo(o,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" param taskID error\"}),t.dataReport.uploadReport(o),void s({errorCode:c.errorCodeList.INPUT_PARAM.code,extendedData:\"\"});if(e.length>a.MAX_MIX_TASK_ID_LENGTH)return t.logger.error(\"zb.sh.ums taskID is too long\"),t.dataReport.addMsgInfo(o,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" param taskID error\"}),t.dataReport.uploadReport(o),void s({errorCode:c.errorCodeList.MIXER_TASK_ID_TOO_LONG.code,extendedData:\"\"});if(!p.ClientUtil.checkIllegalCharacters(e))return t.logger.error(\"zb.sh.ums taskID contains illegal characters\"),t.dataReport.addMsgInfo(o,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" param taskID error\"}),t.dataReport.uploadReport(o),void s({errorCode:c.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER.code,extendedData:\"\"});t.streamHandler.stopMixStream(e,(function(e){t.dataReport.uploadReport(o),r(e)}),(function(e){var r,i,n;e.errorCode<2e9&&e.errorCode>1e9?(r=p.ClientUtil.mixServerError(e.errorCode-a.MIXSTREAM_ERROR_CODE)[0],i=_.errorList[r],n=p.ClientUtil.mixServerError(e.errorCode-a.MIXSTREAM_ERROR_CODE)[1]):e.errorCode<1e6?(i=p.ClientUtil.decodeServerError(e.errorCode,e.extendedData),n=p.ClientUtil.getLiveRoomError(e.errorCode)):(r=_.codeErrMap[e.errorCode],i=_.errorList[r]),i?t.dataReport.addMsgInfo(o,{error:i.code,message:i.message}):t.dataReport.addMsgInfo(o,{error:e.errorCode,message:e.extendedData}),t.dataReport.uploadReport(o),n&&(e.errorCode=c.errorCodeList[n].code),s(e)}))}))},t.prototype.addPublishCdnUrl=function(e,t,r){var s=m.getReportSeq();return this.dataReport.newReport(s,_.eventList.kZegoTaskAddPublishCdnUrl),this.dataReport.addMsgInfo(s,{stream_id:e,signature:t,target_url:r}),this.publishTarget({type:\"addpush\",streamID:e,pushUrl:r,signature:t},s)},t.prototype.removePublishCdnUrl=function(e,t,r){var s=m.getReportSeq();return this.dataReport.newReport(s,_.eventList.kZegoTaskRemovePublishCdnUrl),this.dataReport.addMsgInfo(s,{stream_id:e,signature:t,target_url:r}),this.publishTarget({type:\"delpush\",streamID:e,pushUrl:r,signature:t},s)},t.prototype.clearPublishCdnUrl=function(e,t,r){var s=m.getReportSeq();return this.dataReport.newReport(s,_.eventList.kZegoTaskRemovePublishCdnUrl),this.dataReport.addMsgInfo(s,{stream_id:e,signature:t,target_url:r}),this.publishTarget({type:\"clearpush\",streamID:e,pushUrl:r,signature:t},s)},t.prototype.publishTarget=function(e,t){var r=this;return new Promise((function(s,o){if(!e.streamID||\"string\"!=typeof e.streamID)return r.logger.error(\"zb.pt streamid error\"),r.dataReport.addMsgInfo(t,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" streamid error\"}),void r.dataReport.uploadReport(t);if(!e.pushUrl||\"string\"!=typeof e.pushUrl)return r.logger.error(\"zb.pt pushurl error\"),r.dataReport.addMsgInfo(t,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" pushurl error\"}),void r.dataReport.uploadReport(t);if(!e.signature||\"string\"!=typeof e.signature)return r.logger.error(\"zb.pt appSecret error\"),r.dataReport.addMsgInfo(t,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" signature error\"}),void r.dataReport.uploadReport(t);if(!r.stateCenter.publishStreamList[e.streamID])return r.logger.error(\"zb.pt publish stream no found\"),r.dataReport.addMsgInfo(t,{error:_.errorList.kPublishStreamNotFound.code,message:_.errorList.kPublishStreamNotFound.message}),void r.dataReport.uploadReport(t);r.streamHandler.publishTarget(e,(function(e){r.dataReport.uploadReport(t),s(e)}),(function(e){var s=p.ClientUtil.getServerError(e.errorCode),i=p.ClientUtil.decodeServerError(s.code,s.msg);r.dataReport.addMsgInfo(t,{error:i.code,message:i.message}),r.dataReport.uploadReport(t),o(e)}))}))},t.prototype.setStreamExtraInfo=function(e,t){var r=this;return new Promise((function(s,o){var i=m.getReportSeq();if(r.dataReport.newReport(i,_.eventList.kZegoTaskLiveRoomSendStreamExtraInfo),r.dataReport.addMsgInfo(i,{stream_id:e,stream_extra_info:t,room_sid:r.stateCenter.sessionid}),\"string\"!=typeof e||\"\"==e)return r.logger.error(\"zb.ssei streamID must be string and not empty\"),r.dataReport.addMsgInfo(i,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" streamID must be string and not empty\"}),r.dataReport.uploadReport(i),o({errorCode:c.errorCodeList.INPUT_PARAM.code,extendedData:c.errorCodeList.INPUT_PARAM.msg}),!1;if(void 0===t||\"\"===t)return r.logger.error(\"zb.ssei extraInfo is empty\"),r.dataReport.addMsgInfo(i,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" extraInfo is empty\"}),r.dataReport.uploadReport(i),o({errorCode:c.errorCodeList.PUBLISHER_EXTRA_INFO_NULL.code,extendedData:c.errorCodeList.INPUT_PARAM.msg}),!1;if(\"string\"!=typeof t||\"\"==t)return r.logger.error(\"zb.ssei extraInfo must be string\"),r.dataReport.addMsgInfo(i,{error:_.errorList.kInvalidParamError.code,message:_.errorList.kInvalidParamError.message+\" extraInfo must be string\"}),r.dataReport.uploadReport(i),o({errorCode:c.errorCodeList.INPUT_PARAM.code,extendedData:c.errorCodeList.INPUT_PARAM.msg}),!1;if(!r.stateCenter.isLogin())return r.logger.error(\"zb.ssei not login\"),r.dataReport.uploadReport(i,void 0,_.errorList.kNotLoginError),r.dataReport.addMsgInfo(i,{error:_.errorList.kNotLoginError.code,message:_.errorList.kNotLoginError.message}),o({errorCode:c.errorCodeList.NOT_LOGIN.code,extendedData:c.errorCodeList.NOT_LOGIN.msg}),!1;if(!r.stateCenter.publishStreamList[e])return r.logger.error(\"zb.ssei publish stream no found\"),r.dataReport.addMsgInfo(i,{error:_.errorList.kPublishStreamNotFound.code,message:_.errorList.kPublishStreamNotFound.message}),r.dataReport.uploadReport(i),void o({errorCode:c.errorCodeList.PUBLISH_NOT_PUBLISH.code,extendedData:c.errorCodeList.PUBLISH_NOT_PUBLISH.msg});r.streamHandler.updateStreamExtraInfo(e,t);r.dataReport.uploadReport(i),s({errorCode:0,extendedData:\"\"})}))},t.prototype.bindListener=function(e,t){return this.stateCenter.listenerList[e]?\"function\"!=typeof t?(this.logger.error(\"zc.o.0 listener callBack must be funciton\"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(\"zc.o.0 event \"+e+\" no found\"),!1)},t.prototype.deleteListener=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(\"zc.o.1 listener no found\"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},t.prototype.getVersion=function(){return a.PROTO_VERSION},t.prototype.setSdkBizVersion=function(e){\"string\"==typeof e&&\"\"!==e&&(this.stateCenter.bizVersion=e)},t.prototype.setSdkLoginRelateService=function(e){Array.isArray(e)&&e.every((function(e){return\"string\"==typeof e}))&&(this.stateCenter.relateService=e)},t}(i.Common);t.BaseCenter=C},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.Common=void 0;var s=r(0),o=r(5),i=r(1),a=function(){function e(){}return e.prototype.getSocket=function(e){return null},e.prototype.setCDNInfo=function(e,t){},e.prototype.onPublishStateUpdateHandle=function(e,t,r){var o=this;0==e?this.stateCenter.publishStreamList[t]&&(this.stateCenter.publishStreamList[t].state==s.ENUM_PUBLISH_STREAM_STATE.tryPublish?(this.stateCenter.publishStreamList[t].state=s.ENUM_PUBLISH_STREAM_STATE.update_info,this.streamHandler.updateStreamInfo(t,s.ENUM_STREAM_SUB_CMD.liveBegin,this.stateCenter.publishStreamList[t].extra_info,(function(e){o.stateCenter.publishStreamList[t]&&o.stateCenter.publishStreamList[t].state==s.ENUM_PUBLISH_STREAM_STATE.update_info&&(o.stateCenter.publishStreamList[t].state=s.ENUM_PUBLISH_STREAM_STATE.stop,o.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,t,e),o.streamCenter.stopPublishingStream(t))}))):(this.WebrtcOnPublishStateUpdateHandle(e,t,r),\"xcx\"==this.stateCenter.clientType&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.startPublish[t]),delete this.stateCenter.reportSeqList.startPublish[t],i.ClientUtil.unregisterCallback(\"kZegoTaskPublishStart\"+t,this.stateCenter.reportList)))):(this.streamHandler.onPublishStateUpdate(e,t,r),1==e&&(this.logger.info(\"cb.cm.opsuh trigger internal stop publish stream\"),this.stopPublishingStream(t,!0)))},e.prototype.WebrtcOnPublishStateUpdateHandle=function(e,t,r){},e.prototype.loginBodyData=function(){},e.prototype.resetStreamCenter=function(){if(this.stateCenter.customUrl&&(this.stateCenter.customUrl=null),this.streamCenter.reset(),!this.socketCenter.isDisConnect())for(var e in this.stateCenter.publishStreamList)this.stateCenter.publishStreamList[e].state==s.ENUM_PUBLISH_STREAM_STATE.publishing&&this.streamHandler.updateStreamInfo(e,s.ENUM_STREAM_SUB_CMD.liveEnd,this.stateCenter.publishStreamList[e].extra_info)},e.prototype.handleFetchWebRtcUrlRsp=function(e){var t=e.body.stream_id,r=this.streamCenter.getTotalStreamId(t),s=!1;if(e.body.urls&&Array.isArray(e.body.urls)&&e.body.urls.length>0?s=!0:this.logger.error(\"cb.cm.hfwur signal url is empty\"),\"push\"===e.body.ptype&&this.streamCenter.publisherList[r]){if(e.header.seq!==this.streamCenter.publisherList[r].seq)return void this.logger.info(\"cb.cm.hfwur seq is not match, ignore \"+t);if(!s)return this.streamHandler.onPublishStateUpdate(1,t,o.publishErrorList.DISPATCH_ERROR),void this.stopPublishingStream(t);this.stateCenter.publishStreamList[t]?this.streamCenter.startPublishingStream(t,e.body.urls):this.logger.error(\"cb.cm.hfwur no streamid to publish\")}else if(\"pull\"==e.body.ptype&&this.streamCenter.playerList[r]){if(e.header.seq!==this.streamCenter.playerList[r].seq)return void this.logger.info(\"cb.cm.hfwur seq is not match, ignore \"+t);if(!s)return this.streamCenter.onPlayStateUpdate(1,t,o.playErrorList.DISPATCH_ERROR),void this.stopPlayingStream(t);for(var i=!1,a=0;a<this.stateCenter.streamList.length;a++)if(this.stateCenter.streamList[a].stream_id===t){i=!0;break}0==i&&this.logger.warn(\"cb.cm.hfwur cannot find stream, continue to play\"),this.streamCenter.startPlayingStream(t,e.body.urls,this.streamCenter.playSuccessCallBackList[t])}},e}();t.Common=a},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.SocketCenter=void 0;var s=r(0),o=r(1),i=function(){function e(e,t){var r=this;this.websocket=null,this.cmdSeq=0,this.responseRouters={},this.logger=e,this.stateCenter=t,this.responseRouters={push_kickout:function(e){r.handlePushKickout(e)},push_custommsg:function(e){r.handlePushCustomMsg(e)},push_im_chat:function(e){r.handlePushRoomMsg(e)},push_userlist_update:function(e){r.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){r.handlePushMergeMsg(e)},trans:function(e){r.handleTransRsp(e)},push_trans:function(e){r.handlePushTransMsg(e)}}}return e.prototype.handlePushKickout=function(e){},e.prototype.handlePushCustomMsg=function(e){},e.prototype.handlePushRoomMsg=function(e){},e.prototype.handlePushUserStateUpdateMsg=function(e){},e.prototype.handlePushMergeMsg=function(e){},e.prototype.handlePushTransMsg=function(e){},e.prototype.handleBigImMsgRsp=function(e){},e.prototype.handleTransRsp=function(e){if(this.stateCenter.isLogin())if(0==e.body.err_code){var t=e.body.trans_type;this.stateCenter.transSeqMap[t]?(this.stateCenter.transSeqMap[t].seq=e.body.trans_seq,this.logger.debug(\"zb.sc.htr trans \"+t+\" seq \"+e.body.trans_seq)):this.logger.error(\"zb.sc.htr cannot match send info\")}else this.logger.error(\"zb.sc.htr trans send error \"+e.body.err_code);else this.logger.error(\"zb.sc.htr not login\")},e.prototype.handleBizChannelRspCallback=function(e,t){0===e.body.err_code?null!=t.success&&t.success(e.header.seq,e.body.cmd,e.body.rsp_body):null!=t.error&&t.error(e.body.err_code,e.header.seq,e.body.rsp_body,t.isRetry)},e.prototype.registerRouter=function(e,t){this.responseRouters[e]=t},e.prototype.getSocket=function(e){return null},e.prototype.getHeaderV2=function(e){return{Protocol:\"req_v2\",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:this.stateCenter.sessionid||\"\",room_id:this.stateCenter.roomid||\"\",room_session_id:this.stateCenter.roomSessionId||\"\",biz_version:this.stateCenter.bizVersion||\"\"}},e.prototype.getHeader=function(e){return{Protocol:\"req\",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:this.stateCenter.sessionid||\"\",room_id:this.stateCenter.roomid||\"\",room_session_id:this.stateCenter.roomSessionId||\"\",biz_version:this.stateCenter.bizVersion||\"\"}},e.prototype.sendMessage=function(e,t,r,o,i){if(this.logger.info(\"zb.sc.sm call \"+e),this.isDisConnect())return this.logger.error(\"zb.sc.sm error \"+e+\" websocket is disconnected\"),-1;var a=\"V1\"===s.ROOMVERSION?this.getHeader(e):this.getHeaderV2(e),n={header:a,body:t};if(null==r&&(r=null),null==o&&(o=null),null!=r||null!=o){var l={data:n,seq:a.seq,deleted:!1,time:Date.parse(new Date+\"\"),success:r,error:o,isRetry:i},d=this.stateCenter.sendCommandList.push(l);this.stateCenter.sendCommandMap[l.seq]=d}return this.logger.info(\"zb.sc.sm data \",JSON.stringify(n)),this.websocket&&this.websocket.send(JSON.stringify(n)),this.logger.debug(\"zb.sc.sm success\"),a.seq},e.prototype.sendCustomMessage=function(e,t,r,o){if(this.logger.debug(\"zb.sc.scm call\"),this.isDisConnect())return this.logger.error(\"zb.sc.scm error\"),!1;var i=\"V1\"===s.ROOMVERSION?this.getHeader(e):this.getHeaderV2(e),a={header:i,body:t},n=JSON.stringify(a);null==r&&(r=null),null==o&&(o=null);var l={data:a,seq:i.seq,deleted:!1,time:Date.parse(new Date+\"\"),success:r,error:o},d=this.stateCenter.sendDataList.push(l);return this.stateCenter.sendDataMap[l.seq]=d,this.logger.info(\"zb.sc.scm data \",n),this.websocket&&this.websocket.send(n),this.logger.debug(\"zb.sc.scm success seq: \",i.seq),!0},e.prototype.isDisConnect=function(){return!this.websocket||1!==this.websocket.readyState},e.prototype.closeSocket=function(){this.websocket&&(this.logger.info(\"zb.sc.cs close websocket\"),this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.createSocket=function(e){this.websocket=this.getSocket(e)},e.prototype.openHandler=function(e){this.websocket&&(this.websocket.onopen=e)},e.prototype.closeHandler=function(e){this.websocket&&(this.websocket.onclose=e)},e.prototype.errorHandler=function(){var e=this;this.websocket&&(this.websocket.onerror=function(t){e.logger.error(\"zb.sc.oe msg=\"+JSON.stringify(t))})},e.prototype.checkResponse=function(e){return(e.header.appid!==this.stateCenter.appid||e.header.session_id!==this.stateCenter.sessionid||e.header.user_id!==this.stateCenter.userid||e.header.room_id!==this.stateCenter.roomid||this.stateCenter.runState!==s.ENUM_RUN_STATE.login)&&(this.logger.error(\"zb.sc.crp check session fail.\"),!0)},e.prototype.responseHandler=function(){var e=this;this.websocket&&(this.websocket.onmessage=function(t){var r=\"string\"==typeof t.data?JSON.parse(t.data):JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t.data)));e.logger.info(\"zb.sc.ws.rph jsonmsg= \",r.header.cmd),e.logger.info(\"zb.sc.ws.rph jsonmsg= \",t.data),0!==r.body.err_code&&r.body.err_message&&e.logger.error(\"zb.sc.ws.rph cmd=\"+r.header.cmd+\", err_code=\"+r.body.err_code+\", err_message=\"+r.body.err_message+\" \"),\"login\"!==r.header.cmd?\"logout\"!==r.header.cmd?e.stateCenter.isLogin()?e.checkResponse(r)?e.logger.error(\"zb.sc.ws.rph check session fail.\"):(e.handleSendCommandMsgRsp(r),e.logger.info(\"zb.sc.ws.rph cmd=\"+r.header.cmd+\",function=\"+!!e.responseRouters[r.header.cmd]),e.responseRouters[r.header.cmd]&&e.responseRouters[r.header.cmd](r)):e.logger.warn(\"zb.sc.ws.rph  already logout\"):e.responseRouters.logout(r,e.cmdSeq):e.responseRouters.login(r,e.cmdSeq)})},e.prototype.handleSendCommandMsgRsp=function(e){this.logger.debug(\"zb.sc.hscmr call\");var t,r=this.stateCenter.sendCommandMap[e.header.seq];null!=r&&(t=r._data,delete this.stateCenter.sendCommandMap[e.header.seq],this.stateCenter.sendCommandList.remove(r),\"login\"==t.data.header.cmd?this.logger.debug(\"zb.sc.hscmr don't check \"+t.data.header.cmd):\"relay\"==t.data.header.cmd?this.handleRelayRspCallback(e,t):\"bigim_chat\"==t.data.header.cmd?this.handleBigImRspCallback(e,t):\"biz_channel\"==t.data.header.cmd?this.handleBizChannelRspCallback(e,t):0===e.body.err_code?null!=t.success&&t.success(e.header.seq):null!=t.error&&t.error(o.ClientUtil.getServerError(e.body.err_code),e.header.seq)),this.logger.debug(\"zb.sc.hscmr call success\")},e.prototype.handleRelayRspCallback=function(e,t){0===e.body.err_code?null!=t.success&&t.success(e.header.seq,e.body.relay_result):null!=t.error&&t.error(o.ClientUtil.getServerError(e.body.err_code),e.header.seq)},e.prototype.handleBigImRspCallback=function(e,t){0===e.body.err_code?null!=t.success&&this.handleBigImMsgRsp(e):null!=t.error&&t.error({errorCode:o.ClientUtil.getServerError(e.body.err_code).code,messageID:\"\"})},e}();t.SocketCenter=i},function(e,t,r){var s=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var s=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,n=i.length;a<n;a++,o++)s[o]=i[a];return s};Object.defineProperty(t,\"__esModule\",{value:!0}),t.RoomHandler=void 0;var o=r(0),i=r(1),a=r(5),n=r(2),l=r(4),d=function(){function e(e,t,r){this.logger=e,this.socketCenter=r,this.stateCenter=t}return e.prototype.setRunState=function(e){this.logger.debug(\"zb.rh.srs old=\"+this.stateCenter.runState+\", new=\"+e),this.stateCenter.lastRunState=this.stateCenter.runState,this.stateCenter.runState=e},e.prototype.resetTryLogin=function(){this.logger.debug(\"zb.rh.rtl call\"),clearTimeout(this.stateCenter.tryLoginTimer),this.stateCenter.tryLoginTimer=null,this.stateCenter.tryLoginCount=0,this.logger.debug(\"zb.rh.rtl call success\")},e.prototype.resetBigRoomInfo=function(){this.stateCenter.transSeqMap={},this.stateCenter.realyMessageList=[],this.stateCenter.relayTimer&&(clearTimeout(this.stateCenter.relayTimer),this.stateCenter.relayTimer=null),this.stateCenter.bigImLastTimeIndex=0,this.stateCenter.bigIMmessageList=[],this.stateCenter.bigImCallbackMap={},this.stateCenter.bigImTimer&&(clearTimeout(this.stateCenter.bigImTimer),this.stateCenter.bigImTimer=null),this.stateCenter.serverTimeOffset=0,this.stateCenter.datiTimeWindow=0,this.stateCenter.bigimTimeWindow=0},e.prototype.resetRoom=function(e){var t=this;if(this.logger.info(\"zb.rh.rr call\"),this.resetTryLogin(),this.resetRoomCallBack(),this.stateCenter.streamList=[],this.stateCenter.streamQuerying=!1,this.stateCenter.publishStreamList={},this.stateCenter.joinLiveCallbackMap={},this.stateCenter.joinLiveRequestMap={},this.stateCenter.streamUrlMap={},this.resetBigRoomInfo(),this.stateCenter.cmdCallback={},this.logger.info(\"zb.rh.rr call send logout=\",this.stateCenter.sessionid),\"0\"!==this.stateCenter.sessionid&&this.stateCenter.runState!==o.ENUM_RUN_STATE.logout){this.socketCenter.registerRouter(\"logout\",(function(e){t.handleLogoutRsp(e)})),this.socketCenter.sendMessage(\"logout\",{reserve:0})}this.socketCenter.closeSocket(),this.setRunState(o.ENUM_RUN_STATE.logout),this.stateCenter.userid=\"\",this.stateCenter.sessionid=\"\",this.stateCenter.roomSessionId=\"\",this.logger.setSessionInfo(this.stateCenter.appid,this.stateCenter.roomid,this.stateCenter.sessionid,this.stateCenter.idName,this.stateCenter.nickName,o.PROTO_VERSION),this.logger.info(\"zb.rh.rr call success\")},e.prototype.resetRoomCallBack=function(){},e.prototype.onDisconnect=function(e){},e.prototype.onConnecting=function(e){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.fetchReliableMessage=function(e,t){},e.prototype.login=function(e,t,r,s,n,l){if(this.logger.setSessionInfo(this.stateCenter.appid,e,\"\",r.userID,\"\",o.PROTO_VERSION),this.logger.info(\"zb.rh.lg call:\",e,t),s&&(s.userUpdate&&\"boolean\"==typeof s.userUpdate&&(this.stateCenter.userStateUpdate=s.userUpdate),s.maxMemberCount&&\"number\"==typeof s.maxMemberCount&&(this.stateCenter.maxMemberCount=s.maxMemberCount)),!this.stateCenter.configOK)return this.logger.error(\"zb.rh.lg init sdk wrong\"),void l(a.commonErrorList.INIT);this.stateCenter.runState!==o.ENUM_RUN_STATE.logout&&(this.logger.debug(\"zb.rh.lg reset\"),this.setRunState(o.ENUM_RUN_STATE.logout),this.resetRoom()),this.logger.debug(\"zb.rh.lg begin\"),this.setRunState(o.ENUM_RUN_STATE.trylogin),this.stateCenter.roomid=e,this.stateCenter.token=t,this.stateCenter.third_token=t,this.stateCenter.idName=r.userID,this.stateCenter.nickName=r.userName,i.ClientUtil.registerCallback(\"login\",{success:n,error:l},this.stateCenter.callbackList),this.resetTryLogin(),this.onConnecting({code:0,msg:\"\"}),this.tryLogin(),this.logger.info(\"zb.rh.lg call success\")},e.prototype.loginBodyData=function(){},e.prototype.tryLogin=function(){var e=this;if(this.logger.debug(\"zb.rh.tl call\"),this.stateCenter.runState===o.ENUM_RUN_STATE.trylogin){if(++this.stateCenter.tryLoginCount>o.MAX_TRY_LOGIN_COUNT){this.logger.error(\"zb.rh.tl fail times limit\");var t=this.stateCenter.lastRunState;return this.setRunState(o.ENUM_RUN_STATE.logout),this.resetRoom(),void(t==o.ENUM_RUN_STATE.login?(this.logger.error(\"zb.rh.tl fail and disconnect\"),this.onDisconnect(l.errorCodeList.ROOM_RETRY_TIMEOUT)):(this.logger.info(\"zb.rh.tl fail and callback user\"),i.ClientUtil.actionErrorCallback(\"login\",this.stateCenter.callbackList)(l.errorCodeList.LOGIN_TIMEOUT)))}this.stateCenter.startConnceTime=(new Date).getTime(),console.warn(\"start connect\",this.stateCenter.startConnceTime);var r=0!==this.stateCenter.reportSeqList.login?\"kZegoTaskLoginRoom\":\"kZegoTaskReLoginRoom\";if(this.socketCenter.isDisConnect()){this.logger.debug(\"zb.rh.tl need new websocket\");try{this.socketCenter.closeSocket(),this.logger.debug(\"zb.rh.tl new websocket\");var s=this.stateCenter.tryLoginCount%2==1?this.stateCenter.server:this.stateCenter.serverBak;i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&(this.stateCenter.tryLoginCount>1&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventEnd,\"create_socket\"),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventStart,\"create_socket\"),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.addEventMsg,\"create_socket\",\"server\",s)),this.socketCenter.createSocket(s),this.socketCenter.registerRouter(\"login\",(function(t,r){e.handleLoginRsp(t,r)})),this.socketCenter.closeHandler((function(t){e.socketCenter.closeSocket(),e.closeHandler(t)})),this.socketCenter.openHandler((function(){e.openHandler()}))}catch(e){this.logger.error(\"zb.rh.tl websocket err:\"+e)}}else{var a=this.loginBodyData();this.logger.info(\"zb.rh.tl use current websocket and sent login\"),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventStart,\"liveroom_login\"),this.socketCenter.sendMessage(\"login\",a)}this.stateCenter.tryLoginTimer=setTimeout((function(){e.tryLogin()}),o.TRY_LOGIN_INTERVAL[this.stateCenter.tryLoginCount%o.MAX_TRY_LOGIN_COUNT]),this.logger.info(\"zb.rh.tl call success\")}else this.logger.error(\"zb.rh.tl state error\")},e.prototype.handleLoginRsp=function(e,t){this.logger.debug(\"zb.rh.hlr call\");var r=0!==this.stateCenter.reportSeqList.login?\"kZegoTaskLoginRoom\":\"kZegoTaskReLoginRoom\";if(i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventEndWithMsgInfo,\"liveroom_login\"),this.stateCenter.runState===o.ENUM_RUN_STATE.trylogin){if(e.header.seq===t)return 0!==e.body.err_code?(this.handleLoginFail(e),void this.logger.error(\"zb.rh.hlr server error=\",e.body.err_code)):(this.handleLoginSuccess(e),void this.logger.info(\"zb.rh.hlr call success.\"));this.logger.error(\"zb.rh.hlr in wrong seq, local=\",t,\",recv=\",e.header.seq)}else this.logger.error(\"zb.rh.hlr state error\")},e.prototype.handleLoginFail=function(e){if(this.logger.debug(\"zb.rh.hlf call\"),i.ClientUtil.isKeepTryLogin(e.body.err_code))this.logger.warn(\"zb.rh.hlf KeepTry true\");else{var t=this.stateCenter.lastRunState;this.setRunState(o.ENUM_RUN_STATE.logout),this.resetRoom();var r=i.ClientUtil.getServerError(e.body.err_code);t===o.ENUM_RUN_STATE.login?(this.logger.info(\"zb.rh.hlf callback disconnect\"),this.onDisconnect(r)):(this.logger.info(\"zb.rh.hlf callback error\"),i.ClientUtil.actionErrorCallback(\"login\",this.stateCenter.callbackList)(r)),this.logger.debug(\"zb.rh.hlf call success\")}},e.prototype.handleLoginSuccess=function(e){var t=this;this.stateCenter.startloginSucTime=(new Date).getTime(),console.warn(\"login suc\",this.stateCenter.startloginSucTime,this.stateCenter.startloginSucTime-this.stateCenter.startloginTime,this.stateCenter.startloginSucTime-this.stateCenter.startConnceTime),this.logger.info(\"zb.rh.hls call\");var r={},s=this.stateCenter.lastRunState;if(this.setRunState(o.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_id,this.stateCenter.sessionid=e.body.session_id,this.stateCenter.roomSessionId=e.body.room_session_id,this.stateCenter.anchor_info=e.body.anchor_info||this.stateCenter.anchor_info,this.stateCenter.userListInterval=e.body.userlist_interval||this.stateCenter.userListInterval,this.stateCenter.userListMergeInterval=e.body.userlist_merge_timeout||this.stateCenter.userListMergeInterval,this.logger.setSessionInfo(this.stateCenter.appid,this.stateCenter.roomid,this.stateCenter.sessionid,this.stateCenter.idName,this.stateCenter.nickName,o.PROTO_VERSION),e.body.trans_seqs)for(var a=0;a<e.body.trans_seqs.length;a++){var l=e.body.trans_seqs[a].trans_channel,d=e.body.trans_seqs[a].trans_seq_array;(d=d.filter((function(e){var r=e.trans_type,s=e.trans_seq;return!t.stateCenter.transSeqMap[r]||t.stateCenter.transSeqMap[r].seq<s}))).length>0&&this.fetchReliableMessage(l,d)}if(e.body.config_info&&(this.logger.setRemoteLogLevel(e.body.config_info.log_level),r.log_level=e.body.config_info.log_level,\"\"!=e.body.config_info.log_url&&(this.logger.openLogServer(e.body.config_info.log_url),r.log_url=e.body.config_info.log_url)),null!=e.body.ret_timestamp&&\"string\"==typeof e.body.ret_timestamp){var u=parseFloat(e.body.ret_timestamp);this.stateCenter.serverTimeOffset=0==u?0:e.body.ret_timestamp-(new Date).getTime()}e.body.bigim_time_window&&\"number\"==typeof e.body.bigim_time_window&&(this.stateCenter.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&\"number\"==typeof e.body.dati_time_window&&(this.stateCenter.datiTimeWindow=e.body.dati_time_window),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,r.test_environment=\"true\",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0));var h=0!==this.stateCenter.reportSeqList.login?\"kZegoTaskLoginRoom\":\"kZegoTaskReLoginRoom\";i.ClientUtil.actionSuccessCallback(h,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(h,this.stateCenter.reportList)(n.REPORT_ACTION.addEventMsg,\"liveroom_login\",\"respond_info\",r),this.resetTryLogin(),this.loginSuccessCallBack(s,e)},e.prototype.openHandler=function(){this.logger.info(\"zb.rh.oh websocket.onpen call\");var e=0!==this.stateCenter.reportSeqList.login?\"kZegoTaskLoginRoom\":\"kZegoTaskReLoginRoom\";i.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)(n.REPORT_ACTION.eventEndWithMsgInfo,\"create_socket\",{try_cnt:this.stateCenter.tryLoginCount}),this.socketCenter.responseHandler();var t=this.loginBodyData();this.logger.info(\"zb.rh.oh websocket.onpen send login\"),this.stateCenter.startloginTime=(new Date).getTime(),console.warn(\"start login\",this.stateCenter.startloginTime,this.stateCenter.startloginTime-this.stateCenter.startConnceTime),i.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)(n.REPORT_ACTION.eventStart,\"liveroom_login\"),this.socketCenter.sendMessage(\"login\",t),this.logger.debug(\"zb.rh.oh websocket.onpen call success\")},e.prototype.closeHandler=function(e){this.logger.info(\"zb.rh.ws.oc msg=\"+JSON.stringify(e)),this.stateCenter.runState!==o.ENUM_RUN_STATE.logout?this.stateCenter.runState===o.ENUM_RUN_STATE.trylogin&&this.stateCenter.tryLoginCount<=o.MAX_TRY_LOGIN_COUNT?this.logger.info(\"zb.rh.ws.oc is called because of try login\"):this.stateCenter.runState===o.ENUM_RUN_STATE.login?(this.logger.info(\"zb.rh.ws.oc is called because of network broken, try again\"),this.setRunState(o.ENUM_RUN_STATE.trylogin),this.resetTryLogin(),this.onConnecting({code:0,msg:\"\"}),this.tryLogin()):(this.logger.error(\"zb.rh.ws.oc out of think!!!\"),this.setRunState(o.ENUM_RUN_STATE.logout),this.resetRoom(),this.onDisconnect(l.errorCodeList.ROOM_INNER_ERROR)):this.logger.info(\"zb.rh.ws.oc onclose logout flow call websocket.close\")},e.prototype.logout=function(e){this.logger.info(\"zb.rh.lo call\"),this.stateCenter.runState!==o.ENUM_RUN_STATE.logout?(this.resetRoom(e),this.stateCenter.actionListener(\"roomStateUpdate\",e,\"DISCONNECTED\",0,\"\"),this.logger.info(\"zb.rh.lo call success\")):this.logger.warn(\"zb.rh.lo at logout\")},e.prototype.relogin=function(){this.logger.info(\"zb.rh.rl call\"),this.setRunState(o.ENUM_RUN_STATE.trylogin),this.stateCenter.roomSessionId=\"\";var e=this.loginBodyData();this.socketCenter.sendMessage(\"login\",e),this.logger.debug(\"zb.rh.rl call success\")},e.prototype.fetchUserList=function(e){this.logger.debug(\"zb.rh.ful call\"),this.stateCenter.userQuerying?this.logger.warn(\"zb.rh.ful is already querying\"):(this.stateCenter.userQuerying=!0,this.stateCenter.userTempList=[],\"V1\"===o.ROOMVERSION?this.fetchUserListWithPage(0,e||0):this.fetchUserListWithPageV2(0),this.logger.info(\"zb.rh.ful the first time call\"))},e.prototype.fetchUserListWithPageV2=function(e){var t=this;this.logger.debug(\"zb.rh.fulwp call\"),this.socketCenter.registerRouter(\"user_list_v2\",(function(r){t.handleFetchUserListRspV2(e,r)})),this.socketCenter.sendMessage(\"user_list_v2\",{marker:0===e?\"\":e+\"\",mode:0,limit:100}),this.logger.info(\"zb.rh.fulwp call success\")},e.prototype.fetchUserListWithPage=function(e,t){var r=this;this.logger.debug(\"zb.rh.fulwp call\"),this.socketCenter.registerRouter(\"user_list\",(function(e){r.handleFetchUserListRsp(e,t)})),this.socketCenter.sendMessage(\"user_list\",{user_index:e,sort_type:0}),this.logger.info(\"zb.rh.fulwp call success\")},e.prototype.handleFetchUserListRspV2=function(e,t){if(this.logger.debug(\"zb.rh.hfulr call\"),0!=t.body.err_code)return this.stateCenter.userQuerying=!1,this.stateCenter.lastUserQueryTime=Date.now()+this.stateCenter.userListInterval,void this.logger.info(\"zb.rh.hfulr fetch error \"+t.body.err_code);if(this.stateCenter.userStateUpdate){if(this.stateCenter.userTempList=s(this.stateCenter.userTempList,t.body.user_baseinfos),e!=t.body.marker)return this.logger.warn(\"zb.rh.hfulr fetch another page\"),void this.fetchUserListWithPageV2(e+1);this.stateCenter.userSeq=t.body.server_user_seq,this.logger.info(\"zb.rh.hfulr set user Seq \"+this.stateCenter.userSeq);for(var r=[],o=0;o<this.stateCenter.userTempList.length;o++){var i={userId:this.stateCenter.userTempList[o].id_name,userName:this.stateCenter.userTempList[o].nick_name};r.push(i)}this.stateCenter.userQuerying=!1,this.stateCenter.lastUserQueryTime=Date.now()+this.stateCenter.userListInterval,this.stateCenter.userTempList=[],this.logger.info(\"zb.rh.hfulr call success user_list \"+r+\" count \"+r.length)}},e.prototype.handleFetchUserListRsp=function(e,t){var r=this;if(this.logger.debug(\"zb.rh.hfulr call\"),0!=e.body.err_code)return this.stateCenter.userQuerying=!1,this.stateCenter.lastUserQueryTime=Date.now()+this.stateCenter.userListInterval,void this.logger.info(\"zb.rh.hfulr fetch error \"+e.body.err_code);if(this.stateCenter.userStateUpdate){this.stateCenter.userTempList=s(this.stateCenter.userTempList,e.body.user_baseinfos);var a=e.body.ret_user_index;if(a!=e.body.server_user_index)return this.logger.warn(\"zb.rh.hfulr fetch another page\"),void this.fetchUserListWithPage(a+1,t);this.stateCenter.userSeq=e.body.server_user_seq,this.logger.info(\"zb.rh.hfulr set user Seq \"+this.stateCenter.userSeq);for(var n=[],l=0;l<this.stateCenter.userTempList.length;l++){var d={userID:this.stateCenter.userTempList[l].id_name,userName:this.stateCenter.userTempList[l].nick_name};n.push(d)}t==o.ENUM_RUN_STATE.login?(i.ClientUtil.mergeUserList(this.logger,this.stateCenter.userList,n,(function(e,t){0!==e.length&&r.onUserStateUpdate(r.stateCenter.roomid,\"ADD\",e),0!==t.length&&r.onUserStateUpdate(r.stateCenter.roomid,\"DELETE\",t)})),this.stateCenter.userList=n):(this.stateCenter.userList=n,0!==n.length&&this.onUserStateUpdate(this.stateCenter.roomid,\"ADD\",n)),this.stateCenter.userQuerying=!1,this.stateCenter.lastUserQueryTime=Date.now()+this.stateCenter.userListInterval,this.stateCenter.userTempList=[],this.logger.info(\"zb.rh.hfulr call success user_list \"+n+\" count \"+n.length)}},e.prototype.handleLogoutRsp=function(e){this.logger.debug(\"zb.rh.hlor result=\",e.body.err_code)},e.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info(\"zb.rh.hpus call\"),this.stateCenter.isLogin())if(this.stateCenter.userStateUpdate)if(this.stateCenter.userSeq+e.body.user_actions.length===e.body.user_list_seq){this.stateCenter.userSeq=e.body.user_list_seq,this.logger.debug(\"zb.rh.hpus push userSeq \"+this.stateCenter.userSeq);for(var t=[],r=0;r<e.body.user_actions.length;r++){var s={action:e.body.user_actions[r].Action,idName:e.body.user_actions[r].IdName,nickName:e.body.user_actions[r].NickName,loginTime:e.body.user_actions[r].LoginTime};t.push(s)}var o=[],i=[];t.forEach((function(e){1==e.action?o.push({userID:e.idName,userName:e.nickName}):2==e.action&&i.push({userID:e.idName,userName:e.nickName})})),this.stateCenter.userList=this.stateCenter.userList.concat(o).filter((function(e){return!i.some((function(t){return t.userID==e.userID}))})),0!==o.length&&this.onUserStateUpdate(e.body.room_id,\"ADD\",o),0!==i.length&&this.onUserStateUpdate(e.body.room_id,\"DELETE\",i),this.logger.info(\"zb.rh.hpus call success\")}else this.mergeUserByUserSeq(e.body.user_list_seq,e.body.user_actions);else this.logger.info(\"zb.rh.hpus no userStateUpdate flag\");else this.logger.error(\"zb.rh.hpus not login\")},e.prototype.onUserStateUpdate=function(e,t,r){},e.prototype.mergeUserByUserSeq=function(e,t){var r=this;this.stateCenter.userSeqMergeMap||(this.logger.warn(\"zb.rh.hpus new merge userlist \"+this.stateCenter.userSeq+\" server \"+e),this.stateCenter.userSeqMergeMap={},this.stateCenter.userSeqMergeTimer&&clearTimeout(this.stateCenter.userSeqMergeTimer),this.stateCenter.userSeqMergeTimer=setTimeout((function(){var e=Object.keys(r.stateCenter.userSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));if(e[e.length-1]-e[0]+1===e.length)r.mergeUser(e);else{r.stateCenter.userSeqMergeMap=null;var t=r.stateCenter.lastUserQueryTime-Date.now();r.logger.info(\"zb.rh.hpus fetch merge userlist \"+r.stateCenter.userSeq+\" userSeqList \"+e.join(\",\")+\" wait \"+t),t>0?(r.stateCenter.userQueryTimer&&clearTimeout(r.stateCenter.userQueryTimer),r.stateCenter.userQueryTimer=setTimeout((function(){r.fetchUserList()}),t)):r.fetchUserList()}}),this.stateCenter.userListMergeInterval)),this.logger.warn(\"zb.rh.hpus merge userlist \"+this.stateCenter.userSeq+\" server \"+e+\" userlist \"+t.length),this.stateCenter.userSeqMergeMap[e]=t},e.prototype.mergeUser=function(e){var t=this;this.logger.info(\"zb.rh.hpus merge userlist \"+this.stateCenter.userSeq+\" userSeqList \"+e.join(\",\")),this.stateCenter.userSeq=e[e.length-1];var r={};e.forEach((function(e){t.stateCenter.userSeqMergeMap[e].forEach((function(e){r[e.IdName]=e}))})),this.stateCenter.userSeqMergeMap=null;var s=Object.values(r).map((function(e){return{action:e.Action,idName:e.IdName,nickName:e.NickName,role:e.Role,loginTime:e.LoginTime?String(e.LoginTime):\"\"}}));s.sort((function(e,t){return e.loginTime.localeCompare(t.loginTime)}));var o=[],i=[];s.forEach((function(e){1==e.action?o.push({userID:e.idName,userName:e.nickName}):2==e.action&&i.push({userID:e.idName,userName:e.nickName})})),this.stateCenter.userList=this.stateCenter.userList.concat(o).filter((function(e){return!i.some((function(t){return t.userID==e.userID}))})),0!==o.length&&this.onUserStateUpdate(this.stateCenter.roomid,\"ADD\",o),0!==i.length&&this.onUserStateUpdate(this.stateCenter.roomid,\"DELETE\",i)},e}();t.RoomHandler=d},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.StreamHandler=void 0;var s=r(0),o=r(1),i=r(2),a=r(4),n=function(){function e(e,t,r,s){this.logger=e,this.socketCenter=r,this.stateCenter=t,this.dataReport=s}return e.prototype.setCDNInfo=function(e,t){},e.prototype.onStreamUpdated=function(e,t,r){},e.prototype.onStreamExtraInfoUpdated=function(e,t){},e.prototype.handleStreamStart=function(e,t){var r=this;if(this.stateCenter.streamQuerying=!1,this.socketCenter.registerRouter(\"stream\",(function(e){r.handleStreamUpdateRsp(e)})),this.socketCenter.registerRouter(\"push_stream_update\",(function(e){r.handlePushStreamUpdateMsg(e)})),this.stateCenter.reportSeqList.relogin&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,o.ClientUtil.unregisterCallback(\"kZegoTaskReLoginRoom\",this.stateCenter.reportList)),this.stateCenter.actionListener(\"roomStateUpdate\",this.stateCenter.roomid,\"CONNECTED\",0,\"\"),e==s.ENUM_RUN_STATE.login)this.logger.info(\"zb.sh.hss recover from disconnect so call streamupdate\"),this.handleFullUpdateStream(t.body.stream_seq,t.body.stream_info||[]);else{this.logger.info(\"zb.sh.hss success callback user\"),this.stateCenter.streamList=t.body.stream_info||[],this.stateCenter.streamSeq=t.body.stream_seq;for(var i=0;i<this.stateCenter.streamList.length;i++)this.stateCenter.streamList[i].anchor_id_name==this.stateCenter.idName&&(this.updateStreamInfo(this.stateCenter.streamList[i].stream_id,s.ENUM_STREAM_SUB_CMD.liveEnd),this.stateCenter.streamList.splice(i--,1));var a=this.makeCallbackStreamList(this.stateCenter.streamList);o.ClientUtil.actionSuccessCallback(\"login\",this.stateCenter.callbackList)&&o.ClientUtil.actionSuccessCallback(\"login\",this.stateCenter.callbackList)(!0),a.length>0&&this.onStreamUpdated(this.stateCenter.roomid,s.ENUM_STREAM_UPDATE_TYPE.added,a)}},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype.updateStreamInfo=function(e,t,r,s){var o=this;void 0===r&&(r=\"\"),this.logger.debug(\"zb.sh.usi call\");var i={stream_id:e,extra_info:r},a={sub_cmd:t,stream_msg:JSON.stringify(i)};this.socketCenter.registerRouter(\"stream\",(function(e){o.handleStreamUpdateRsp(e)})),this.socketCenter.sendMessage(\"stream\",a,void 0,s),this.logger.info(\"zb.sh.usi call success cmd \"+t)},e.prototype.handleStreamUpdateRsp=function(e){if(this.stateCenter.isLogin())if(0==e.body.err_code){this.logger.info(\"zb.sh.hsur stream seq \"+this.stateCenter.streamSeq+\" server seq \"+e.body.stream_seq),this.stateCenter.streamSeq=e.body.stream_seq;for(var t=0;t<e.body.stream_info.length;t++){var r=e.body.stream_info[t].stream_id;if(!this.stateCenter.publishStreamList[r])return void this.logger.info(\"hsur.0 stream is not exist\");this.stateCenter.publishStreamList[r].state==s.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.stateCenter.publishStreamList[r].state=s.ENUM_PUBLISH_STREAM_STATE.publishing,this.onPublishStateUpdate(0,r,{code:0,msg:\"\"}))}}else this.logger.error(\"zb.sh.hsur stream update error \"+e.body.err_code);else this.logger.error(\"zb.sh.hsur not login\")},e.prototype.handleFetchStreamListRsp=function(e){this.logger.info(\"zb.sh.hfslr call\"),this.stateCenter.streamQuerying=!1,0===e.body.err_code?this.stateCenter.streamSeq!==e.body.stream_seq?(this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info),this.logger.debug(\"zb.sh.hfslr call success\")):this.logger.info(\"zb.sh.hfslr same seq\"):this.logger.info(\"zb.sh.hfslr server error=\",e.body.err_code)},e.prototype.handleFullUpdateStream=function(e,t){var r=this;this.logger.debug(\"zb.sh.hfus call\"),this.stateCenter.streamSeq=e,this.logger.debug(\"zb.sh.hfus server seq \"+this.stateCenter.streamSeq),o.ClientUtil.mergeStreamList(this.logger,this.stateCenter.idName,this.stateCenter.streamList,t,(function(e,t,o){0!==e.length&&(r.logger.debug(\"zb.sh.hfus callback addstream\"),r.onStreamUpdated(r.stateCenter.roomid,s.ENUM_STREAM_UPDATE_TYPE.added,r.makeCallbackStreamList(e))),0!==t.length&&(r.logger.debug(\"zb.sh.hfus callback delstream\"),r.onStreamUpdated(r.stateCenter.roomid,s.ENUM_STREAM_UPDATE_TYPE.deleted,r.makeCallbackStreamList(t))),0!==o.length&&(r.logger.debug(\"zb.sh.hfus callback updatestream\"),r.onStreamExtraInfoUpdated(r.stateCenter.roomid,r.makeCallbackStreamList(o)))})),this.logger.info(\"zb.sh.hfus call success\")},e.prototype.handlePushStreamUpdateMsg=function(e){if(this.logger.info(\"zb.sh.hpsum call\"),e.body.stream_info&&0!==e.body.stream_info.length){if(e.body.stream_info.length+this.stateCenter.streamSeq!==e.body.stream_seq)return this.logger.info(\"zb.sh.hpsum call updatestream\"),void this.fetchStreamList();switch(this.stateCenter.streamSeq=e.body.stream_seq,e.body.stream_cmd){case s.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(e.body.stream_info);break;case s.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(e.body.stream_info);break;case s.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(e.body.stream_info)}this.logger.info(\"zb.sh.hpsum call success\")}else this.logger.info(\"zb.sh.hpsum, emtpy list\")},e.prototype.handleAddedStreamList=function(e){this.logger.debug(\"zb.sh.hasl call\");for(var t,r=[],o=0;o<e.length;o++)if(e[o].anchor_id_name!=this.stateCenter.idName){t=!1;for(var i=0;i<this.stateCenter.streamList.length;i++)if(e[o].stream_id===this.stateCenter.streamList[i].stream_id){t=!0;break}t||r.push(e[o])}else this.logger.debug(\"hdsl.0 have self stream added\");if(0!==r.length){this.logger.debug(\"zb.sh.hasl callback addstream\");for(var a=0;a<r.length;a++)this.stateCenter.streamList.push(r[a]);this.onStreamUpdated(this.stateCenter.roomid,s.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(r))}this.logger.info(\"zb.sh.hasl call success\")},e.prototype.handleDeletedStreamList=function(e){this.logger.debug(\"zb.sh.hdsl call\");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName){for(var o=this.stateCenter.streamList.length-1;o>=0;o--)if(e[r].stream_id===this.stateCenter.streamList[o].stream_id){this.stateCenter.streamList.splice(o,1),t.push(e[r]);break}}else this.logger.debug(\"zb.sh.hdsl have self stream deleted\");0!==t.length&&(this.logger.debug(\"zb.sh.hdsl callback delstream\"),this.onStreamUpdated(this.stateCenter.roomid,s.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(t))),this.logger.info(\"zb.sh.hdsl call\")},e.prototype.handleUpdatedStreamList=function(e){this.logger.debug(\"zb.sh.husl call\");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName){for(var s=0;s<this.stateCenter.streamList.length;s++)if(e[r].stream_id===this.stateCenter.streamList[s].stream_id){e[r].extra_info!==this.stateCenter.streamList[s].extra_info&&(this.stateCenter.streamList[s]=e[r],t.push(e[r]));break}}else this.logger.debug(\"hsul.0 have self stream updated\");0!==t.length&&(this.logger.debug(\"zb.sh.husl callback updatestream\"),this.onStreamExtraInfoUpdated(this.stateCenter.roomid,this.makeCallbackStreamList(t))),this.logger.info(\"zb.sh.husl call success\")},e.prototype.fetchStreamList=function(){if(this.logger.info(\"zb.sh.fsl call\"),this.stateCenter.isLogin())if(this.stateCenter.streamQuerying)this.logger.info(\"zb.sh.fsl already doing\");else{this.stateCenter.streamQuerying=!0,this.logger.debug(\"zb.sh.fsl send fetch request\");this.socketCenter.registerRouter(\"stream_info\",this.handleFetchStreamListRsp.bind(this)),this.socketCenter.sendMessage(\"stream_info\",{reserve:0}),this.logger.debug(\"zb.sh.fsl call success\")}else this.logger.info(\"zb.sh.fsl state error\")},e.prototype.makeCallbackStreamList=function(e){var t=[];if(e&&e.length>0)for(var r=0;r<e.length;r++){var s={user:{userID:e[r].anchor_id_name,userName:e[r].anchor_nick_name},extraInfo:e[r].extra_info,streamID:e[r].stream_id,roomID:\"\",urlFlv:\"\",urlRtmp:\"\",urlHls:\"\",urlHttpsFlv:\"\",urlHttpsHls:\"\"};this.setCDNInfo(s,e[r]),t.push(s)}return t},e.prototype.updateMixStream=function(e,t,r){var n,l=this;if(this.logger.info(\"zb.sh.ums call\"),!e.taskID)return this.logger.error(\"zb.sh.ums no taskId found\"),r({errorCode:a.errorCodeList.MIXER_TASK_ID_NULL.code,extendedData:\"\"}),!1;if(\"string\"!=typeof e.taskID)return this.logger.error(\"zb.rh.lg taskId must be string\"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1;if(e.taskID.length>s.MAX_MIX_TASK_ID_LENGTH)return this.logger.error(\"zb.sh.ums taskId is too long\"),r({errorCode:a.errorCodeList.MIXER_TASK_ID_TOO_LONG.code,extendedData:\"\"}),!1;if(!o.ClientUtil.checkIllegalCharacters(e.taskID))return this.logger.error(\"zb.sh.ums task ID contains illegal characters\"),r({errorCode:a.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER.code,extendedData:\"\"}),!1;if(!e.inputList||0==e.inputList.length)return this.logger.error(\"zb.sh.ums input list wrong\"),r({errorCode:a.errorCodeList.MIXER_INPUTLIST_NULL.code,extendedData:\"\"}),!1;e.inputList.forEach((function(e){\"AUDIO\"===e.contentType&&(!e.layout&&(e.layout={top:0,left:0,bottom:0,right:0}),e.layout.top=0,e.layout.left=0,e.layout.bottom=1,e.layout.right=1)}));for(var d=e.inputList.every((function(e){return\"AUDIO\"===e.contentType})),u=0;u<e.inputList.length;u++){var h=e.inputList[u];if(\"object\"!=typeof h.layout)return this.logger.error(\"zb.sh.ums input layout must be object\"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1;if(!(o.ClientUtil.checkInteger(h.layout.top,!1)&&o.ClientUtil.checkInteger(h.layout.bottom,!1)&&o.ClientUtil.checkInteger(h.layout.left,!1)&&o.ClientUtil.checkInteger(h.layout.right,!1)))return this.logger.error(\"zb.sh.ums top、left、bottom、right must be integer number\"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1}if(!e.outputList||0==e.outputList.length)return this.logger.error(\"zb.sh.ums no output list found\"),r({errorCode:a.errorCodeList.MIXER_OUTPUTLIST_NULL.code,extendedData:\"\"}),!1;if(e.outputList.some((function(e){return\"string\"==typeof e&&!o.ClientUtil.isUrl(e)&&!o.ClientUtil.checkIllegalCharacters(e)||\"object\"==typeof e&&e.target&&!o.ClientUtil.isUrl(e.target)&&!o.ClientUtil.checkIllegalCharacters(e.target)})))return this.logger.error(\"zb.sh.ums stream output target is incorrect\"),r({errorCode:a.errorCodeList.MIXER_OUTPUT_TARGET_INVALID.code,extendedData:\"\"}),!1;if(!(d||e.outputConfig&&\"object\"==typeof e.outputConfig))return this.logger.error(\"zb.sh.ums no output config found\"),r({errorCode:a.errorCodeList.MIXER_NO_OUTPUT_TARGET.code,extendedData:\"\"}),!1;if(d&&(void 0===e.outputConfig&&(e.outputConfig={outputBitrate:0,outputFPS:0,outputWidth:0,outputHeight:0}),e.outputConfig.outputBitrate=.001,e.outputConfig.outputFPS=1,e.outputConfig.outputWidth=1,e.outputConfig.outputHeight=1),!(d||e.outputConfig.outputBitrate&&o.ClientUtil.checkInteger(e.outputConfig.outputBitrate)))return this.logger.error(\"zb.sh.ums bitrate param is required and must be integer number\"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1;if(!e.outputConfig.outputFPS||!o.ClientUtil.checkInteger(e.outputConfig.outputFPS))return this.logger.error(\"zb.sh.ums fps param is required and must be integer number\"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1;if(!e.outputConfig.outputWidth||!o.ClientUtil.checkInteger(e.outputConfig.outputWidth))return this.logger.error(\"zb.sh.ums width param is required and must be integer number\"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1;if(!e.outputConfig.outputHeight||!o.ClientUtil.checkInteger(e.outputConfig.outputHeight))return this.logger.error(\"zb.sh.ums height param is required and must be integer number\"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1;if(void 0!==e.outputConfig.outputAudioCodecID&&!o.ClientUtil.checkInteger(e.outputConfig.outputAudioCodecID,!1))return this.logger.error(\"zb.sh.ums AudioCodecID param must be integer number\"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1;if(void 0!==e.outputConfig.outputAudioBitrate&&!o.ClientUtil.checkInteger(e.outputConfig.outputAudioBitrate))return this.logger.error(\"zb.sh.ums AudioBitrate param must be integer number\"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1;if(void 0!==e.outputConfig.outputAudioChannels&&!o.ClientUtil.checkInteger(e.outputConfig.outputAudioChannels,!1))return this.logger.error(\"zb.sh.ums AudioChannels param must be integer number\"),r({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1;var g=0;e.outputConfig.singleStreamPassThrough&&\"boolean\"==typeof e.outputConfig.singleStreamPassThrough&&(g=e.outputConfig.singleStreamPassThrough?1:0);var c={task_id:e.taskID,id_name:this.stateCenter.idName,live_channel:this.stateCenter.roomid,appid:this.stateCenter.appid,version:s.PROTO_VERSION,bypass:g},p=this.stateCenter.mixStreamAdvance;p&&(p.videoCodec&&(c.extra_params=[{key:\"video_encode\",value:p.videoCodec}]),p.backgroundColor&&(c.output_bg_color=p.backgroundColor),p.backgroundImage&&(c.output_bg_image=p.backgroundImage),p.waterMark&&(c.watermark=p.waterMark),p.extraParams&&(!c.extra_params&&(c.extra_params=[]),(n=c.extra_params).push.apply(n,p.extraParams)));var m=[];for(u=0;u<e.inputList.length;u++){var _=e.inputList[u],C=_.streamID;this.stateCenter.testEnvironment&&(C=\"zegotest-\"+this.stateCenter.appid+\"-\"+_.streamID),m.push({stream_id:C,content_control:\"AUDIO\"===_.contentType?1:0,rect:{layer:u,top:_.layout.top,left:_.layout.left,bottom:_.layout.bottom,right:_.layout.right}})}c.MixInput=m,o.ClientUtil.actionSuccessCallback(\"kZegoTaskMixStart\"+e.taskID,this.stateCenter.reportList)&&o.ClientUtil.actionSuccessCallback(\"kZegoTaskMixStart\"+e.taskID,this.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{mix_stream_id:e.taskID,stream_cnt:m.length,input_stream_list:m});var E=[];e.outputList.forEach((function(t){var s={},o=\"\";if(\"string\"==typeof t)o=t;else{if(\"object\"!=typeof t||!t.target)return l.logger.error(\"zb.sh.ums output target required\"),r({errorCode:a.errorCodeList.MIXER_OUTPUTLIST_NULL.code,extendedData:\"\"}),!1;o=t.target}o.startsWith(\"rtmp://\")||o.startsWith(\"https://\")&&o.endsWith(\".flv\")||o.startsWith(\"https://\")&&o.endsWith(\".m3u8\")?s.mixurl=o:l.stateCenter.testEnvironment?s.stream_id=\"zegotest-\"+l.stateCenter.appid+\"-\"+o:s.stream_id=o,s.bitrate=1e3*e.outputConfig.outputBitrate,s.fps=e.outputConfig.outputFPS,s.width=e.outputConfig.outputWidth,s.height=e.outputConfig.outputHeight,e.outputConfig.outputAudioCodecID&&(s.audio_enc_id=e.outputConfig.outputAudioCodecID),\"vp8\"===p.videoCodec?s.audio_enc_id=3:\"h264\"===p.videoCodec&&(s.audio_enc_id=0),e.outputConfig.outputAudioBitrate&&(s.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),e.outputConfig.outputAudioChannels&&(s.audio_channel_cnt=e.outputConfig.outputAudioChannels),l.stateCenter.testEnvironment?s.testenv=1:s.testenv=0,E.push(s)})),c.MixOutput=E,o.ClientUtil.actionSuccessCallback(\"kZegoTaskMixStart\"+e.taskID,this.stateCenter.reportList)&&o.ClientUtil.actionSuccessCallback(\"kZegoTaskMixStart\"+e.taskID,this.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{output_target_list:E});var f={channel:\"zeus\",cmd:\"start_mix\",req_body:JSON.stringify(c)};return this.logger.debug(\"zb.sh.ums send command\"),this.sendBizChannelRequest(f,(function(e,i,a){l.logger.debug(\"zb.sh.ums receive message\");var n=\"zegotest-\"+l.stateCenter.appid+\"-\";if(0!=a.length){for(var d=JSON.parse(a),u=[],h=0;h<d.play.length;h++){var g={rtmpURL:\"\",hlsURL:\"\",flvURL:\"\"},c=d.play[h].stream_alias||\"\";l.stateCenter.testEnvironment&&c&&c.startsWith(n)&&(c=c.slice(n.length)),g.streamID=c,d.play[h].rtmp_url&&d.play[h].rtmp_url.length>0&&(g.rtmpURL=d.play[h].rtmp_url),d.play[h].hls_url&&d.play[h].hls_url.length>0&&(g.hlsURL=d.play[h].hls_url),d.play[h].hdl_url&&d.play[h].hdl_url.length>0&&(g.flvURL=d.play[h].hdl_url),u.push(g)}if(t){var p={mixerOutputList:u};t({errorCode:0,extendedData:JSON.stringify(p)})}}else r&&r({errorCode:o.ClientUtil.getServerError(s.MIXSTREAM_ERROR_CODE+1).code,extendedData:\"\"})}),(function(e,t,s){if(\"number\"==typeof e){l.logger.debug(\"zb.sh.ums error: \"+e);var i=[];if(1000000150==e&&0!=s.length)for(var n=JSON.parse(s),d=\"zegotest-\"+l.stateCenter.appid+\"-\",u=0;u<n.non_exist_streams.length;u++){var h=n.non_exist_streams[u];l.stateCenter.testEnvironment&&h.startsWith(d)?i.push(h.slice(d.length)):i.push(h)}r&&r({errorCode:o.ClientUtil.getServerError(e).code,extendedData:\"\"})}else{l.logger.debug(\"zb.sh.ums error code \"+e.code);var g=void 0;g=e==a.errorCodeList.TIMEOUT?a.errorCodeList.MIXER_START_REQUEST_ERROR:a.errorCodeList.MIXER_INNER_ERROR,r&&r({errorCode:g.code,extendedData:\"\"})}})),!0},e.prototype.sendBizChannelRequest=function(e,t,r,s){var o=this;void 0===s&&(s=!1),e=Object.assign(e,{is_retry_req:s?1:0}),this.socketCenter.sendMessage(\"biz_channel\",e,t,(function(s,i,a,n){\"number\"!=typeof s||2002!==s||n?r(s,i,a):o.sendBizChannelRequest(e,t,r,!0)}),s)},e.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise((function(r,s){var n={},l={};if(e&&e.videoCodec){var d=e.videoCodec.toLowerCase();if(-1==[\"vp8\",\"h264\"].indexOf(d))return t.logger.error(\"zb.sh.ums param videoCode error\"),s({errorCode:a.errorCodeList.MIXER_VIDEO_CONFIG_INVALID.code,extendedData:\"\"}),!1;n.videoCodec=d,l.video_codec=d}if(e.backgroundColor){if(!o.ClientUtil.checkInteger(e.backgroundColor))return t.logger.error(\"zb.sh.ums param backgroundColor must be integer number\"),s({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1;n.backgroundColor=e.backgroundColor,l.background_color=e.backgroundColor}if(e.backgroundImage){if(\"string\"!=typeof e.backgroundImage)return t.logger.error(\"zb.sh.ums param outputBgImage error\"),s({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:\"\"}),!1;if(!e.backgroundImage.startsWith(\"preset-id://\")||!e.backgroundImage.endsWith(\".jpg\")&&!e.backgroundImage.endsWith(\".png\"))return t.logger.error(\"zb.sh.ums illegal input background image URL\"),s({errorCode:a.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID.code,extendedData:\"\"}),!1;n.backgroundImage=e.backgroundImage,l.background_image=e.backgroundImage}e.waterMark&&(n.waterMark=e.waterMark,l.water_mark=e.waterMark),t.stateCenter.mixStreamAdvance=n,o.ClientUtil.actionSuccessCallback(\"kZegoTaskMixConfig\",t.stateCenter.reportList)&&o.ClientUtil.actionSuccessCallback(\"kZegoTaskMixConfig\",t.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{config:l}),r({errorCode:0,extendedData:\"\"})}))},e.prototype.publishTarget=function(e,t,r){var i=this;if(-1!=[\"addpush\",\"delpush\",\"clearpush\"].indexOf(e.type)){this.logger.info(\"zb.sh.ptcall\");var a=Math.ceil((new Date).getTime()/1e3),n=e.streamID;this.stateCenter.testEnvironment&&(n=\"zegotest-\"+this.stateCenter.appid+\"-\"+e.streamID);var l={appid:this.stateCenter.appid,biz_type:0,timestamp:a,signature:e.signature,seq:this.stateCenter.cdnSeq++,version:1*s.PROTO_VERSION,stream_id:n,pushurl:e.pushUrl},d={channel:\"media\",cmd:e.type,req_body:JSON.stringify(l)};this.logger.debug(\"zb.sh.pt send command\"),this.sendBizChannelRequest(d,(function(a,n,l){if(i.logger.debug(\"zb.sh.pt receive message\"),0!=l.length){var d=JSON.parse(l),u=d.code,h=d.message;if(u&&0!=u)return i.logger.error(\"zb.sh.pt \"+e.type+\" error code: \"+u+\" \"+h),void(r&&r({errorCode:u}));i.logger.info(\"zb.sh.pt \"+e.type+\" success\"),t&&t({errorCode:0})}else r&&r({errorCode:o.ClientUtil.getServerError(s.MIXSTREAM_ERROR_CODE+1).code})}),(function(e,t,s){i.logger.debug(\"zb.sh.pt error: \"+r);var o=\"\";2001==e?o=\"invalid channel\":2002==e&&(o=\"bizchannel error\"),i.logger.error(\"zb.sh.pt \"+o),r&&r({errorCode:e})}))}else this.logger.error(\"zb.sh.pt cdn push type error\")},e.prototype.stopMixStream=function(e,t,r){var i=this;this.logger.info(\"zb.sh.sms call\");var n={id_name:this.stateCenter.idName,live_channel:this.stateCenter.roomid,appid:this.stateCenter.appid,version:s.PROTO_VERSION,task_id:e},l={channel:\"zeus\",cmd:\"stop_mix\",req_body:JSON.stringify(n)};return this.sendBizChannelRequest(l,(function(){t&&t({errorCode:0})}),(function(e){if(\"number\"==typeof e)r&&r({errorCode:o.ClientUtil.getServerError(s.MIXSTREAM_ERROR_CODE+e).code,extendedData:\"\"});else{i.logger.error(\"zb.sh.sms stop mix fail \"+JSON.stringify(e));var t=void 0;t=e==a.errorCodeList.TIMEOUT?a.errorCodeList.MIXER_STOP_REQUEST_ERROR:a.errorCodeList.MIXER_INNER_ERROR,r&&r({errorCode:t.code,extendedData:\"\"})}})),!0},e.prototype.updateStreamExtraInfo=function(e,t){return this.logger.info(\"zb.sh.usei call\"),this.stateCenter.publishStreamList[e]&&(this.stateCenter.publishStreamList[e].extra_info=t,this.stateCenter.publishStreamList[e].state>=s.ENUM_PUBLISH_STREAM_STATE.update_info&&this.updateStreamInfo(e,s.ENUM_STREAM_SUB_CMD.liveUpdate,t)),!0},e}();t.StreamHandler=n},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.HeartBeatHandler=void 0;var s=r(0),o=r(1),i=r(2),a=r(3),n=r(4),l=function(){function e(e,t,r,s){this.logger=e,this.socketCenter=r,this.stateCenter=t,this.dataReport=s}return e.prototype.resetHeartbeat=function(){this.logger.debug(\"zb.hb.rht call\"),clearTimeout(this.stateCenter.heartbeatTimer),this.stateCenter.heartbeatTimer=null,clearTimeout(this.stateCenter.loginHeartbeatTimer),this.stateCenter.loginHeartbeatTimer=null,this.stateCenter.tryHeartbeatCount=0,this.logger.debug(\"zb.hb.rht call success\")},e.prototype.hbLogout=function(e){},e.prototype.fetchReliableMessage=function(e,t){},e.prototype.start=function(e){var t=this;this.logger.info(\"zb.hb.sht call\");var r=i.getReportSeq();if(this.dataReport.newReport(r,a.eventList.kZegoTaskLiveRoomhHB),this.dataReport.addMsgInfo(r,{room_sid:this.stateCenter.sessionid}),!this.stateCenter.isLogin())return this.logger.error(\"zb.hb.sht state error\"),this.dataReport.addMsgInfo(r,{error:a.errorList.kLiveRoomNotLoginError.code,message:a.errorList.kLiveRoomNotLoginError.message}),void this.dataReport.uploadReport(r);if(++this.stateCenter.tryHeartbeatCount>3)return this.logger.error(\"zb.hb.sht come to try limit\"),this.dataReport.addMsgInfo(r,{error:a.errorList.kLiveRoomHBTimeoutError.code,message:a.errorList.kLiveRoomHBTimeoutError.message}),this.dataReport.uploadReport(r),void this.hbLogout(n.errorCodeList.HEARTBEAT_TIMEOUT);this.logger.debug(\"zb.hb.sht send packet\");this.socketCenter.registerRouter(\"hb\",(function(e){if(0!==e.body.err_code){var s=o.ClientUtil.decodeServerError(e.body.err_code,e.body.err_message);t.dataReport.addMsgInfo(r,{error:s.code,message:s.message})}t.dataReport.uploadReport(r),t.handleHeartbeatRsp(e)})),this.socketCenter.sendMessage(\"hb\",{reserve:0}),this.logger.info(\"zb.hb.sht call success\"),this.stateCenter.heartbeatInterval=e,this.stateCenter.heartbeatTimer=setTimeout((function(){t.start(t.stateCenter.heartbeatInterval)}),this.stateCenter.heartbeatInterval)},e.prototype.relogin=function(){},e.prototype.handleHeartbeatRsp=function(e){if(this.logger.debug(\"zb.hb.hhbr call\"),e.body.err_code!=s.ERROR_CODES.ROOM_SESSION_ID_ERR){if(0!==e.body.err_code)return this.logger.error(\"zb.hb.hhbr call disconnect, server error=\",e.body.err_code),void this.hbLogout(o.ClientUtil.getServerError(e.body.err_code));for(var t in this.stateCenter.tryHeartbeatCount=0,this.stateCenter.heartbeatInterval=e.body.hearbeat_interval,this.stateCenter.heartbeatInterval<s.MINIUM_HEARTBEAT_INTERVAL&&(this.stateCenter.heartbeatInterval=s.MINIUM_HEARTBEAT_INTERVAL),e.body.bigim_time_window&&\"number\"==typeof e.body.bigim_time_window&&(this.stateCenter.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&\"number\"==typeof e.body.dati_time_window&&(this.stateCenter.datiTimeWindow=e.body.dati_time_window),this.ReliableMessageHandler(e),this.fetchStreamList(e),this.patchUserList(e),this.stateCenter.publishStreamList)this.stateCenter.publishStreamList[t].state==s.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.logger.info(\"zb.hb.hhbr try to update stream info\"),this.updateStreamInfo(t,s.ENUM_STREAM_SUB_CMD.liveBegin,this.stateCenter.publishStreamList[t].extra_info));null!=e.body.online_count&&0!=e.body.online_count&&this.onUpdateOnlineCount(this.stateCenter.roomid,e.body.online_count),this.logger.debug(\"zb.hb.hhbr call success\")}else this.hbLogout(n.errorCodeList.HEARTBEAT_TIMEOUT)},e.prototype.ReliableMessageHandler=function(e){var t=this;if(e.body.trans_seqs)for(var r=0;r<e.body.trans_seqs.length;r++){var s=e.body.trans_seqs[r].trans_channel,o=e.body.trans_seqs[r].trans_seq_array;(o=o.filter((function(e){var r=e.trans_type,s=e.trans_seq;return!t.stateCenter.transSeqMap[r]||t.stateCenter.transSeqMap[r].seq<s}))).length>0&&this.fetchReliableMessage(s,o)}},e.prototype.fetchStreamList=function(e){var t=this;e.body.stream_seq!==this.stateCenter.streamSeq&&(this.logger.debug(\"zb.hb.fsl current seq \"+this.stateCenter.streamSeq+\" server Seq \"+e.body.stream_seq),this.logger.debug(\"zb.hb.fsl call\"),this.stateCenter.isLogin()?this.stateCenter.streamQuerying?this.logger.warn(\"zb.hb.fsl already doing\"):(this.stateCenter.streamQuerying=!0,this.logger.debug(\"zb.hb.fsl send fetch request\"),this.socketCenter.registerRouter(\"stream_info\",(function(e){t.handleFetchStreamListRsp(e)})),this.socketCenter.sendMessage(\"stream_info\",{reserve:0}),this.logger.debug(\"zb.hb.fsl call success\")):this.logger.error(\"zb.hb.fsl state error\"))},e.prototype.patchUserList=function(e){var t=this;if(e.body.server_user_seq!==this.stateCenter.userSeq&&this.stateCenter.userStateUpdate&&!this.stateCenter.userSeqMergeMap){var r=this.stateCenter.lastUserQueryTime-Date.now();this.logger.info(\"zb.hb.hhbr call update user \"+this.stateCenter.userSeq+\" server \"+e.body.server_user_seq+\" wait \"+r),r>0?(this.stateCenter.userQueryTimer&&clearTimeout(this.stateCenter.userQueryTimer),this.stateCenter.userQueryTimer=setTimeout((function(){t.fetchUserList()}),r)):this.fetchUserList()}},e.prototype.handleFetchStreamListRsp=function(e){},e.prototype.fetchUserList=function(){},e.prototype.updateStreamInfo=function(e,t,r,s){void 0===r&&(r=\"\")},e.prototype.onUpdateOnlineCount=function(e,t){},e.prototype.onRecvReliableMessage=function(e){},e.prototype.resetCheckMessage=function(){this.logger.debug(\"zb.hb.rcm call\"),clearTimeout(this.stateCenter.sendDataCheckTimer),this.stateCenter.sendDataCheckTimer=null,this.checkSendMessageList(this.stateCenter.sendDataList),this.checkSendMessageList(this.stateCenter.sendCommandList),this.stateCenter.sendDataMap={},this.stateCenter.sendCommandMap={},this.logger.debug(\"zb.hb.rcm call success\")},e.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data.error&&(t._data.data.body.custom_msg?t._data.error(n.errorCodeList.TIMEOUT,t._data.data.header.seq,t._data.data.body.custom_msg):t._data.error(n.errorCodeList.TIMEOUT,t._data.data.header.seq)),t=e.getFirst()},e.prototype.checkMessageListTimeout=function(e,t){for(var r=e.getFirst(),s=Date.parse(new Date+\"\"),o=0,i=0,a=0;null!=r;){var l=\"biz_channel\"===r._data.data.header.cmd?this.stateCenter.sendDataBizTimeout:this.stateCenter.sendDataTimeout;if(r._data.time+l>s)break;if(delete t[r._data.data.header.seq],e.remove(r),++i,null==r._data.error||this.stateCenter.sendDataDropTimeout>0&&r._data.time+this.stateCenter.sendDataDropTimeout<s?++a:r._data.data.body.custom_msg?r._data.error(n.errorCodeList.TIMEOUT,r._data.data.header.seq,r._data.data.body.custom_msg):r._data.error(n.errorCodeList.TIMEOUT,r._data.data.header.seq),++o>=this.stateCenter.sendDataCheckOnceCount)break;r=e.getFirst()}0==i&&0==a||this.logger.debug(\"zb.hb.cmt call success, stat: timeout=\",i,\"drop=\",a)},e.prototype.startCheckMessageTimeout=function(){var e=this;this.stateCenter.isLogin()?(this.checkMessageListTimeout(this.stateCenter.sendDataList,this.stateCenter.sendDataMap),this.checkMessageListTimeout(this.stateCenter.sendCommandList,this.stateCenter.sendCommandMap),this.stateCenter.sendDataCheckTimer=setTimeout((function(){e.startCheckMessageTimeout()}),this.stateCenter.sendDataCheckInterval)):this.logger.error(\"zb.hb.scmt state error\")},e}();t.HeartBeatHandler=l},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.MessageHandler=void 0;var s=r(0),o=r(1),i=r(4),a=function(){function e(e,t,r,s){this.logger=e,this.socketCenter=r,this.stateCenter=t,this.dataReport=s}return e.prototype.sendCustomCommand=function(e,t,r,s){var a=this;if(this.logger.debug(\"zb.mh.scc call\"),this.stateCenter.isLogin()){var n={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:t||\"\",room_id:this.stateCenter.roomid},l={dest_id_name:e,custom_msg:JSON.stringify(n)};o.ClientUtil.checkCustomCommandParam(l)?(this.socketCenter.registerRouter(\"custommsg\",(function(e){a.handleSendCustomMsgRsp(e)})),this.socketCenter.sendCustomMessage(\"custommsg\",l,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var s=e[0],o=e[1];r({errorCode:s,messageID:o})}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,o=e[0],n=e[1];a.logger.error(\"zb.mh.scc \"+o.msg),r=o==i.errorCodeList.TIMEOUT?i.errorCodeList.IM_SEND_FAILED:o,s({errorCode:r.code,messageID:n})})),this.logger.info(\"zb.mh.scc call success\")):this.logger.error(\"zb.mh.scc param error\")}else this.logger.error(\"zb.mh.scc state error\")},e.prototype.handleSendCustomMsgRsp=function(e){this.logger.debug(\"zb.mh.hscmrcall\");var t,r=this.stateCenter.sendDataMap[e.header.seq];null!=r?(\"custommsg\"!=(t=r._data).data.header.cmd?this.logger.error(\"zb.mh.hscmrcmd wrong\"+t.data.header.cmd):0===e.body.err_code?(JSON.parse(t.data.body.custom_msg),null!=t.success&&t.success(0,e.body.msg_id)):null!=t.error&&t.error(o.ClientUtil.getServerError(e.body.err_code),e.body.msg_id),delete this.stateCenter.sendDataMap[e.header.seq],this.stateCenter.sendDataList.remove(r)):this.logger.error(\"zb.mh.hscmrno found seq=\"+e.header.seq),this.logger.debug(\"zb.mh.hscmr  call success\")},e.prototype.handlePushCustomMsg=function(e){var t=JSON.parse(e.body.custommsg);this.logger.debug(\"zb.mh.hpcm submsg=\",t),this.onRecvCustomCommand(t.from_userid,t.from_username,t.room_id,t.custom_content)},e.prototype.onRecvCustomCommand=function(e,t,r,s){},e.prototype.sendRoomMsg=function(e,t,r,s,o){var a=this;if(this.logger.debug(\"zb.mh.srm call\"),this.stateCenter.isLogin()){var n=Date.parse(new Date+\"\");if(this.stateCenter.sendRoomMsgTime>0&&this.stateCenter.sendRoomMsgTime+this.stateCenter.SendRoomMsgInterval>n)return this.logger.info(\"zb.mh.srm freq error\"),void(o&&o(i.errorCodeList.FREQ_LIMITED,0,e,r));this.stateCenter.sendRoomMsgTime=n,this.logger.debug(\"zb.mh.srm send fetch request\");var l={msg_category:e,msg_type:1,msg_content:r};this.socketCenter.registerRouter(\"im_chat\",(function(e){a.handleSendRoomMsgRsp(e)})),this.socketCenter.sendCustomMessage(\"im_chat\",l,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],o=e[1];s({errorCode:r,messageID:o})}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,s=e[0],n=e[1];a.logger.error(\"zb.mh.srm \"+s.msg),r=s==i.errorCodeList.TIMEOUT?i.errorCodeList.IM_SEND_FAILED:s,o({errorCode:r.code,messageID:n})})),this.logger.info(\"zb.mh.srm call success\")}else this.logger.error(\"zb.mh.srm state error\")},e.prototype.handleSendRoomMsgRsp=function(e){this.logger.debug(\"zb.mh.hsrmr call\");var t,r=this.stateCenter.sendDataMap[e.header.seq];null!=r?(\"im_chat\"!=(t=r._data).data.header.cmd?this.logger.error(\"zb.mh.hsrmr cmd wrong\"+t.data.header.cmd):0===e.body.err_code?t.success&&t.success(0,e.body.msg_id):t.error&&t.error(o.ClientUtil.getServerError(e.body.err_code),e.body.msg_id),delete this.stateCenter.sendDataMap[e.header.seq],this.stateCenter.sendDataList.remove(r)):this.logger.error(\"hzb.mh.hsrmr no found seq=\"+e.header.seq),this.logger.info(\"zb.mh.hsrmr call success\")},e.prototype.onRecvRoomMsg=function(e,t,r){},e.prototype.sendReliableMessage=function(e,t,r,s){this.logger.debug(\"zb.mh.srirm call\"),this.stateCenter.transSeqMap[e]||(this.stateCenter.transSeqMap[e]={seq:0});var o={trans_type:e,trans_data:t,trans_local_seq:this.stateCenter.transSeqMap[e].seq,trans_channel:\"clt\"};this.socketCenter.sendMessage(\"trans\",o,r,s)},e.prototype.sendBigRoomMessage=function(e,t,r,s,o){var i=this;console.log(t),this.logger.debug(\"zb.mh.sbim call\");var a=this.stateCenter.bigimTimeWindow,n=this.stateCenter.serverTimeOffset,l=(new Date).getTime()+n,d=(++this.stateCenter.cmdSeq).toString();if(this.stateCenter.bigImCallbackMap[d]={success:s,error:o},0==a){var u={msg_category:e,msg_type:1,msg_content:r,bigmsg_client_id:d};this.logger.debug(\"zb.mh.sbim no time window\"),this.sendBigRoomMessageInternal([u],(function(e){i.handleBigImMsgRsp(e)}),o)}else{var h=Math.floor(l/a);if(this.logger.debug(\"currentIndex \"+h+\" lastTimeIndex \"+this.stateCenter.bigImLastTimeIndex),this.stateCenter.bigImLastTimeIndex<h&&0==this.stateCenter.bigImMessageList.length){this.stateCenter.bigImLastTimeIndex=h;var g={msg_category:e,msg_type:1,msg_content:r,bigmsg_client_id:d};this.sendBigRoomMessageInternal([g],(function(e){i.handleBigImMsgRsp(e)}),o)}else this.stateCenter.bigImMessageList.push({msg_category:e,msg_type:1,msg_content:r,bigmsg_client_id:d}),1==this.stateCenter.bigImMessageList.length&&this.setBigImTimer(n,a)}},e.prototype.handlePushMergeMsg=function(e){if(this.stateCenter.isLogin()){for(var t=0;t<e.body.messages.length;t++)14001===e.body.messages[t].sub_cmd&&this.handlePushBigRooMsg(e.body.messages[t].msg_body);this.logger.debug(\"zb.mh.hpmm call success\")}else this.logger.error(\"zb.mh.hpmmnot login\")},e.prototype.handlePushBigRooMsg=function(e){var t;try{t=JSON.parse(e)}catch(e){return void this.logger.warn(\"zb.mh.hpbrm parse json error\")}if(t){for(var r=t.room_id,s=[],o=0;o<t.msg_data.length;o++){var i=t.msg_data[o];i.id_name!=this.stateCenter.idName?s.push({idName:i.id_name,nickName:i.nick_name,messageId:i.bigmsg_id,category:i.msg_category,type:i.msg_type,content:i.msg_content,time:i.send_time}):this.logger.debug(\"zb.mh.hpbrm self message\")}0==s.length?this.logger.debug(\"zb.mh.hpbrm no other pushData except self\"):this.onRecvBigRoomMessage(s,r),this.logger.debug(\"zb.mh.hpbrm call success\")}else this.logger.warn(\"zb.mh.hpbrm cann't find message body\")},e.prototype.onRecvBigRoomMessage=function(e,t){},e.prototype.sendBigRoomMessageInternal=function(e,t,r){this.logger.debug(\"zb.mh.sbim call\");var s={msgs:e};this.socketCenter.sendMessage(\"bigim_chat\",s,t,r)},e.prototype.handleBigImMsgRsp=function(e){if(this.stateCenter.isLogin()){this.stateCenter.bigimTimeWindow!=e.body.bigim_time_window&&(this.stateCenter.bigimTimeWindow=e.body.bigim_time_window);for(var t=0;t<e.body.msgs.length;t++){var r=e.body.msgs[t].bigmsg_client_id,s=e.body.msgs[t].bigmsg_id;if(this.stateCenter.bigImCallbackMap[r]){var o=this.stateCenter.bigImCallbackMap[r].success;null!=o&&o({errorCode:0,messageID:s}),delete this.stateCenter.bigImCallbackMap[r]}}}else this.logger.info(\"zb.mh.hbmr not login\")},e.prototype.setBigImTimer=function(e,t){var r=this,s=t-((new Date).getTime()+e)%t,i=o.ClientUtil.generateRandumNumber(t)+s;this.logger.info(\"zb.mh.sbt setTimer \"+i),this.stateCenter.bigImTimer=setTimeout((function(){r.onBigImTimer()}),i)},e.prototype.onBigImTimer=function(){var e=this,t=(new Date).getTime()+this.stateCenter.serverTimeOffset;this.stateCenter.bigImLastTimeIndex=Math.floor(t/this.stateCenter.bigimTimeWindow);for(var r=[],s=[],o=0;o<this.stateCenter.bigImMessageList.length&&!(o>=20);o++){var i=this.stateCenter.bigImMessageList[o];r.push({msg_category:i.msg_category,msg_type:i.msg_type,msg_content:i.msg_content,bigmsg_client_id:i.bigmsg_client_id}),s.push(i.bigmsg_client_id)}this.stateCenter.bigImMessageList.length>20?this.stateCenter.bigImMessageList.splice(0,20):this.stateCenter.bigImMessageList=[],this.sendBigRoomMessageInternal(r,(function(t){e.handleBigImMsgRsp(t)}),(function(t,r){for(var o=0;o<s.length;o++){var i=s[o],a=e.stateCenter.bigImCallbackMap[i];a&&(null!=a.error&&a.error(t,r),delete e.stateCenter.bigImCallbackMap[i])}})),clearTimeout(this.stateCenter.bigImTimer),this.stateCenter.bigImTimer=null,this.stateCenter.bigImMessageList.length>0&&this.setBigImTimer(this.stateCenter.serverTimeOffset,this.stateCenter.bigimTimeWindow)},e.prototype.sendRelayMessage=function(e,t,r,s){this.logger.debug(\"zb.mh.srm call\");var o=this.stateCenter.datiTimeWindow,i=this.stateCenter.serverTimeOffset;o>0?(this.stateCenter.realyMessageList.push({type:e,data:t,success:r,error:s}),1==this.stateCenter.realyMessageList.length&&this.setRelayTimer(i,o)):this.sendRelayMessageInternal(e,t,r,s)},e.prototype.sendRelayMessageInternal=function(e,t,r,s){this.logger.debug(\"zb.mh.srmi call\");var o={relay_type:e,relay_data:t};this.socketCenter.sendMessage(\"relay\",o,r,s)},e.prototype.setRelayTimer=function(e,t){var r=this,s=2*t-((new Date).getTime()+e)%t,i=o.ClientUtil.generateRandumNumber(s);this.logger.info(\"zb.mh.srt setTimer \"+i),this.stateCenter.relayTimer=setTimeout((function(){r.onRelayTimer()}),i)},e.prototype.onRelayTimer=function(){if(0!=this.stateCenter.realyMessageList.length){var e=this.stateCenter.realyMessageList[0];this.sendRelayMessageInternal(e.type,e.data,e.success,e.error),clearTimeout(this.stateCenter.relayTimer),this.stateCenter.relayTimer=null,this.stateCenter.realyMessageList.splice(0,1),this.stateCenter.realyMessageList.length>0&&this.setRelayTimer(this.stateCenter.serverTimeOffset,this.stateCenter.datiTimeWindow)}else this.logger.info(\"zb.mh.ort no relay data\")},e.prototype.handlePushTransMsg=function(e){if(this.stateCenter.isLogin()){var t=e.body.trans_type,r=e.body.trans_seq;!this.stateCenter.transSeqMap[t]||this.stateCenter.transSeqMap[t].seq<r?(this.stateCenter.transSeqMap[t]={seq:r},this.onRecvReliableMessage([e.body])):this.logger.warn(\"zb.mh.hptr trans seq wrong\"),this.logger.info(\"zb.mh.hptr trans \"+t+\" seq \"+r)}else this.logger.error(\"zb.mh.hptr not login\")},e.prototype.onRecvReliableMessage=function(e){},e.prototype.relogin=function(){},e.prototype.fetchReliableMessage=function(e,t){var r=this;this.logger.debug(\"zb.hb.frm call\");var s={trans_channel:e,fetch_array:t};this.socketCenter.registerRouter(\"trans_fetch\",(function(e){r.handleFetchTransRsp(e)})),this.socketCenter.sendMessage(\"trans_fetch\",s),this.logger.debug(\"zb.hb.frm call success\")},e.prototype.handleFetchTransRsp=function(e){if(this.stateCenter.isLogin())if(e.body.err_code!=s.ERROR_CODES.ROOM_SESSION_ID_ERR)if(0==e.body.err_code){var t=e.body.trans_fetch_results,r=[];if(Array.isArray(t)&&t.length>0)for(var o=0;o<t.length;o++){var i=t[o];if(i.err_code!==s.ERROR_CODES.FETCH_TRANS_UNKNOWN_TYPE){var a=i.trans_type,n=i.trans_seq;i.err_code!==s.ERROR_CODES.FETCH_TRANS_WRONG_SEQ?(!this.stateCenter.transSeqMap[a]||this.stateCenter.transSeqMap[a].seq<n?(this.stateCenter.transSeqMap[a]={seq:n},r.push(i)):this.logger.warn(\"zb.hb.hftr fetch trans seq wrong\"),r.length>0&&this.onRecvReliableMessage(r),this.logger.debug(\"zb.hb.hftr trans \"+a+\" seq \"+n)):(this.logger.warn(\"zb.hb.hftr fetch trans seq is wrong \"+i.err_code),this.stateCenter.transSeqMap[a]={seq:n})}else this.logger.warn(\"zb.hb.hftr fetch trans unknown type \"+i.err_code)}}else this.logger.error(\"zb.hb.hftr trans send error \"+e.body.err_code);else this.relogin();else this.logger.error(\"zb.hb.hftr not login\")},e}();t.MessageHandler=a},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.LiveHandler=void 0;var s=r(0),o=function(){function e(e,t,r){this.logger=e,this.socketCenter=r,this.stateCenter=t}return e.prototype.requestJoinLive=function(e,t,r,o){this.logger.debug(\"zb.lh.rjl call\");var i=this.stateCenter.getRequestId(),a=this.stateCenter.getSignalCmdContent(i,e);return null!=o&&(this.stateCenter.joinLiveCallbackMap[i]=o,this.sendSignalCmd(s.ENUM_SIGNAL_SUB_CMD.joinLiveRequest,a,e,t,r),!0)},e.prototype.inviteJoinLive=function(e,t,r,o){this.logger.debug(\"zb.lh.ijl call\");var i=this.stateCenter.getRequestId(),a=this.stateCenter.getSignalCmdContent(i,e);return null!=o&&(this.stateCenter.joinLiveCallbackMap[i]=o,this.sendSignalCmd(s.ENUM_SIGNAL_SUB_CMD.joinLiveInvite,a,e,t,r),!0)},e.prototype.endJoinLive=function(e,t,r){this.logger.debug(\"zb.lh.ejl call\");var o=this.stateCenter.getRequestId(),i=this.stateCenter.getSignalCmdContent(o,e);return this.sendSignalCmd(s.ENUM_SIGNAL_SUB_CMD.joinLiveStop,i,e,t,r),!0},e.prototype.respondJoinLive=function(e,t,r,o){this.logger.debug(\"zb.lh.rpjl call\");var i=this.stateCenter.joinLiveRequestMap[e];if(!i)return this.logger.info(\"zb.lh.rpjl no dest id name\"),!1;var a=0;!0===t&&(a=1);var n=this.stateCenter.getSignalCmdContent(e,i,a);return this.sendSignalCmd(s.ENUM_SIGNAL_SUB_CMD.joinLiveResult,n,i,r,o),delete this.stateCenter.joinLiveRequestMap[e],!0},e.prototype.sendSignalCmd=function(e,t,r,s,o){if(this.logger.debug(\"zb.lh.ssc call\"),this.stateCenter.isLogin()){this.logger.debug(\"zb.lh.ssc send signal cmd \"+e);var i={sub_cmd:e,signal_msg:t,dest_id_name:[r]};this.socketCenter.sendMessage(\"signal\",i,s,o),this.logger.info(\"zb.lh.ssc call success\")}else this.logger.error(\"zb.lh.ssc state error\")},e.prototype.handlePushSignalMsg=function(e){if(this.stateCenter.isLogin()){var t=JSON.parse(e.body.signal_msg);switch(this.logger.debug(\"zb.lh.hpcm hpsm= \",t),e.body.sub_cmd){case s.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveRequest:this.handlePushJoinLiveRequestMsg(t);break;case s.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveResult:this.handlePushJoinLiveResultMsg(t);break;case s.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveInvite:this.handlePushJoinLiveInviteMsg(t);break;case s.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveStop:this.handlePushJoinLiveStopMsg(t)}this.logger.debug(\"zb.lh.hpsm call end\")}else this.logger.warn(\"zb.lh.hpsm not login\")},e.prototype.handlePushJoinLiveRequestMsg=function(e){var t=e.request_id;if(\"string\"==typeof t){var r=e.from_userid;\"string\"==typeof r?(this.stateCenter.joinLiveRequestMap[t]=r,this.logger.info(\"zb.lh.hpjlrm onRecvJoinLiveRequest \"+r),this.onRecvJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id)):this.logger.error(\"zb.lh.hpjlrm no from user\")}else this.logger.error(\"zb.lh.hpjlrm no requestId\")},e.prototype.onRecvJoinLiveRequest=function(e,t,r,s){},e.prototype.handlePushJoinLiveInviteMsg=function(e){var t=e.request_id;if(\"string\"==typeof t){var r=e.from_userid;\"string\"==typeof r?(this.stateCenter.joinLiveRequestMap[t]=r,this.logger.info(\"zb.lh.hpjlim onRecvInviteJoinLiveRequest \"+r),this.onRecvInviteJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id)):this.logger.error(\"zb.lh.hpjlim no from user\")}else this.logger.error(\"zb.lh.hpjlim no requestId\")},e.prototype.onRecvInviteJoinLiveRequest=function(e,t,r,s){},e.prototype.handlePushJoinLiveResultMsg=function(e){var t=e.request_id;if(\"string\"==typeof t){var r=e.result;if(null!=r){var s=1==r;if(this.stateCenter.joinLiveCallbackMap[t]){var o=this.stateCenter.joinLiveCallbackMap[t];if(!o)return void this.logger.info(\"hpjlrm.o no callback\");this.logger.info(\"zb.lh.hpjlrm joinLiveRequest/invite result \"+s),delete this.stateCenter.joinLiveCallbackMap[t],o(s,e.from_userid,e.from_username)}}else this.logger.info(\"zb.lh.hpjlrm no result\")}else this.logger.error(\"zb.lh.hpjlrm no requestId\")},e.prototype.handlePushJoinLiveStopMsg=function(e){var t=e.request_id;\"string\"==typeof t?(this.logger.info(\"zb.lh.hpjlsm onRecvEndJoinLiveCommand \"+e.from_userid),this.onRecvEndJoinLiveCommand(t,e.from_userid,e.from_username,e.room_id)):this.logger.error(\"zb.lh.hpjlsm no requestId\")},e.prototype.onRecvEndJoinLiveCommand=function(e,t,r,s){},e}();t.LiveHandler=o},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.StateCenter=void 0;var s=r(0),o=r(2),i=function(){function e(){this.debug=!1,this.debugCustom=!1,this.testEnvironment=!1,this.third_token=\"\",this.pullLimited=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.runState=s.ENUM_RUN_STATE.logout,this.lastRunState=s.ENUM_RUN_STATE.logout,this.callbackList={},this.streamQuerying=!1,this.streamSeq=0,this.streamList=[],this.publishStreamList={},this.userQuerying=!1,this.userTempList=[],this.userList=[],this.userSeq=0,this.userSeqMergeMap=null,this.userSeqMergeTimer=null,this.userQueryTimer=null,this.lastUserQueryTime=0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:\"\",anchor_id_name:\"\",anchor_nick_name:\"\"},this.sendCommandMap={},this.sendCommandList=new s.LinkedList,this.sendDataMap={},this.sendDataList=new s.LinkedList,this.joinLiveCallbackMap={},this.joinLiveRequestMap={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.transSeqMap={},this.realyMessageList=[],this.relayTimer=null,this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer=null,this.msgCategory=2,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.bigImMessageList=[],this.tryLoginCount=0,this.tryLoginTimer=null,this.heartbeatTimer=null,this.loginHeartbeatTimer=null,this.sendDataCheckTimer=null,this.sendDataCheckInterval=2e3,this.sendDataTimeout=5e3,this.sendDataBizTimeout=6e3,this.sendDataDropTimeout=1e4,this.sendDataCheckOnceCount=100,this.sendRoomMsgTime=0,this.SendRoomMsgInterval=500,this.cmdSeq=0,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],roomStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[]},this.reportList={},this.reportSeqList={login:0,relogin:0,startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.mixStreamAdvance={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1}return e.prototype.isLogin=function(){return this.runState===s.ENUM_RUN_STATE.login},e.prototype.getRequestId=function(){return this.idName+\"-\"+o.getSeq()},e.prototype.getSignalCmdContent=function(e,t,r){var s={request_id:e,room_id:this.roomid,from_userid:this.idName,from_username:this.nickName,to_userid:t};return null!=r&&(s.result=r),JSON.stringify(s)},e.prototype.actionListener=function(e){for(var t=this,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];this.listenerList[e]&&this.listenerList[e].forEach((function(s){try{s.apply(void 0,r)}catch(r){t.logger.error(\"zb.sct.al0.0 \",e,\" \",r)}}))},e}();t.StateCenter=i},function(e,t,r){var s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoDataReport=void 0;var o=function(){function e(e){this.log=e,this.dataStatistics={},this.logger=e}return e.prototype.newReport=function(e,t){this.dataStatistics[e]={event_time:Date.now(),time_consumed:0,seq:e,error:0,message:\"success\",event:t,events:[]}},e.prototype.addMsgExt=function(e,t){this.dataStatistics[e]?this.dataStatistics[e].msg_ext=t:console.warn(e+\" not exist\")},e.prototype.addMsgInfo=function(e,t){this.dataStatistics[e]?Object.assign(this.dataStatistics[e],t):console.warn(e+\" not exist\")},e.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),time_consumed:0}):this.logger.warn(\"zd.es.0 no events\"):this.logger.warn(\"zd.es.0 no seq match\")},e.prototype.eventEnd=function(e,t,r){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(s&&0!==s.length){for(var o=s.length-1;o>=0;o--)if(s[o].event==t&&0==s[o].time_consumed){s[o].time_consumed=Date.now()-s[o].event_time;break}}else this.logger.info(\"zd.ee.0 no events\")}else this.logger.info(\"zd.ee.0 no seq match\")},e.prototype.eventEndWithMsg=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o){for(var i=o.length-1;i>=0;i--)if(o[i].event==t&&0==o[i].time_consumed){o[i].time_consumed=Date.now()-o[i].event_time,null==o[i].msg_ext&&(o[i].msg_ext={}),o[i].msg_ext=s({},r);break}}else this.logger.warn(\"zd.ee.0 no events\")}else this.logger.warn(\"zd.ee.0 no seq match\")},e.prototype.eventEndWithMsgInfo=function(e,t,r){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(s){for(var o=s.length-1;o>=0;o--)if(s[o].event==t&&0==s[o].time_consumed){s[o].time_consumed=Date.now()-s[o].event_time,Object.assign(s[o],r);break}}else this.logger.warn(\"zd.ee.0 no events\")}else this.logger.warn(\"zd.ee.0 no seq match\")},e.prototype.addEventInfo=function(e,t,r,s){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(null!=o){for(var i=o.length-1;i>=0;i--)if(o[i].event==t&&null!=o[i].time_consumed){null==o[i].msg_ext?o[i].msg_ext={}:o[i].msg_ext&&(o[i].msg_ext[r]=s);break}}else this.logger.warn(\"zd.aei.0 no events\")}else this.logger.warn(\"zd.aei.0 no seq match\")},e.prototype.addEventMsg=function(e,t,r,s){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(null!=o){for(var i=o.length-1;i>=0;i--)if(o[i].event==t){o[i][r]=s;break}}else this.logger.warn(\"zd.aem.0 no events\")}else this.logger.warn(\"zd.aem.0 no seq match\")},e.prototype.addEvent=function(e,t,r){this.dataStatistics[e]?this.dataStatistics[e].events&&(r?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),msg_ext:r}):this.dataStatistics[e].events.push({event:t,event_time:Date.now()})):this.logger.warn(\"zd.ae.0 no seq match\")},e.prototype.uploadReport=function(e,t,r,s){var o=this.dataStatistics[e];null!=o&&(t&&(o.event=t),o.time_consumed=Date.now()-o.event_time,r&&this.addMsgInfo(e,{error:r.code,message:r.message+\" \"+(s||\"\")}),this.logger.report(o),delete this.dataStatistics[e])},e}();t.ZegoDataReport=o}])}));"]}